<!DOCTYPE html>
<!-- saved from url=(0037)https://zhuanlan.zhihu.com/p/24425116 -->
<html lang="zh" data-theme="light" class=" no-touch"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>给深度学习入门者的Python快速教程 - 番外篇之Python-OpenCV</title><meta name="renderer" content="webkit"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"><meta name="force-rendering" content="webkit"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="google-site-verification" content="FTeR0c8arOPKh8c5DYh_9uu98_zJbaWw53J-Sch9MTg"><link rel="shortcut icon" href="https://static.zhihu.com/static/favicon.ico" type="image/x-icon"><link href="./给深度学习入门者的Python快速教程 - 番外篇之Python-OpenCV_files/app.483f84f0f83920ec6662875ff7912f98.css" rel="stylesheet"><script type="text/javascript" charset="utf-8" async="" src="./给深度学习入门者的Python快速教程 - 番外篇之Python-OpenCV_files/editor.3c74b2acafe41a24a10f.js"></script><style type="text/css">.Notification{position:fixed;top:0;left:50%;z-index:499;padding:14px 24px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;-webkit-transform:translate(-50%);transform:translate(-50%);font-size:14px;color:#1a1a1a;pointer-events:all;border-radius:4px;-webkit-box-shadow:0 5px 20px rgba(26,26,26,.1);box-shadow:0 5px 20px rgba(26,26,26,.1);-webkit-box-sizing:border-box;box-sizing:border-box}@media (max-width:768px){.Notification{width:calc(100vw - 32px)}}@media (min-width:769px){.Notification{width:-webkit-fit-content;width:-moz-fit-content;width:fit-content;max-width:600px;min-width:520px}}html[data-theme=dark] .Notification{color:#999;-webkit-box-shadow:0 5px 20px hsla(0,0%,60%,.1);box-shadow:0 5px 20px hsla(0,0%,60%,.1)}.Notification-textSection{width:100%;display:inline-block}@media (max-width:768px){.Notification-textSection{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}}.Notification-textSection--withButton{text-align:left}.Notification-textSection--withoutButton{text-align:center}.Notification-actionsSection{white-space:nowrap;height:100%;margin:auto 0 auto 32px}.Notification-wrapper{position:fixed;top:0;right:0;bottom:0;left:0;z-index:503;overflow:hidden;pointer-events:none}.Notification-white{color:#1a1a1a;background:#fff}html[data-theme=dark] .Notification-white{color:#999;background:#1a1a1a}.Notification-red{color:#fff;background:#f1403c}html[data-theme=dark] .Notification-red{color:#1a1a1a;background:#b7302d}.Notification-red-ghost{color:#f1403c;background:#fff}html[data-theme=dark] .Notification-red-ghost{color:#b7302d;background:#1a1a1a}@-webkit-keyframes spring-in{0%{-webkit-transform:translate(-50%,-20px);transform:translate(-50%,-20px);opacity:.01}to{-webkit-transform:translate(-50%);transform:translate(-50%);opacity:1}}@keyframes spring-in{0%{-webkit-transform:translate(-50%,-20px);transform:translate(-50%,-20px);opacity:.01}to{-webkit-transform:translate(-50%);transform:translate(-50%);opacity:1}}@-webkit-keyframes spring-out{0%{-webkit-transform:translate(-50%);transform:translate(-50%);opacity:1}to{-webkit-transform:translate(-50%,-20px);transform:translate(-50%,-20px);opacity:0}}@keyframes spring-out{0%{-webkit-transform:translate(-50%);transform:translate(-50%);opacity:1}to{-webkit-transform:translate(-50%,-20px);transform:translate(-50%,-20px);opacity:0}}.Notification-enter{-webkit-animation:spring-in .3s;animation:spring-in .3s;-webkit-animation-fill-mode:both;animation-fill-mode:both}.Notification-leave{-webkit-animation:spring-out .3s;animation:spring-out .3s;-webkit-animation-fill-mode:both;animation-fill-mode:both}</style><style type="text/css">.Formula{display:inline-block;vertical-align:middle;background:no-repeat 50%;background-size:contain;font-size:0}.Formula.isEditable{cursor:pointer}.Formula-image{max-width:100%;opacity:0;visibility:hidden}.Formula-placeholder{opacity:0}</style><style type="text/css">.MathToolbar{display:block;padding:4px 12px;border-radius:inherit inherit 0 0;background:#f6f6f6;border-bottom:1px solid #ebebeb;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}html[data-theme=dark] .MathToolbar{background:#2e2e2e;border-bottom:1px solid #444}.MathToolbar-button{height:28px;padding:2px 4px;-webkit-box-sizing:border-box;box-sizing:border-box;border:1px solid transparent;vertical-align:middle}.MathToolbar-button+.MathToolbar-button{margin-left:16px}.MathToolbar-button:hover{background:#f6f6f6;border-color:#ebebeb}html[data-theme=dark] .MathToolbar-button:hover{background:#2e2e2e;border-color:#444}.MathToolbar-palettes{-ms-flex-wrap:wrap;flex-wrap:wrap;margin:-4px;padding:16px;max-width:384px}.MathToolbar-palettes,.MathToolbar-palettesButton{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.MathToolbar-palettesButton{margin:4px;padding:0;width:24px;height:24px;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;font-size:16px;color:#8590a6;border-radius:4px}.MathToolbar-palettesButton:hover{background-color:#f6f6f6}html[data-theme=dark] .MathToolbar-palettesButton:hover{background-color:#2e2e2e}html[data-theme=dark] .MathToolbar-palettesButton{color:#606a80}.MathToolbar-paletteIcon{max-width:calc(100% - 2px)}.MathToolbar-palettes--math{max-width:380px}.MathToolbar-palettes--math .MathToolbar-palettesButton{padding:0 3px;width:30px;height:60px}.MathToolbar-palettes--arrow .MathToolbar-palettesButton{height:35px}</style><style type="text/css">.FormulaModal{width:550px}.FormulaModal-input{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;margin-bottom:30px}.FormulaModal-input .Input{padding:6px 12px;min-height:100px;-webkit-box-sizing:border-box;box-sizing:border-box}.FormulaModal-formula{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding:0 3px;background:#fff;border:2px dashed #ebebeb;border-radius:3px;min-height:106px;overflow-x:auto}.FormulaModal-formula img{max-width:100%}html[data-theme=dark] .FormulaModal-formula{background:#1a1a1a;border:2px dashed #444}.FormulaModal-buttonGroup{margin-top:32px}.FormulaModal-previewText{color:#8590a6;font-size:14px}html[data-theme=dark] .FormulaModal-previewText{color:#606a80}</style><style type="text/css">.FocusPlugin--unfocused:hover{cursor:default;-webkit-box-shadow:0 0 0 2px rgba(0,132,255,.3);box-shadow:0 0 0 2px rgba(0,132,255,.3)}html[data-theme=dark] .FocusPlugin--unfocused:hover{-webkit-box-shadow:0 0 0 2px rgba(58,118,208,.3);box-shadow:0 0 0 2px rgba(58,118,208,.3)}.FocusPlugin--focused{cursor:default;-webkit-box-shadow:0 0 0 2px #0084ff;box-shadow:0 0 0 2px #0084ff}html[data-theme=dark] .FocusPlugin--focused{-webkit-box-shadow:0 0 0 2px #3a76d0;box-shadow:0 0 0 2px #3a76d0}</style><style type="text/css">.Image{max-width:100%;margin:0 auto}.Image[data-size=small]{max-width:40%}.Image--isBlock{display:block}</style><style type="text/css">.Editable-imageUploader{text-align:center}.Editable-imageUploader-layout{position:relative;display:inline-block;max-width:100%;vertical-align:top}.Editable-imageUploader-layout.is-fullWidth{width:100%}.Editable-imageUploader-image{display:block;max-width:100%;opacity:.3}.Editable-imageUploader-placeholder{height:192px;background-color:#ebebeb}html[data-theme=dark] .Editable-imageUploader-placeholder{background-color:#444}.Editable-imageUploader-status{position:absolute;left:0;top:0;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:100%;height:100%}.Editable-imageUploader-statusText{font-size:28px;line-height:40px;color:#8590a6}html[data-theme=dark] .Editable-imageUploader-statusText{color:#606a80}.Editable-imageUploader-status.is-error .Editable-imageUploader-statusText{color:#f36}html[data-theme=dark] .Editable-imageUploader-status.is-error .Editable-imageUploader-statusText{color:#d92155}.Editable-imageUploader-retry{margin-top:4px;font-size:16px;line-height:32px}.Editable-imageUploader-retry .Button{font-size:inherit}.Editable-imageUploader-progress{position:absolute;left:0;bottom:0;width:100%;height:4px;background-color:#0084ff}.Editable-imageUploader-progress.is-error{background-color:#f36}html[data-theme=dark] .Editable-imageUploader-progress.is-error{background-color:#d92155}.Editable-imageUploader-progress .LoadingBar{position:relative;height:100%;background-color:hsla(0,0%,100%,.3)}html[data-theme=dark] .Editable-imageUploader-progress .LoadingBar{background-color:rgba(26,26,26,.3)}html[data-theme=dark] .Editable-imageUploader-progress{background-color:#3a76d0}</style><style type="text/css">.Image-caption.is-placeholder{color:#bfbfbf}html[data-theme=dark] .Image-caption.is-placeholder{color:gray}.Image-caption.is-editing{opacity:0}.Image-captionInput{position:absolute;z-index:203}.Image-captionInput textarea{display:block;overflow:hidden;width:100%;height:100%;padding:0;border:none;font:inherit;font-size:14px;line-height:1.5;text-align:center;color:#8590a6;background:none;resize:none}.Image-captionInput textarea::-webkit-input-placeholder{color:#bfbfbf}.Image-captionInput textarea:-ms-input-placeholder{color:#bfbfbf}.Image-captionInput textarea::placeholder{color:#bfbfbf}html[data-theme=dark] .Image-captionInput textarea::-webkit-input-placeholder{color:gray}html[data-theme=dark] .Image-captionInput textarea:-ms-input-placeholder{color:gray}html[data-theme=dark] .Image-captionInput textarea::placeholder{color:gray}.Image-captionInput textarea:focus{outline:none}html[data-theme=dark] .Image-captionInput textarea{color:#606a80}</style><style type="text/css">.Image-resizer{padding:8px}.Image-resizerButton{padding:0 8px;vertical-align:middle}.Image-resizerButton .Zi{display:block}.Image-resizerButton.is-active{color:#0084ff}html[data-theme=dark] .Image-resizerButton.is-active{color:#3a76d0}</style><style type="text/css">.Editable-video{margin:16px 0;border-radius:4px}.Video-uploadPosterButton{background:rgba(26,26,26,.5);border:1px solid hsla(0,0%,100%,.3);border-radius:3px;height:32px;width:109px;position:absolute;bottom:16px;right:16px;text-align:center;line-height:32px;cursor:pointer}.Video-uploadPosterButton p{color:#fff;font-size:14px;margin:0!important}html[data-theme=dark] .Video-uploadPosterButton p{color:#1a1a1a}html[data-theme=dark] .Video-uploadPosterButton{background:hsla(0,0%,60%,.5);border:1px solid rgba(26,26,26,.3)}</style><style type="text/css">.Editable-videoUploader{margin:16px 0;border-radius:4px}.Editable-videoUploader-thumbnail{position:relative;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;width:100%;height:100%}.Editable-videoUploader-text{text-align:center;position:relative;color:#8590a6}html[data-theme=dark] .Editable-videoUploader-text{color:#606a80}.Editable-videoUploader-status{font-size:28px;line-height:40px}.Editable-videoUploader-size{margin-top:10px;font-size:14px;line-height:20px}.Editable-videoUploader-progress{position:absolute;left:0;right:0;bottom:0;overflow:hidden;height:4px;background-color:rgba(26,26,26,.05)}html[data-theme=dark] .Editable-videoUploader-progress{background-color:hsla(0,0%,60%,.05)}.Editable-videoUploader-progress-bar{position:absolute;left:0;top:0;height:100%;background-color:#0084ff}.Editable-videoUploader-progress-bar.is-error{background-color:#f36}html[data-theme=dark] .Editable-videoUploader-progress-bar.is-error{background-color:#d92155}html[data-theme=dark] .Editable-videoUploader-progress-bar{background-color:#3a76d0}.Editable-videoUploader-progress .LoadingBar{position:absolute;left:0;top:0;height:100%;background-color:hsla(0,0%,100%,.3)}html[data-theme=dark] .Editable-videoUploader-progress .LoadingBar{background-color:rgba(26,26,26,.3)}.Editable-videoUploader-image{position:absolute}.Editable-videoUploader-uploadPosterButton{background:rgba(26,26,26,.5);border:1px solid hsla(0,0%,100%,.3);border-radius:3px;height:32px;width:109px;position:absolute;bottom:-130px;right:16px;text-align:center;line-height:32px;cursor:pointer}.Editable-videoUploader-uploadPosterButton p{color:#fff;font-size:14px;margin:0!important}html[data-theme=dark] .Editable-videoUploader-uploadPosterButton p{color:#1a1a1a}html[data-theme=dark] .Editable-videoUploader-uploadPosterButton{background:hsla(0,0%,60%,.5);border:1px solid rgba(26,26,26,.3)}.Editable-videoUploader-imageMask{width:100%;height:100%;position:absolute;background:hsla(0,0%,92%,.9)}html[data-theme=dark] .Editable-videoUploader-imageMask{background:rgba(68,68,68,.9)}</style><style type="text/css">.Editable-videoError{margin:16px 0;border-radius:4px}</style><style type="text/css">.Editable-divider{overflow:hidden}</style><style type="text/css">.Link+.Link{margin-left:2px}.Link[data-editable]{cursor:text!important}</style><style type="text/css">.LinkModal-input{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.LinkModal-input+.LinkModal-input{margin-top:10px}.LinkModal-input .Input{margin-left:8px}</style><style type="text/css">.LinkBubble.Popover-content--top.Popover-content--arrowed{margin-top:-10px}.LinkBubble.Popover-content--bottom.Popover-content--arrowed{margin-top:10px}.LinkBubble-content{display:block;padding:7px 10px 7px 16px}.LinkBubble-button,.LinkBubble-previewLink{vertical-align:middle}.LinkBubble-previewLink{display:inline-block;margin-right:8px;max-width:233px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;text-decoration:none;font-size:14px;line-height:1.3;border-bottom:1px solid transparent}.LinkBubble-previewLink:hover{color:#175199;border-bottom-color:rgba(0,132,255,.72)}html[data-theme=dark] .LinkBubble-previewLink:hover{color:#175199;border-bottom-color:rgba(58,118,208,.72)}.LinkBubble-button{padding:0 6px}</style><style type="text/css">.MentionSuggestions{position:absolute;z-index:203;line-height:1}.MentionSuggestions-input{width:200px;padding:4px 6px;font-size:inherit}.MentionSuggestions-input .Input{height:auto;background:transparent}.MentionSuggestions-menu{width:200px}.MentionSuggestions-menu .Menu-item{padding:0 10px}</style><style type="text/css">.Dropzone{position:relative}.Dropzone-cursor{position:absolute;left:0;right:0;margin:-1px 0;border-bottom:2px solid #0084ff;pointer-events:none}html[data-theme=dark] .Dropzone-cursor{border-bottom:2px solid #3a76d0}</style><style type="text/css">.Editable-toolbar{display:-webkit-box;display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap;background:#fff;border-bottom:1px solid #ebebeb;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.isToolbarSticky .Editable-toolbar,.Sticky.is-fixed .Editable-toolbar{border-top:none!important;border-bottom:none!important}.isToolbarSticky .Editable-toolbar:after,.Sticky.is-fixed .Editable-toolbar:after{content:" ";position:absolute;left:0;top:100%;width:100%;pointer-events:none;height:3px;background:radial-gradient(ellipse at 50% 1%,rgba(26,26,26,.1),hsla(0,0%,100%,0) 80%)}html[data-theme=dark] .isToolbarSticky .Editable-toolbar:after,html[data-theme=dark] .Sticky.is-fixed .Editable-toolbar:after{background:radial-gradient(ellipse at 50% 1%,hsla(0,0%,60%,.1),rgba(26,26,26,0) 80%)}html[data-theme=dark] .Editable-toolbar{background:#1a1a1a;border-bottom:1px solid #444}.Editable-control,.Editable-toolbar-separator{margin-right:10px}.Editable-control:last-child,.Editable-toolbar-separator:last-child{margin-right:0}.Editable-toolbar-separator{display:inline-block;width:1px;height:28px;vertical-align:middle;background-color:#ebebeb}html[data-theme=dark] .Editable-toolbar-separator{background-color:#444}.Editable-control{padding:0 1px;height:28px;cursor:pointer;-webkit-box-sizing:border-box;box-sizing:border-box;white-space:nowrap;border:1px solid transparent}.Editable-control .Zi{fill:#8590a6}html[data-theme=dark] .Editable-control .Zi{fill:#606a80}.Editable-control:not(:disabled):hover{background:#f6f6f6;border-color:#ebebeb}html[data-theme=dark] .Editable-control:not(:disabled):hover{background:#2e2e2e;border-color:#444}.Editable-control.is-active .Zi{fill:#0084ff}html[data-theme=dark] .Editable-control.is-active .Zi{fill:#3a76d0}.Editable-control .Zi,.Editable-control span{vertical-align:middle}.Editable-control .Zi+span{margin-left:6px}</style><style type="text/css">.Editable-videoModal{display:block}.Editable-videoModal-typeButton{font-size:20px;font-weight:400;color:inherit}.Editable-videoModal-typeButton.is-active{font-weight:500;color:#0084ff}html[data-theme=dark] .Editable-videoModal-typeButton.is-active{color:#3a76d0}.Editable-videoModal-uploader{position:relative;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-sizing:border-box;box-sizing:border-box;height:220px;border:2px dashed #ebebeb;border-radius:10px;cursor:pointer}.Editable-videoModal-uploader:hover{border-color:#8590a6}.Editable-videoModal-uploader:hover .Zi{fill:#8590a6}html[data-theme=dark] .Editable-videoModal-uploader:hover .Zi{fill:#606a80}html[data-theme=dark] .Editable-videoModal-uploader:hover{border-color:#606a80}.Editable-videoModal-uploader input{display:none}html[data-theme=dark] .Editable-videoModal-uploader{border:2px dashed #444}.Editable-videoModal-uploader-icon{text-align:center;display:block}.Editable-videoModal-uploader-icon .Zi{vertical-align:middle;fill:#ebebeb}html[data-theme=dark] .Editable-videoModal-uploader-icon .Zi{fill:#444}.Editable-videoModal-uploader-text{margin-top:10px;font-size:18px;line-height:30px;text-align:center}.Editable-videoModal-uploader-tip{font-size:14px;line-height:30px;text-align:center;color:#8590a6}html[data-theme=dark] .Editable-videoModal-uploader-tip{color:#606a80}</style><style type="text/css">.Editable-languageSuggestions{position:fixed;z-index:203}.Editable-languageSuggestionsInput{cursor:pointer}.Editable-languageSuggestionsInput input{cursor:inherit}.Editable-languageSuggestionsInput input:focus{cursor:text}.Editable-languageSuggestionsMenu{max-height:300px;margin-top:-8px;margin-bottom:-8px;overflow-y:auto}</style><style type="text/css">.Editable-notification-layout{-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.Editable-notification-actions,.Editable-notification-layout{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.Editable-notification-actions{margin:0 -12px}.Editable-notification-action{margin:0 12px}.Editable .RichText{cursor:text}.public-DraftEditorPlaceholder-root{position:absolute;pointer-events:none}.Editable--hidePlaceholder .public-DraftEditorPlaceholder-root{display:none}.Editable-styled,.Editable-unstyled{margin:0 0 .72em}.Editable-styled:last-child,.Editable-unstyled:last-child{margin-bottom:0}.DraftEditor-root blockquote+blockquote{margin-top:-1em}.DraftEditor-root pre.public-DraftStyleDefault-pre{border-radius:4px}.DraftEditor-root pre.public-DraftStyleDefault-pre pre{padding:0;margin:0;border-radius:0;overflow:visible;overflow:initial}.DraftEditor-root .public-DraftStyleDefault-orderedListItem.public-DraftStyleDefault-depth1,.DraftEditor-root .public-DraftStyleDefault-unorderedListItem.public-DraftStyleDefault-depth1{margin-left:2em}.DraftEditor-root .public-DraftStyleDefault-orderedListItem.public-DraftStyleDefault-depth2,.DraftEditor-root .public-DraftStyleDefault-unorderedListItem.public-DraftStyleDefault-depth2{margin-left:4em}.DraftEditor-root .public-DraftStyleDefault-orderedListItem.public-DraftStyleDefault-depth3,.DraftEditor-root .public-DraftStyleDefault-unorderedListItem.public-DraftStyleDefault-depth3{margin-left:6em}.DraftEditor-root .public-DraftStyleDefault-orderedListItem.public-DraftStyleDefault-depth4,.DraftEditor-root .public-DraftStyleDefault-unorderedListItem.public-DraftStyleDefault-depth4{margin-left:8em}.DraftEditor-root .public-DraftStyleDefault-orderedListItem{position:relative;list-style-type:none}.DraftEditor-root .public-DraftStyleDefault-orderedListItem:before{position:absolute;left:-36px;width:30px;text-align:right}.DraftEditor-root .public-DraftStyleDefault-orderedListItem.public-DraftStyleDefault-depth0.public-DraftStyleDefault-reset{counter-reset:ol0}.DraftEditor-root .public-DraftStyleDefault-orderedListItem.public-DraftStyleDefault-depth0:before{content:counter(ol0) ". ";counter-increment:ol0}.DraftEditor-root .public-DraftStyleDefault-orderedListItem.public-DraftStyleDefault-depth1.public-DraftStyleDefault-reset{counter-reset:ol1}.DraftEditor-root .public-DraftStyleDefault-orderedListItem.public-DraftStyleDefault-depth1:before{content:counter(ol1) ". ";counter-increment:ol1}.DraftEditor-root .public-DraftStyleDefault-orderedListItem.public-DraftStyleDefault-depth2.public-DraftStyleDefault-reset{counter-reset:ol2}.DraftEditor-root .public-DraftStyleDefault-orderedListItem.public-DraftStyleDefault-depth2:before{content:counter(ol2) ". ";counter-increment:ol2}.DraftEditor-root .public-DraftStyleDefault-orderedListItem.public-DraftStyleDefault-depth3.public-DraftStyleDefault-reset{counter-reset:ol3}.DraftEditor-root .public-DraftStyleDefault-orderedListItem.public-DraftStyleDefault-depth3:before{content:counter(ol3) ". ";counter-increment:ol3}.DraftEditor-root .public-DraftStyleDefault-orderedListItem.public-DraftStyleDefault-depth4.public-DraftStyleDefault-reset{counter-reset:ol4}.DraftEditor-root .public-DraftStyleDefault-orderedListItem.public-DraftStyleDefault-depth4:before{content:counter(ol4) ". ";counter-increment:ol4}_:-ms-lang(x),pre.public-DraftStyleDefault-pre,pre.public-DraftStyleDefault-pre pre{overflow:visible;overflow:initial;word-wrap:break-word}</style><style type="text/css">.DraftEditor-root code[class*=language-],.DraftEditor-root pre[class*=language-]{color:#000;background:none;text-shadow:0 1px #fff;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}.DraftEditor-root code[class*=language-]::-moz-selection,.DraftEditor-root code[class*=language-] ::-moz-selection,.DraftEditor-root pre[class*=language-]::-moz-selection,.DraftEditor-root pre[class*=language-] ::-moz-selection{text-shadow:none;background:#bfbfbf}.DraftEditor-root code[class*=language-]::selection,.DraftEditor-root code[class*=language-] ::selection,.DraftEditor-root pre[class*=language-]::selection,.DraftEditor-root pre[class*=language-] ::selection{text-shadow:none;background:#bfbfbf}html[data-theme=dark] .DraftEditor-root code[class*=language-]::-moz-selection,html[data-theme=dark] .DraftEditor-root code[class*=language-] ::-moz-selection,html[data-theme=dark] .DraftEditor-root pre[class*=language-]::-moz-selection,html[data-theme=dark] .DraftEditor-root pre[class*=language-] ::-moz-selection{background:gray}html[data-theme=dark] .DraftEditor-root code[class*=language-]::selection,html[data-theme=dark] .DraftEditor-root code[class*=language-] ::selection,html[data-theme=dark] .DraftEditor-root pre[class*=language-]::selection,html[data-theme=dark] .DraftEditor-root pre[class*=language-] ::selection{background:gray}@media print{.DraftEditor-root code[class*=language-],.DraftEditor-root pre[class*=language-]{text-shadow:none}}.DraftEditor-root pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}.DraftEditor-root :not(pre)>code[class*=language-],.DraftEditor-root pre[class*=language-]{background:#f6f6f6}html[data-theme=dark] .DraftEditor-root :not(pre)>code[class*=language-],html[data-theme=dark] .DraftEditor-root pre[class*=language-]{background:#2e2e2e}.DraftEditor-root :not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.DraftEditor-root .token.cdata,.DraftEditor-root .token.comment,.DraftEditor-root .token.doctype,.DraftEditor-root .token.prolog{color:#708090}.DraftEditor-root .token.punctuation{color:#999}html[data-theme=dark] .DraftEditor-root .token.punctuation{color:#646464}.DraftEditor-root .namespace{opacity:.7}.DraftEditor-root .token.boolean,.DraftEditor-root .token.constant,.DraftEditor-root .token.deleted,.DraftEditor-root .token.number,.DraftEditor-root .token.property,.DraftEditor-root .token.symbol,.DraftEditor-root .token.tag{color:#f36}html[data-theme=dark] .DraftEditor-root .token.boolean,html[data-theme=dark] .DraftEditor-root .token.constant,html[data-theme=dark] .DraftEditor-root .token.deleted,html[data-theme=dark] .DraftEditor-root .token.number,html[data-theme=dark] .DraftEditor-root .token.property,html[data-theme=dark] .DraftEditor-root .token.symbol,html[data-theme=dark] .DraftEditor-root .token.tag{color:#d92155}.DraftEditor-root .token.attr-name,.DraftEditor-root .token.builtin,.DraftEditor-root .token.char,.DraftEditor-root .token.inserted,.DraftEditor-root .token.selector,.DraftEditor-root .token.string,html[data-theme=dark] .DraftEditor-root .token.attr-name,html[data-theme=dark] .DraftEditor-root .token.builtin,html[data-theme=dark] .DraftEditor-root .token.char,html[data-theme=dark] .DraftEditor-root .token.inserted,html[data-theme=dark] .DraftEditor-root .token.selector,html[data-theme=dark] .DraftEditor-root .token.string{color:gray}.DraftEditor-root .language-css .token.string,.DraftEditor-root .style .token.string,.DraftEditor-root .token.entity,.DraftEditor-root .token.operator,.DraftEditor-root .token.url{color:#c2a469;background:hsla(0,0%,100%,.5)}html[data-theme=dark] .DraftEditor-root .language-css .token.string,html[data-theme=dark] .DraftEditor-root .style .token.string,html[data-theme=dark] .DraftEditor-root .token.entity,html[data-theme=dark] .DraftEditor-root .token.operator,html[data-theme=dark] .DraftEditor-root .token.url{color:#ba9b5d;background:rgba(26,26,26,.5)}.DraftEditor-root .token.atrule,.DraftEditor-root .token.attr-value,.DraftEditor-root .token.keyword{color:#0084ff}html[data-theme=dark] .DraftEditor-root .token.atrule,html[data-theme=dark] .DraftEditor-root .token.attr-value,html[data-theme=dark] .DraftEditor-root .token.keyword{color:#3a76d0}.DraftEditor-root .token.function{color:#f36}html[data-theme=dark] .DraftEditor-root .token.function{color:#d92155}.DraftEditor-root .token.important,.DraftEditor-root .token.regex,.DraftEditor-root .token.variable,html[data-theme=dark] .DraftEditor-root .token.important,html[data-theme=dark] .DraftEditor-root .token.regex,html[data-theme=dark] .DraftEditor-root .token.variable{color:#ff9607}.DraftEditor-root .token.bold,.DraftEditor-root .token.important{font-weight:600;font-synthesis:style}html[data-ios] .DraftEditor-root .token.bold,html[data-ios] .DraftEditor-root .token.important{font-weight:500}html[data-android] .DraftEditor-root .token.bold,html[data-android] .DraftEditor-root .token.important{font-weight:700}.DraftEditor-root .token.italic{font-style:italic}.DraftEditor-root .token.entity{cursor:help}</style></head><body><div id="react-root"><div data-reactroot=""><!-- react-empty: 2 --><div class="Layout av-cardBackground" data-zop-usertoken="{&quot;userToken&quot;:&quot;&quot;}"><!-- react-empty: 4 --><div class="Layout-navbarHolder"><header class="Navbar ScrollBackFixed ScrollBackFixed-animation"><div class="Navbar-logo-wrapper"><a class="Navbar-logo icon-ic_zhihu_logo" href="https://www.zhihu.com/" target="_blank" rel="noopener noreferrer" aria-label="知乎首页"></a></div><div class="Navbar-postTitle Navbar-title"><a href="https://zhuanlan.zhihu.com/frombeijingwithlove"><img class="Navbar-columnIcon" alt="From Beijing with Love" src="./给深度学习入门者的Python快速教程 - 番外篇之Python-OpenCV_files/v2-de9efff9dc136da1fb54bd00beb38477_m.jpg"></a><div class="Navbar-postTitleName"><span class="Navbar-postTitleMeta">首发于</span><a class="Navbar-postTitleMain" href="https://zhuanlan.zhihu.com/frombeijingwithlove">From Beijing with Love</a></div><!-- react-empty: 15 --></div><div class="Navbar-functionality"><a class="Navbar-write"><i class="icon icon-ic_nav_new"></i><!-- react-text: 19 -->写文章<!-- /react-text --></a><button class="Button Navbar-loginButon Button--blue" type="button"><!-- react-text: 21 -->登录<!-- /react-text --></button></div></header></div><!-- react-empty: 22 --><div></div><div class="Layout-main av-card av-paddingBottom av-bodyFont Layout-titleImage--normal"><div class="PostIndex-header av-paddingTop av-card" data-zop="{&quot;authorName&quot;:&quot;達聞西&quot;,&quot;itemId&quot;:&quot;24425116&quot;,&quot;title&quot;:&quot;给深度学习入门者的Python快速教程 - 番外篇之Python-OpenCV&quot;,&quot;type&quot;:&quot;article&quot;}"><div class="TitleImage"><img alt="给深度学习入门者的Python快速教程 - 番外篇之Python-OpenCV" src="./给深度学习入门者的Python快速教程 - 番外篇之Python-OpenCV_files/v2-1712545c1114f3f66f37121c02354144_r.jpg" class="TitleImage-imagePure TitleImage-imagePure--fixed" height="471px"></div><h1 class="PostIndex-title av-paddingSide av-titleFont">给深度学习入门者的Python快速教程 - 番外篇之Python-OpenCV</h1><div class="PostIndex-author"><a href="https://www.zhihu.com/people/frombeijingwithlove" target="_blank" rel="noopener noreferrer"><img class="Avatar-hemingway PostIndex-authorAvatar Avatar--xs" alt="達聞西" src="./给深度学习入门者的Python快速教程 - 番外篇之Python-OpenCV_files/v2-e3036b85796de307726b34472d0d126c_xs.jpg" srcset="https://pic1.zhimg.com/v2-e3036b85796de307726b34472d0d126c_l.jpg 2x"></a><a href="https://www.zhihu.com/people/frombeijingwithlove" target="_blank" class="PostIndex-authorName">達聞西</a><!-- react-empty: 33 --><span class="Bull"></span><div class="HoverTitle" data-hover-title="2016 年 12月 17 日星期六晚上 10 点 57 分"><time datetime="Sat Dec 17 2016 22:57:55 GMT+0800 (中国标准时间)">1 年前</time></div></div></div><div class="RichText PostIndex-content av-paddingSide av-card"><p>本篇是前面两篇教程：<a href="https://zhuanlan.zhihu.com/p/24162430" class="internal" data-za-detail-view-id="1043">给深度学习入门者的Python快速教程 - 基础篇</a></p><p><a href="https://zhuanlan.zhihu.com/p/24309547" class="internal" data-za-detail-view-id="1043">给深度学习入门者的Python快速教程 - numpy和Matplotlib篇</a></p><p>的番外篇，因为严格来说不是在讲Python而是讲在Python下使用OpenCV。本篇将介绍和深度学习数据处理阶段最相关的基础使用，并完成4个有趣实用的小例子：</p><p>- 延时摄影小程序</p><p>- 视频中截屏采样的小程序</p><p>- 图片数据增加（data
augmentation）的小工具</p><p>- 物体检测框标注小工具</p><p>其中后两个例子的代码可以在下面地址直接下载：</p><p><a href="http://link.zhihu.com/?target=https%3A//github.com/frombeijingwithlove/dlcv_for_beginners" class=" wrap external" target="_blank" rel="nofollow noreferrer" data-za-detail-view-id="1043">frombeijingwithlove/dlcv_for_beginners</a></p><h2>6.1 OpenCV简介</h2><p>OpenCV是计算机视觉领域应用最广泛的开源工具包，基于C/C++，支持Linux/Windows/MacOS/Android/iOS，并提供了Python，Matlab和Java等语言的接口，因为其丰富的接口，优秀的性能和商业友好的使用许可，不管是学术界还是业界中都非常受欢迎。OpenCV最早源于Intel公司1998年的一个研究项目，当时在Intel从事计算机视觉的工程师盖瑞·布拉德斯基(Gary Bradski)访问一些大学和研究组时发现学生之间实现计算机视觉算法用的都是各自实验室里的内部代码或者库，这样新来实验室的学生就能基于前人写的基本函数快速上手进行研究。于是OpenCV旨在提供一个用于计算机视觉的科研和商业应用的高性能通用库。
第一个alpha版本的OpenCV于2000年的CVPR上发布，在接下来的5年里，又陆续发布了5个beta版本，2006年发布了第一个正式版。2009年随着盖瑞加入了Willow
Garage，OpenCV从Willow Garage得到了积极的支持，并发布了1.1版。2010年OpenCV发布了2.0版本，添加了非常完备的C++接口，从2.0开始的版本非常用户非常庞大，至今仍在维护和更新。2015年OpenCV 3正式发布，除了架构的调整，还加入了更多算法，更多性能的优化和更加简洁的API，另外也加强了对GPU的支持，现在已经在许多研究机构和商业公司中应用开来。
</p><h2>6.1.1
OpenCV的结构</h2><p>和Python一样，当前的OpenCV也有两个大版本，OpenCV2和OpenCV3。相比OpenCV2，OpenCV3提供了更强的功能和更多方便的特性。不过考虑到和深度学习框架的兼容性，以及上手安装的难度，这部分先以2为主进行介绍。</p><p>根据功能和需求的不同，OpenCV中的函数接口大体可以分为如下部分：</p><p>-         
core：核心模块，主要包含了OpenCV中最基本的结构（矩阵，点线和形状等），以及相关的基础运算/操作。</p><p>-         
imgproc：图像处理模块，包含和图像相关的基础功能（滤波，梯度，改变大小等），以及一些衍生的高级功能（图像分割，直方图，形态分析和边缘/直线提取等）。</p><p>-         
highgui：提供了用户界面和文件读取的基本函数，比如图像显示窗口的生成和控制，图像/视频文件的IO等。</p><p>如果不考虑视频应用，以上三个就是最核心和常用的模块了。针对视频和一些特别的视觉应用，OpenCV也提供了强劲的支持：</p><p>-         
video：用于视频分析的常用功能，比如光流法（Optical Flow）和目标跟踪等。</p><p>-         
calib3d：三维重建，立体视觉和相机标定等的相关功能。</p><p>-         
features2d：二维特征相关的功能，主要是一些不受专利保护的，商业友好的特征点检测和匹配等功能，比如ORB特征。</p><p>-         
object：目标检测模块，包含级联分类和Latent SVM</p><p>-         
ml：机器学习算法模块，包含一些视觉中最常用的传统机器学习算法。</p><p>-         
flann：最近邻算法库，Fast Library for Approximate
Nearest Neighbors，用于在多维空间进行聚类和检索，经常和关键点匹配搭配使用。</p><p>-         
gpu：包含了一些gpu加速的接口，底层的加速是CUDA实现。</p><p>-         
photo：计算摄像学（Computational Photography）相关的接口，当然这只是个名字，其实只有图像修复和降噪而已。</p><p>-         
stitching：图像拼接模块，有了它可以自己生成全景照片。</p><p>-         
nonfree：受到专利保护的一些算法，其实就是SIFT和SURF。</p><p>-         
contrib：一些实验性质的算法，考虑在未来版本中加入的。</p><p>-         
legacy：字面是遗产，意思就是废弃的一些接口，保留是考虑到向下兼容。</p><p>-         
ocl：利用OpenCL并行加速的一些接口。</p><p>-         
superres：超分辨率模块，其实就是BTV-L1（Biliteral Total Variation – L1
regularization）算法</p><p>-         
viz：基础的3D渲染模块，其实底层就是著名的3D工具包VTK（Visualization Toolkit）。</p><p>从使用的角度来看，和OpenCV2相比，OpenCV3的主要变化是更多的功能和更细化的模块划分。</p><h2>6.1.2
安装和使用OpenCV</h2><p>作为最流行的视觉包，在Linux中安装OpenCV是非常方便的，大多数Linux的发行版都支持包管理器的安装，比如在Ubuntu 16.04 LTS中，只需要在终端中输入：</p><p>&gt;&gt; sudo apt install libopencv-dev
  python-opencv</p><p>当然也可以通过官网下载源码编译安装，第一步先安装各种依赖：</p><p>&gt;&gt;
  sudo apt install build-essential</p><p>&gt;&gt;
  sudo apt install cmake git libgtk2.0-dev pkg-config libavcodec-dev
  libavformat-dev libswscale-dev</p><p>&gt;&gt;
  sudo apt-get install python-dev python-numpy libtbb2 libtbb-dev libjpeg-dev
  libpng-dev libtiff-dev libjasper-dev libdc1394-22-dev</p><p>然后找一个clone压缩包的文件夹，把源码拿下来：</p><p>&gt;&gt; git clone
  <a href="http://link.zhihu.com/?target=https%3A//github.com/opencv/opencv.git" class=" wrap external" target="_blank" rel="nofollow noreferrer" data-za-detail-view-id="1043">opencv/opencv</a></p><p>然后进入OpenCV文件夹：</p><p>&gt;&gt; mkdir release</p><p>&gt;&gt; cd release</p><p>&gt;&gt; cmake -D
  CMAKE_BUILD_TYPE=RELEASE -D CMAKE_INSTALL_PREFIX=/usr/local ..</p><p>准备完毕，直接make并安装： </p><p>&gt;&gt; make</p><p>&gt;&gt; sudo make install</p><p>Windows下的安装也很简单，直接去OpenCV官网下载：</p><p><a href="http://link.zhihu.com/?target=http%3A//opencv.org/downloads.html" class=" wrap external" target="_blank" rel="nofollow noreferrer" data-za-detail-view-id="1043">DOWNLOADS | OpenCV</a></p><p>执行exe安装后，会在&lt;安装目录&gt;/build/python/2.7下发现一个叫cv2.pyd的文件，把这个文件拷贝到&lt;Python目录&gt;\Lib\site-packages下，就可以了。Windows下如果只想在Python中体验OpenCV还有个更简单的方法是加州大学尔湾分校（University of
California, Irvine）的Christoph Gohlke制作的Windows下的Python科学计算包网页，下载对应版本的wheel文件，然后通过pip安装：</p><p><a href="http://link.zhihu.com/?target=http%3A//www.lfd.uci.edu/%7Egohlke/pythonlibs/%23opencv" class=" external" target="_blank" rel="nofollow noreferrer" data-za-detail-view-id="1043"><span class="invisible">http://www.</span><span class="visible">lfd.uci.edu/~gohlke/pyt</span><span class="invisible">honlibs/#opencv</span><span class="ellipsis"></span></a></p><p>本书只讲Python下OpenCV基本使用，Python中导入OpenCV非常简单：</p><div class="highlight"><pre><code class="language-python"><span></span><span class="kn">import</span> <span class="nn">cv2</span>
</code></pre></div><p>就导入成功了。
</p><h2>6.2 Python-OpenCV基础</h2><h2>6.2.1
图像的表示</h2><p>前面章节已经提到过了单通道的灰度图像在计算机中的表示，就是一个8位无符号整形的矩阵。在OpenCV的C++代码中，表示图像有个专门的结构叫做cv::Mat，不过在Python-OpenCV中，因为已经有了numpy这种强大的基础工具，所以这个矩阵就用numpy的array表示。如果是多通道情况，最常见的就是红绿蓝（RGB）三通道，则第一个维度是高度，第二个维度是高度，第三个维度是通道，比如图6-1a是一幅3×3图像在计算机中表示的例子：</p><figure><noscript>&lt;img src="https://pic3.zhimg.com/v2-9363ac86d8f4b9fde8fbef903851179c_b.jpg" data-rawwidth="1017" data-rawheight="701" class="origin_image zh-lightbox-thumb" width="1017" data-original="https://pic3.zhimg.com/v2-9363ac86d8f4b9fde8fbef903851179c_r.jpg"&gt;</noscript><span><div data-reactroot="" class="VagueImage origin_image zh-lightbox-thumb" data-src="https://pic3.zhimg.com/80/v2-9363ac86d8f4b9fde8fbef903851179c_hd.jpg" style="width: 660px; height: 454.926px;"><div class="VagueImage-mask is-active"></div></div></span></figure><p><b>图6-1 RGB图像在计算机中表示的例子</b></p><p>图6-1中，右上角的矩阵里每个元素都是一个3维数组，分别代表这个像素上的三个通道的值。最常见的RGB通道中，第一个元素就是红色（<b>R</b>ed）的值，第二个元素是绿色（<b>G</b>reen）的值，第三个元素是蓝色（<b>B</b>lue），最终得到的图像如6-1a所示。RGB是最常见的情况，然而在OpenCV中，默认的图像的表示确实反过来的，也就是BGR，得到的图像是6-1b。可以看到，前两行的颜色顺序都交换了，最后一行是三个通道等值的灰度图，所以没有影响。至于OpenCV为什么不是人民群众喜闻乐见的RGB，这是历史遗留问题，在OpenCV刚开始研发的年代，BGR是相机设备厂商的主流表示方法，虽然后来RGB成了主流和默认，但是这个底层的顺序却保留下来了，事实上Windows下的最常见格式之一bmp，底层字节的存储顺序还是BGR。OpenCV的这个特殊之处还是需要注意的，比如在Python中，图像都是用numpy的array表示，但是同样的array在OpenCV中的显示效果和matplotlib中的显示效果就会不一样。下面的简单代码就可以生成两种表示方式下，图6-1中矩阵的对应的图像，生成图像后，放大看就能体会到区别：</p><div class="highlight"><pre><code class="language-python"><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">cv2</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>

<span class="c1"># 图6-1中的矩阵</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="p">[[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">]],</span>
    <span class="p">[[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">]],</span>
    <span class="p">[[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">],</span> <span class="p">[</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span>
<span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>

<span class="c1"># 用matplotlib存储</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imsave</span><span class="p">(</span><span class="s1">'img_pyplot.jpg'</span><span class="p">,</span> <span class="n">img</span><span class="p">)</span>

<span class="c1"># 用OpenCV存储</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="s1">'img_cv2.jpg'</span><span class="p">,</span> <span class="n">img</span><span class="p">)</span>
</code></pre></div><p>不管是RGB还是BGR，都是高度×宽度×通道数，H×W×C的表达方式，而在深度学习中，因为要对不同通道应用卷积，所以用的是另一种方式：C×H×W，就是把每个通道都单独表达成一个二维矩阵，如图6-1c所示。</p><h2>6.2.2
基本图像处理</h2><p><b>存取图像</b></p><p>读图像用cv2.imread()，可以按照不同模式读取，一般最常用到的是读取单通道灰度图，或者直接默认读取多通道。存图像用cv2.imwrite()，注意存的时候是没有单通道这一说的，根据保存文件名的后缀和当前的array维度，OpenCV自动判断存的通道，另外压缩格式还可以指定存储质量，来看代码例子：</p><div class="highlight"><pre><code class="language-python"><span></span><span class="kn">import</span> <span class="nn">cv2</span>

<span class="c1"># 读取一张400x600分辨率的图像</span>
<span class="n">color_img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">'test_400x600.jpg'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">color_img</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="c1"># 直接读取单通道</span>
<span class="n">gray_img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">'test_400x600.jpg'</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">IMREAD_GRAYSCALE</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">gray_img</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="c1"># 把单通道图片保存后，再读取，仍然是3通道，相当于把单通道值复制到3个通道保存</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="s1">'test_grayscale.jpg'</span><span class="p">,</span> <span class="n">gray_img</span><span class="p">)</span>
<span class="n">reload_grayscale</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">'test_grayscale.jpg'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">reload_grayscale</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="c1"># cv2.IMWRITE_JPEG_QUALITY指定jpg质量，范围0到100，默认95，越高画质越好，文件越大</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="s1">'test_imwrite.jpg'</span><span class="p">,</span> <span class="n">color_img</span><span class="p">,</span> <span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">IMWRITE_JPEG_QUALITY</span><span class="p">,</span> <span class="mi">80</span><span class="p">))</span>

<span class="c1"># cv2.IMWRITE_PNG_COMPRESSION指定png质量，范围0到9，默认3，越高文件越小，画质越差</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="s1">'test_imwrite.png'</span><span class="p">,</span> <span class="n">color_img</span><span class="p">,</span> <span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">IMWRITE_PNG_COMPRESSION</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
</code></pre></div><p><b>缩放，裁剪和补边</b></p><p>缩放通过cv2.resize()实现，裁剪则是利用array自身的下标截取实现，此外OpenCV还可以给图像补边，这样能对一幅图像的形状和感兴趣区域实现各种操作。下面的例子中读取一幅400×600分辨率的图片，并执行一些基础的操作：</p><div class="highlight"><pre><code class="language-python"><span></span><span class="kn">import</span> <span class="nn">cv2</span>

<span class="c1"># 读取一张四川大录古藏寨的照片</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">'tiger_tibet_village.jpg'</span><span class="p">)</span>

<span class="c1"># 缩放成200x200的方形图像</span>
<span class="n">img_200x200</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">))</span>

<span class="c1"># 不直接指定缩放后大小，通过fx和fy指定缩放比例，0.5则长宽都为原来一半</span>
<span class="c1"># 等效于img_200x300 = cv2.resize(img, (300, 200))，注意指定大小的格式是(宽度,高度)</span>
<span class="c1"># 插值方法默认是cv2.INTER_LINEAR，这里指定为最近邻插值</span>
<span class="n">img_200x300</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">fx</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">fy</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> 
                              <span class="n">interpolation</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">INTER_NEAREST</span><span class="p">)</span>

<span class="c1"># 在上张图片的基础上，上下各贴50像素的黑边，生成300x300的图像</span>
<span class="n">img_300x300</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">copyMakeBorder</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> 
                                       <span class="n">cv2</span><span class="o">.</span><span class="n">BORDER_CONSTANT</span><span class="p">,</span> 
                                       <span class="n">value</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

<span class="c1"># 对照片中树的部分进行剪裁</span>
<span class="n">patch_tree</span> <span class="o">=</span> <span class="n">img</span><span class="p">[</span><span class="mi">20</span><span class="p">:</span><span class="mi">150</span><span class="p">,</span> <span class="o">-</span><span class="mi">180</span><span class="p">:</span><span class="o">-</span><span class="mi">50</span><span class="p">]</span>

<span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="s1">'cropped_tree.jpg'</span><span class="p">,</span> <span class="n">patch_tree</span><span class="p">)</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="s1">'resized_200x200.jpg'</span><span class="p">,</span> <span class="n">img_200x200</span><span class="p">)</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="s1">'resized_200x300.jpg'</span><span class="p">,</span> <span class="n">img_200x300</span><span class="p">)</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="s1">'bordered_300x300.jpg'</span><span class="p">,</span> <span class="n">img_300x300</span><span class="p">)</span>
</code></pre></div><p>这些处理的效果见图6-2。</p><p><b>色调，明暗，直方图和Gamma曲线</b></p><p>除了区域，图像本身的属性操作也非常多，比如可以通过HSV空间对色调和明暗进行调节。HSV空间是由美国的图形学专家A. R. Smith提出的一种颜色空间，HSV分别是色调（<b>H</b>ue），饱和度（<b>S</b>aturation）和明度（<b>V</b>alue）。在HSV空间中进行调节就避免了直接在RGB空间中调节是还需要考虑三个通道的相关性。OpenCV中H的取值是[0, 180)，其他两个通道的取值都是[0, 256)，下面例子接着上面例子代码，通过HSV空间对图像进行调整：</p><div class="highlight"><pre><code class="language-python"><span></span><span class="c1"># 通过cv2.cvtColor把图像从BGR转换到HSV</span>
<span class="n">img_hsv</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2HSV</span><span class="p">)</span>

<span class="c1"># H空间中，绿色比黄色的值高一点，所以给每个像素+15，黄色的树叶就会变绿</span>
<span class="n">turn_green_hsv</span> <span class="o">=</span> <span class="n">img_hsv</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">turn_green_hsv</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">turn_green_hsv</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">15</span><span class="p">)</span> <span class="o">%</span> <span class="mi">180</span>
<span class="n">turn_green_img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">turn_green_hsv</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_HSV2BGR</span><span class="p">)</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="s1">'turn_green.jpg'</span><span class="p">,</span> <span class="n">turn_green_img</span><span class="p">)</span>

<span class="c1"># 减小饱和度会让图像损失鲜艳，变得更灰</span>
<span class="n">colorless_hsv</span> <span class="o">=</span> <span class="n">img_hsv</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">colorless_hsv</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">colorless_hsv</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">colorless_img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">colorless_hsv</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_HSV2BGR</span><span class="p">)</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="s1">'colorless.jpg'</span><span class="p">,</span> <span class="n">colorless_img</span><span class="p">)</span>

<span class="c1"># 减小明度为原来一半</span>
<span class="n">darker_hsv</span> <span class="o">=</span> <span class="n">img_hsv</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">darker_hsv</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">darker_hsv</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">]</span>
<span class="n">darker_img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">darker_hsv</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_HSV2BGR</span><span class="p">)</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="s1">'darker.jpg'</span><span class="p">,</span> <span class="n">darker_img</span><span class="p">)</span>
</code></pre></div><p>无论是HSV还是RGB，我们都较难一眼就对像素中值的分布有细致的了解，这时候就需要直方图。如果直方图中的成分过于靠近0或者255，可能就出现了暗部细节不足或者亮部细节丢失的情况。比如图6-2中，背景里的暗部细节是非常弱的。这个时候，一个常用方法是考虑用Gamma变换来提升暗部细节。Gamma变换是矫正相机直接成像和人眼感受图像差别的一种常用手段，简单来说就是通过非线性变换让图像从对曝光强度的线性响应变得更接近人眼感受到的响应。具体的定义和实现，还是接着上面代码中读取的图片，执行计算直方图和Gamma变换的代码如下：</p><div class="highlight"><pre><code class="language-python"><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="c1"># 分通道计算每个通道的直方图</span>
<span class="n">hist_b</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">calcHist</span><span class="p">([</span><span class="n">img</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">None</span><span class="p">,</span> <span class="p">[</span><span class="mi">256</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">256</span><span class="p">])</span>
<span class="n">hist_g</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">calcHist</span><span class="p">([</span><span class="n">img</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">None</span><span class="p">,</span> <span class="p">[</span><span class="mi">256</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">256</span><span class="p">])</span>
<span class="n">hist_r</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">calcHist</span><span class="p">([</span><span class="n">img</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="bp">None</span><span class="p">,</span> <span class="p">[</span><span class="mi">256</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">256</span><span class="p">])</span>

<span class="c1"># 定义Gamma矫正的函数</span>
<span class="k">def</span> <span class="nf">gamma_trans</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">gamma</span><span class="p">):</span>
    <span class="c1"># 具体做法是先归一化到1，然后gamma作为指数值求出新的像素值再还原</span>
    <span class="n">gamma_table</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="mf">255.0</span><span class="p">,</span> <span class="n">gamma</span><span class="p">)</span><span class="o">*</span><span class="mf">255.0</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">)]</span>
    <span class="n">gamma_table</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gamma_table</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
    
    <span class="c1"># 实现这个映射用的是OpenCV的查表函数</span>
    <span class="k">return</span> <span class="n">cv2</span><span class="o">.</span><span class="n">LUT</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">gamma_table</span><span class="p">)</span>

<span class="c1"># 执行Gamma矫正，小于1的值让暗部细节大量提升，同时亮部细节少量提升</span>
<span class="n">img_corrected</span> <span class="o">=</span> <span class="n">gamma_trans</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="s1">'gamma_corrected.jpg'</span><span class="p">,</span> <span class="n">img_corrected</span><span class="p">)</span>

<span class="c1"># 分通道计算Gamma矫正后的直方图</span>
<span class="n">hist_b_corrected</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">calcHist</span><span class="p">([</span><span class="n">img_corrected</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">None</span><span class="p">,</span> <span class="p">[</span><span class="mi">256</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">256</span><span class="p">])</span>
<span class="n">hist_g_corrected</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">calcHist</span><span class="p">([</span><span class="n">img_corrected</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">None</span><span class="p">,</span> <span class="p">[</span><span class="mi">256</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">256</span><span class="p">])</span>
<span class="n">hist_r_corrected</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">calcHist</span><span class="p">([</span><span class="n">img_corrected</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="bp">None</span><span class="p">,</span> <span class="p">[</span><span class="mi">256</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">256</span><span class="p">])</span>

<span class="c1"># 将直方图进行可视化</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>

<span class="n">pix_hists</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="n">hist_b</span><span class="p">,</span> <span class="n">hist_g</span><span class="p">,</span> <span class="n">hist_r</span><span class="p">],</span>
    <span class="p">[</span><span class="n">hist_b_corrected</span><span class="p">,</span> <span class="n">hist_g_corrected</span><span class="p">,</span> <span class="n">hist_r_corrected</span><span class="p">]</span>
<span class="p">]</span>

<span class="n">pix_vals</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">)</span>
<span class="k">for</span> <span class="n">sub_plt</span><span class="p">,</span> <span class="n">pix_hist</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="mi">121</span><span class="p">,</span> <span class="mi">122</span><span class="p">],</span> <span class="n">pix_hists</span><span class="p">):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">sub_plt</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">'3d'</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">channel_hist</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="s1">'b'</span><span class="p">,</span> <span class="s1">'g'</span><span class="p">,</span> <span class="s1">'r'</span><span class="p">],</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">pix_hist</span><span class="p">):</span>
        <span class="n">cs</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">*</span> <span class="mi">256</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">pix_vals</span><span class="p">,</span> <span class="n">channel_hist</span><span class="p">,</span> <span class="n">zs</span><span class="o">=</span><span class="n">z</span><span class="p">,</span> <span class="n">zdir</span><span class="o">=</span><span class="s1">'y'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">cs</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.618</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'none'</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">'Pixel Values'</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">256</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'Channels'</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">'Counts'</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div><p>上面三段代码的结果统一放在下图中：</p><p><br></p><figure><noscript>&lt;img src="https://pic2.zhimg.com/v2-d82f3fa13fc8c2b31fb3bc3ffc8a6617_b.jpg" data-rawwidth="632" data-rawheight="760" class="origin_image zh-lightbox-thumb" width="632" data-original="https://pic2.zhimg.com/v2-d82f3fa13fc8c2b31fb3bc3ffc8a6617_r.jpg"&gt;</noscript><span><div data-reactroot="" class="VagueImage origin_image zh-lightbox-thumb" data-src="https://pic2.zhimg.com/80/v2-d82f3fa13fc8c2b31fb3bc3ffc8a6617_hd.jpg" style="width: 632px; height: 760px;"><div class="VagueImage-mask is-active"></div></div></span></figure><p>可以看到，Gamma变换后的暗部细节比起原图清楚了很多，并且从直方图来看，像素值也从集中在0附近变得散开了一些。</p><h2>6.2.3
图像的仿射变换</h2><p>图像的仿射变换涉及到图像的形状位置角度的变化，是深度学习预处理中常到的功能，在此简单回顾一下。仿射变换具体到图像中的应用，主要是对图像的<b>缩放</b>，<b>旋转</b>，<b>剪切</b>，<b>翻转</b>和<b>平移</b>的组合。在OpenCV中，仿射变换的矩阵是一个2×3的矩阵，其中左边的2×2子矩阵是线性变换矩阵，右边的2×1的两项是平移项：</p><p><img src="./给深度学习入门者的Python快速教程 - 番外篇之Python-OpenCV_files/equation" alt="A=\begin{bmatrix} a_{00} &amp; a_{01}\\ a_{10} &amp; a_{11} \end{bmatrix} , B = \begin{bmatrix} b_{0}\\ b_{1} \end{bmatrix} " eeimg="1"></p><p><img src="./给深度学习入门者的Python快速教程 - 番外篇之Python-OpenCV_files/equation(1)" alt="M=\begin{bmatrix} A &amp; B \end{bmatrix} = \begin{bmatrix} a_{00} &amp; a_{01} &amp; b_{0}\\ a_{10} &amp; a_{11} &amp; b_{1} \end{bmatrix} " eeimg="1"></p><p>对于图像上的任一位置(x,y)，仿射变换执行的是如下的操作：</p><p><img src="./给深度学习入门者的Python快速教程 - 番外篇之Python-OpenCV_files/equation(2)" alt="T_{affine}=A\begin{bmatrix} x\\ y \end{bmatrix}+B=M\begin{bmatrix} x\\ y\\ 1 \end{bmatrix}" eeimg="1"></p><p>需要注意的是，对于图像而言，宽度方向是x，高度方向是y，坐标的顺序和图像像素对应下标一致。所以原点的位置不是左下角而是右上角，y的方向也不是向上，而是向下。在OpenCV中实现仿射变换是通过仿射变换矩阵和cv2.warpAffine()这个函数，还是通过代码来理解一下，例子中图片的分辨率为600×400：</p><div class="highlight"><pre><code class="language-python"><span></span><span class="kn">import</span> <span class="nn">cv2</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="c1"># 读取一张斯里兰卡拍摄的大象照片</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">'lanka_safari.jpg'</span><span class="p">)</span>

<span class="c1"># 沿着横纵轴放大1.6倍，然后平移(-150,-240)，最后沿原图大小截取，等效于裁剪并放大</span>
<span class="n">M_crop_elephant</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="p">[</span><span class="mf">1.6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">150</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.6</span><span class="p">,</span> <span class="o">-</span><span class="mi">240</span><span class="p">]</span>
<span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

<span class="n">img_elephant</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">warpAffine</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">M_crop_elephant</span><span class="p">,</span> <span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">600</span><span class="p">))</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="s1">'lanka_elephant.jpg'</span><span class="p">,</span> <span class="n">img_elephant</span><span class="p">)</span>

<span class="c1"># x轴的剪切变换，角度15°</span>
<span class="n">theta</span> <span class="o">=</span> <span class="mi">15</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span>
<span class="n">M_shear</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="mi">0</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

<span class="n">img_sheared</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">warpAffine</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">M_shear</span><span class="p">,</span> <span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">600</span><span class="p">))</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="s1">'lanka_safari_sheared.jpg'</span><span class="p">,</span> <span class="n">img_sheared</span><span class="p">)</span>

<span class="c1"># 顺时针旋转，角度15°</span>
<span class="n">M_rotate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="mi">0</span><span class="p">],</span>
    <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="mi">0</span><span class="p">]</span>
<span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

<span class="n">img_rotated</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">warpAffine</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">M_rotate</span><span class="p">,</span> <span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">600</span><span class="p">))</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="s1">'lanka_safari_rotated.jpg'</span><span class="p">,</span> <span class="n">img_rotated</span><span class="p">)</span>

<span class="c1"># 某种变换，具体旋转+缩放+旋转组合可以通过SVD分解理解</span>
<span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="o">-</span><span class="mi">400</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">100</span><span class="p">]</span>
<span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

<span class="n">img_transformed</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">warpAffine</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">600</span><span class="p">))</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="s1">'lanka_safari_transformed.jpg'</span><span class="p">,</span> <span class="n">img_transformed</span><span class="p">)</span>
</code></pre></div><p>代码实现的操作示意在下图中：</p><figure><noscript>&lt;img src="https://pic4.zhimg.com/v2-e614bc5a0604a14e4d4c6930ff46e1b2_b.jpg" data-rawwidth="1169" data-rawheight="915" class="origin_image zh-lightbox-thumb" width="1169" data-original="https://pic4.zhimg.com/v2-e614bc5a0604a14e4d4c6930ff46e1b2_r.jpg"&gt;</noscript><span><div data-reactroot="" class="VagueImage origin_image zh-lightbox-thumb" data-src="https://pic4.zhimg.com/80/v2-e614bc5a0604a14e4d4c6930ff46e1b2_hd.jpg" style="width: 660px; height: 516.595px;"><div class="VagueImage-mask is-active"></div></div></span></figure><h2>6.2.4
基本绘图</h2><p>OpenCV提供了各种绘图的函数，可以在画面上绘制线段，圆，矩形和多边形等，还可以在图像上指定位置打印文字，比如下面例子：
</p><div class="highlight"><pre><code class="language-python"><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">cv2</span>

<span class="c1"># 定义一块宽600，高400的画布，初始化为白色</span>
<span class="n">canvas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">400</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span> <span class="o">+</span> <span class="mi">255</span>

<span class="c1"># 画一条纵向的正中央的黑色分界线</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">canvas</span><span class="p">,</span> <span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">399</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

<span class="c1"># 画一条右半部份画面以150为界的横向分界线</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">canvas</span><span class="p">,</span> <span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">149</span><span class="p">),</span> <span class="p">(</span><span class="mi">599</span><span class="p">,</span> <span class="mi">149</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

<span class="c1"># 左半部分的右下角画个红色的圆</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span><span class="n">canvas</span><span class="p">,</span> <span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">),</span> <span class="mi">75</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="mi">5</span><span class="p">)</span>

<span class="c1"># 左半部分的左下角画个蓝色的矩形</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span><span class="n">canvas</span><span class="p">,</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">240</span><span class="p">),</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">360</span><span class="p">),</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">thickness</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="c1"># 定义两个三角形，并执行内部绿色填充</span>
<span class="n">triangles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="p">[(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">240</span><span class="p">),</span> <span class="p">(</span><span class="mi">145</span><span class="p">,</span> <span class="mi">333</span><span class="p">),</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">333</span><span class="p">)],</span>
    <span class="p">[(</span><span class="mi">60</span><span class="p">,</span> <span class="mi">180</span><span class="p">),</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">237</span><span class="p">),</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">237</span><span class="p">)]])</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">fillPoly</span><span class="p">(</span><span class="n">canvas</span><span class="p">,</span> <span class="n">triangles</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

<span class="c1"># 画一个黄色五角星</span>
<span class="c1"># 第一步通过旋转角度的办法求出五个顶点</span>
<span class="n">phi</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">5</span>
<span class="n">rotations</span> <span class="o">=</span> <span class="p">[[[</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="n">phi</span><span class="p">),</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="n">phi</span><span class="p">)],</span> <span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="n">phi</span><span class="p">)]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)]</span>
<span class="n">pentagram</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[[[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">+</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">rotations</span><span class="p">]]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>

<span class="c1"># 定义缩放倍数和平移向量把五角星画在左半部分画面的上方</span>
<span class="n">pentagram</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">pentagram</span> <span class="o">*</span> <span class="mi">80</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">160</span><span class="p">,</span> <span class="mi">120</span><span class="p">]))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>

<span class="c1"># 将5个顶点作为多边形顶点连线，得到五角星</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">polylines</span><span class="p">(</span><span class="n">canvas</span><span class="p">,</span> <span class="n">pentagram</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="mi">9</span><span class="p">)</span>

<span class="c1"># 按像素为间隔从左至右在画面右半部份的上方画出HSV空间的色调连续变化</span>
<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">302</span><span class="p">,</span> <span class="mi">600</span><span class="p">):</span>
    <span class="n">color_pixel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[[</span><span class="nb">round</span><span class="p">(</span><span class="mi">180</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mi">302</span><span class="p">)</span><span class="o">/</span><span class="mi">298</span><span class="p">),</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">]]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
    <span class="n">line_color</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">color_pixel</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_HSV2BGR</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">canvas</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">147</span><span class="p">),</span> <span class="n">line_color</span><span class="p">)</span>

<span class="c1"># 如果定义圆的线宽大于半斤，则等效于画圆点，随机在画面右下角的框内生成坐标</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">n_pts</span> <span class="o">=</span> <span class="mi">30</span>
<span class="n">pts_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">310</span><span class="p">,</span> <span class="mi">590</span><span class="p">,</span> <span class="n">n_pts</span><span class="p">)</span>
<span class="n">pts_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">160</span><span class="p">,</span> <span class="mi">390</span><span class="p">,</span> <span class="n">n_pts</span><span class="p">)</span>
<span class="n">pts</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">pts_x</span><span class="p">,</span> <span class="n">pts_y</span><span class="p">)</span>

<span class="c1"># 画出每个点，颜色随机</span>
<span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
    <span class="n">pt_color</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span><span class="n">canvas</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">pt_color</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

<span class="c1"># 在左半部分最上方打印文字</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">putText</span><span class="p">(</span><span class="n">canvas</span><span class="p">,</span>
            <span class="s1">'Python-OpenCV Drawing Example'</span><span class="p">,</span>
            <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">FONT_HERSHEY_SIMPLEX</span><span class="p">,</span>
            <span class="mf">0.5</span><span class="p">,</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="mi">1</span><span class="p">)</span>

<span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">'Example of basic drawing functions'</span><span class="p">,</span> <span class="n">canvas</span><span class="p">)</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">()</span>
</code></pre></div><p>执行这段代码得到如下的图像：
</p><figure><noscript>&lt;img src="https://pic1.zhimg.com/v2-e89c8ea16a8e3b72fc8a0c4dcbcc0e7b_b.jpg" data-rawwidth="600" data-rawheight="400" class="origin_image zh-lightbox-thumb" width="600" data-original="https://pic1.zhimg.com/v2-e89c8ea16a8e3b72fc8a0c4dcbcc0e7b_r.jpg"&gt;</noscript><span><div data-reactroot="" class="VagueImage origin_image zh-lightbox-thumb" data-src="https://pic1.zhimg.com/80/v2-e89c8ea16a8e3b72fc8a0c4dcbcc0e7b_hd.jpg" style="width: 600px; height: 400px;"><div class="VagueImage-mask is-active"></div></div></span></figure><h2>6.2.4
视频功能</h2><p>视频中最常用的就是从视频设备采集图片或者视频，或者读取视频文件并从中采样。所以比较重要的也是两个模块，一个是VideoCapture，用于获取相机设备并捕获图像和视频，或是从文件中捕获。还有一个VideoWriter，用于生成视频。还是来看例子理解这两个功能的用法，首先是一个制作延时摄影视频的小例子：</p><div class="highlight"><pre><code class="language-python"><span></span><span class="kn">import</span> <span class="nn">cv2</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="n">interval</span> <span class="o">=</span> <span class="mi">60</span>       	<span class="c1"># 捕获图像的间隔，单位：秒</span>
<span class="n">num_frames</span> <span class="o">=</span> <span class="mi">500</span>    	<span class="c1"># 捕获图像的总帧数</span>
<span class="n">out_fps</span> <span class="o">=</span> <span class="mi">24</span>        	<span class="c1"># 输出文件的帧率</span>

<span class="c1"># VideoCapture(0)表示打开默认的相机</span>
<span class="n">cap</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># 获取捕获的分辨率</span>
<span class="n">size</span> <span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">cap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">CAP_PROP_FRAME_WIDTH</span><span class="p">)),</span>
       <span class="nb">int</span><span class="p">(</span><span class="n">cap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">CAP_PROP_FRAME_HEIGHT</span><span class="p">)))</span>
       
<span class="c1"># 设置要保存视频的编码，分辨率和帧率</span>
<span class="n">video</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoWriter</span><span class="p">(</span>
    <span class="s2">"time_lapse.avi"</span><span class="p">,</span> 
    <span class="n">cv2</span><span class="o">.</span><span class="n">VideoWriter_fourcc</span><span class="p">(</span><span class="s1">'M'</span><span class="p">,</span><span class="s1">'P'</span><span class="p">,</span><span class="s1">'4'</span><span class="p">,</span><span class="s1">'2'</span><span class="p">),</span> 
    <span class="n">out_fps</span><span class="p">,</span> 
    <span class="n">size</span>
<span class="p">)</span>

<span class="c1"># 对于一些低画质的摄像头，前面的帧可能不稳定，略过</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">42</span><span class="p">):</span>
    <span class="n">cap</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="c1"># 开始捕获，通过read()函数获取捕获的帧</span>
<span class="k">try</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_frames</span><span class="p">):</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">cap</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">video</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>

        <span class="c1"># 如果希望把每一帧也存成文件，比如制作GIF，则取消下面的注释</span>
        <span class="c1"># filename = '{:0&gt;6d}.png'.format(i)</span>
        <span class="c1"># cv2.imwrite(filename, frame)</span>

        <span class="k">print</span><span class="p">(</span><span class="s1">'Frame {} is captured.'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">interval</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
    <span class="c1"># 提前停止捕获</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">'Stopped! {}/{} frames captured!'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">num_frames</span><span class="p">))</span>

<span class="c1"># 释放资源并写入视频文件</span>
<span class="n">video</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
<span class="n">cap</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
</code></pre></div><p>这个例子实现了延时摄影的功能，把程序打开并将摄像头对准一些缓慢变化的画面，比如桌上缓慢蒸发的水，或者正在生长的小草，就能制作出有趣的延时摄影作品。比如下面这个链接中的图片就是用这段程序生成的：</p><p><a href="http://link.zhihu.com/?target=http%3A//images.cnitblog.com/blog2015/609274/201503/251904209276278.gif" class=" external" target="_blank" rel="nofollow noreferrer" data-za-detail-view-id="1043"><span class="invisible">http://</span><span class="visible">images.cnitblog.com/blo</span><span class="invisible">g2015/609274/201503/251904209276278.gif</span><span class="ellipsis"></span></a></p><p>程序的结构非常清晰简单，注释里也写清楚了每一步，所以流程就不解释了。需要提一下的有两点：一个是VideoWriter中的一个函数cv2.VideoWriter_fourcc()。这个函数指定了视频编码的格式，比如例子中用的是MP42，也就是MPEG-4，更多编码方式可以在下面的地址查询：</p><p><a href="http://link.zhihu.com/?target=http%3A//www.fourcc.org/codecs.php" class=" wrap external" target="_blank" rel="nofollow noreferrer" data-za-detail-view-id="1043">Video Codecs by FOURCC</a></p><p>还有一个是KeyboardInterrupt，这是一个常用的异常，用来获取用户Ctrl+C的中止，捕获这个异常后直接结束循环并释放VideoCapture和VideoWriter的资源，使已经捕获好的部分视频可以顺利生成。</p><p>




从视频中截取帧也是处理视频时常见的任务，下面代码实现的是遍历一个指定文件夹下的所有视频并按照指定的间隔进行截屏并保存：
</p><div class="highlight"><pre><code class="language-python"><span></span><span class="kn">import</span> <span class="nn">cv2</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="c1"># 第一个输入参数是包含视频片段的路径</span>
<span class="n">input_path</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># 第二个输入参数是设定每隔多少帧截取一帧</span>
<span class="n">frame_interval</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

<span class="c1"># 列出文件夹下所有的视频文件</span>
<span class="n">filenames</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">input_path</span><span class="p">)</span>

<span class="c1"># 获取文件夹名称</span>
<span class="n">video_prefix</span> <span class="o">=</span> <span class="n">input_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># 建立一个新的文件夹，名称为原文件夹名称后加上_frames</span>
<span class="n">frame_path</span> <span class="o">=</span> <span class="s1">'{}_frames'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">input_path</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">frame_path</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">frame_path</span><span class="p">)</span>

<span class="c1"># 初始化一个VideoCapture对象</span>
<span class="n">cap</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">()</span>

<span class="c1"># 遍历所有文件</span>
<span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
    <span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">input_path</span><span class="p">,</span> <span class="n">filename</span><span class="p">])</span>
    
    <span class="c1"># VideoCapture::open函数可以从文件获取视频</span>
    <span class="n">cap</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
    
    <span class="c1"># 获取视频帧数</span>
    <span class="n">n_frames</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">CAP_PROP_FRAME_COUNT</span><span class="p">))</span>

    <span class="c1"># 同样为了避免视频头几帧质量低下，黑屏或者无关等</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">42</span><span class="p">):</span>
        <span class="n">cap</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_frames</span><span class="p">):</span>
        <span class="n">ret</span><span class="p">,</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">cap</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        
        <span class="c1"># 每隔frame_interval帧进行一次截屏操作</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="n">frame_interval</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">imagename</span> <span class="o">=</span> <span class="s1">'{}_{}_{:0&gt;6d}.jpg'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">video_prefix</span><span class="p">,</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'.'</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">i</span><span class="p">)</span>
            <span class="n">imagepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">frame_path</span><span class="p">,</span> <span class="n">imagename</span><span class="p">])</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">'exported {}!'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">imagepath</span><span class="p">))</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="n">imagepath</span><span class="p">,</span> <span class="n">frame</span><span class="p">)</span>

<span class="c1"># 执行结束释放资源</span>
<span class="n">cap</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
</code></pre></div><h2>6.3 用OpenCV实现数据增加小工具</h2><p>到目前我们已经熟悉了numpy中的随机模块，多进程调用和OpenCV的基本操作，基于这些基础，本节将从思路到代码一步步实现一个最基本的数据增加小工具。</p><p>第三章和第四章都提到过数据增加（data augmentation），作为一种深度学习中的常用手段，数据增加对模型的泛化性和准确性都有帮助。数据增加的具体使用方式一般有两种，一种是实时增加，比如在Caffe中加入数据扰动层，每次图像都先经过扰动操作，再去训练，这样训练经过几代（epoch）之后，就等效于数据增加。还有一种是更加直接简单一些的，就是在训练之前就通过图像处理手段对数据样本进行扰动和增加，也就是本节要实现的。</p><p>这个例子中将包含三种基本类型的扰动：随机裁剪，随机旋转和随机颜色/明暗。</p><h2>6.3.1
随机裁剪</h2><p>AlexNet中已经讲过了随机裁剪的基本思路，我们的小例子中打算更进一步：在裁剪的时候考虑图像宽高比的扰动。在绝大多数用于分类的图片中，样本进入网络前都是要变为统一大小，所以宽高比扰动相当于对物体的横向和纵向进行了缩放，这样除了物体的位置扰动，又多出了一项扰动。只要变化范围控制合适，目标物体始终在画面内，这种扰动是有助于提升泛化性能的。实现这种裁剪的思路如下图所示：
</p><figure><noscript>&lt;img src="https://pic1.zhimg.com/v2-8643baac95bd135cd5ffac3b6d1a0c7a_b.jpg" data-rawwidth="1164" data-rawheight="444" class="origin_image zh-lightbox-thumb" width="1164" data-original="https://pic1.zhimg.com/v2-8643baac95bd135cd5ffac3b6d1a0c7a_r.jpg"&gt;</noscript><span><div data-reactroot="" class="VagueImage origin_image zh-lightbox-thumb" data-src="https://pic1.zhimg.com/80/v2-8643baac95bd135cd5ffac3b6d1a0c7a_hd.jpg" style="width: 660px; height: 251.753px;"><div class="VagueImage-mask is-active"></div></div></span></figure><p>图中最左边是一幅需要剪裁的画面，首先根据这幅画面我们可以算出一个宽高比w/h。然后设定一个小的扰动范围δ和要裁剪的画面占原画面的比例β，从-<img src="./给深度学习入门者的Python快速教程 - 番外篇之Python-OpenCV_files/equation(3)" alt="\delta" eeimg="1">到<img src="./给深度学习入门者的Python快速教程 - 番外篇之Python-OpenCV_files/equation(3)" alt="\delta" eeimg="1">之间按均匀采样，获取一个随机数<img src="./给深度学习入门者的Python快速教程 - 番外篇之Python-OpenCV_files/equation(4)" alt="\hat \delta" eeimg="1">作为裁剪后画面的宽高比扰动的比例，则裁剪后画面的宽和高分别为：</p><p><img src="./给深度学习入门者的Python快速教程 - 番外篇之Python-OpenCV_files/equation(5)" alt="w&#39;=w\sqrt {\beta(1+ \hat\delta)}" eeimg="1"></p><p><img src="./给深度学习入门者的Python快速教程 - 番外篇之Python-OpenCV_files/equation(6)" alt="h&#39;=h\sqrt {\frac \beta {1+ \hat\delta}}" eeimg="1"></p><p>想象一下先把这个宽为w’，高为h’的区域置于原画面的右下角，则这个区域的左上角和原画面的左上角框出的小区域，如图中的虚线框所示，就是裁剪后区域左上角可以取值的范围。所以在这个区域内随机采一点作为裁剪区域的左上角，就实现了如图中位置随机，且宽高比也随机的裁剪。</p><h2>6.3.2
随机旋转</h2><p>前面讲到过的旋转比起来，做数据增加时，一般希望旋转是沿着画面的中心。这样除了要知道旋转角度，还得计算平移的量才能让仿射变换的效果等效于旋转轴在画面中心，好在OpenCV中有现成的函数cv2.getRotationMatrix2D()可以使用。这个函数的第一个参数是旋转中心，第二个参数是逆时针旋转角度，第三个参数是缩放倍数，对于只是旋转的情况下这个值是1，返回值就是做仿射变换的矩阵。</p><p>




直接用这个函数并接着使用cv2.warpAffine()会有一个潜在的问题，就是旋转之后会出现黑边。如果要旋转后的画面不包含黑边，就得沿着原来画面的轮廓做个内接矩形，该矩形的宽高比和原画面相同，如下图所示：
</p><figure><noscript>&lt;img src="https://pic4.zhimg.com/v2-8e2c7867c54bd1ef7d5afba1285acab8_b.jpg" data-rawwidth="552" data-rawheight="631" class="origin_image zh-lightbox-thumb" width="552" data-original="https://pic4.zhimg.com/v2-8e2c7867c54bd1ef7d5afba1285acab8_r.jpg"&gt;</noscript><span><div data-reactroot="" class="VagueImage origin_image zh-lightbox-thumb" data-src="https://pic4.zhimg.com/80/v2-8e2c7867c54bd1ef7d5afba1285acab8_hd.jpg" style="width: 552px; height: 631px;"><div class="VagueImage-mask is-active"></div></div></span></figure><p>在图中，可以看到，限制内接矩形大小的主要是原画面更靠近中心的那条边，也就是图中比较长的一条边AB。因此我们只要沿着中心O和内接矩形的顶点方向的直线，求出和AB的交点P，就得到了内接矩形的大小。先来看长边的方程，考虑之前画面和横轴相交的点，经过角度-θ旋转后，到了图中的Q点所在：
<img src="./给深度学习入门者的Python快速教程 - 番外篇之Python-OpenCV_files/equation(7)" alt="\begin{bmatrix} x_{Q} \\ y_{Q} \end{bmatrix}=\begin{bmatrix} \cos(-\theta) &amp; -\cos(-\theta)\\ \sin(-\theta) &amp; \cos(-\theta) \end{bmatrix} \begin{bmatrix} - \frac w 2\\ 0 \end{bmatrix}= \begin{bmatrix} - \frac w 2 \cos(\theta)\\ \frac w 2 \sin(\theta) \end{bmatrix} " eeimg="1"></p><p>因为长边所在直线过Q点，且斜率为1/tan(θ)，所以有：
</p><p><img src="./给深度学习入门者的Python快速教程 - 番外篇之Python-OpenCV_files/equation(8)" alt="\frac {y-\frac w 2\sin(\theta)} {x+\frac w 2\cos(\theta)}=\frac 1 {\tan(\theta)}" eeimg="1"></p><p>这时候考虑OP这条直线：</p><p><img src="./给深度学习入门者的Python快速教程 - 番外篇之Python-OpenCV_files/equation(9)" alt="y=-\frac h wx" eeimg="1"></p><p>把这个公式带入再前边一个公式，求解可以得到：</p><p><img src="./给深度学习入门者的Python快速教程 - 番外篇之Python-OpenCV_files/equation(10)" alt="x=-\frac w 2 \cdot \frac {\cos(\theta)+\sin(\theta)\tan(\theta)} {\frac h w \tan(\theta)+1}" eeimg="1"></p><p>注意到在这个问题中，每个象限和相邻象限都是轴对称的，而且旋转角度对剪裁宽度和长度的影响是周期（T=π）变化，再加上我们关心的其实并不是四个点的位置，而是旋转后要截取的矩形的宽w’和高h’，所以复杂的分区间情况也简化了，首先对于旋转角度，因为周期为π，所以都可以化到0到π之间，然后因为对称性，进一步有：
</p><p><img src="./给深度学习入门者的Python快速教程 - 番外篇之Python-OpenCV_files/equation(11)" alt="\theta=\begin{cases} \theta, &amp; \text{if $\theta \leq \frac \pi 2$} \\ \pi-\theta, &amp; \text{else} \end{cases}" eeimg="1"></p><p>于是对于0到π/2之间的θ，有：
</p><p><img src="./给深度学习入门者的Python快速教程 - 番外篇之Python-OpenCV_files/equation(12)" alt="r=\begin{cases} h/w, &amp; \text{if h$&gt;$w} \\ w/h, &amp; \text{else} \end{cases}" eeimg="1"></p><p><img src="./给深度学习入门者的Python快速教程 - 番外篇之Python-OpenCV_files/equation(13)" alt="\beta=\frac {\cos(\theta)+\sin(\theta)\tan(\theta)} {r\tan(\theta)+1}" eeimg="1"></p><p><img src="./给深度学习入门者的Python快速教程 - 番外篇之Python-OpenCV_files/equation(14)" alt="w&#39;=\beta w" eeimg="1"></p><p><img src="./给深度学习入门者的Python快速教程 - 番外篇之Python-OpenCV_files/equation(15)" alt="h&#39;=\beta h" eeimg="1"></p><p>当然需要注意的是，对于宽高比非常大或者非常小的图片，旋转后如果裁剪往往得到的画面是非常小的一部分，甚至不包含目标物体。所以是否需要旋转，以及是否需要裁剪，如果裁剪角度多少合适，都要视情况而定。</p><h2>6.3.3
随机颜色和明暗</h2><p>比起AlexNet论文里在PCA之后的主成分上做扰动的方法，本书用来实现随机的颜色以及明暗的方法相对简单很多，就是给HSV空间的每个通道，分别加上一个微小的扰动。其中对于色调，从-<img src="./给深度学习入门者的Python快速教程 - 番外篇之Python-OpenCV_files/equation(3)" alt="\delta" eeimg="1">到<img src="./给深度学习入门者的Python快速教程 - 番外篇之Python-OpenCV_files/equation(3)" alt="\delta" eeimg="1">之间按均匀采样，获取一个随机数<img src="./给深度学习入门者的Python快速教程 - 番外篇之Python-OpenCV_files/equation(4)" alt="\hat \delta" eeimg="1">作为要扰动的值，然后新的像素值x’为原始像素值x +<img src="./给深度学习入门者的Python快速教程 - 番外篇之Python-OpenCV_files/equation(4)" alt="\hat \delta" eeimg="1">；对于其他两个空间则是新像素值x’为原始像素值x的(1+<img src="./给深度学习入门者的Python快速教程 - 番外篇之Python-OpenCV_files/equation(4)" alt="\hat \delta" eeimg="1">)倍，从而实现色调，饱和度和明暗度的扰动。</p><p>因为明暗度并不会对图像的直方图相对分布产生大的影响，所以在HSV扰动基础上，考虑再加入一个Gamma扰动，方法是设定一个大于1的Gamma值的上限γ，因为这个值通常会和1是一个量级，再用均匀采样的近似未必合适，所以从-logγ到logγ之间均匀采样一个值α，然后用<img src="./给深度学习入门者的Python快速教程 - 番外篇之Python-OpenCV_files/equation(16)" alt="e^{\alpha} " eeimg="1"></p><p>作为Gamma值进行变换。</p><h2>6.3.4
多进程调用加速处理</h2><p>做数据增加时如果样本量本身就不小，则处理起来可能会很耗费时间，所以可以考虑利用多进程并行处理。比如我们的例子中，设定使用场景是输入一个文件夹路径，该文件夹下包含了所有原始的数据样本。用户指定输出的文件夹和打算增加图片的总量。执行程序的时候，通过os.listdir()获取所有文件的路径，然后按照上一章讲过的多进程平均划分样本的办法，把文件尽可能均匀地分给不同进程，进行处理。</p><h2>6.3.5
代码：图片数据增加小工具</h2><p>按照前面4个部分的思路和方法，这节来实现这么一个图片数据增加小工具，首先对于一些基础的操作，我们定义在一个叫做image_augmentation.py的文件里：
</p><div class="highlight"><pre><code class="language-python"><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">cv2</span>

<span class="sd">'''</span>
<span class="sd">定义裁剪函数，四个参数分别是：</span>
<span class="sd">左上角横坐标x0</span>
<span class="sd">左上角纵坐标y0</span>
<span class="sd">裁剪宽度w</span>
<span class="sd">裁剪高度h</span>
<span class="sd">'''</span>
<span class="n">crop_image</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">img</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">:</span> <span class="n">img</span><span class="p">[</span><span class="n">y0</span><span class="p">:</span><span class="n">y0</span><span class="o">+</span><span class="n">h</span><span class="p">,</span> <span class="n">x0</span><span class="p">:</span><span class="n">x0</span><span class="o">+</span><span class="n">w</span><span class="p">]</span>

<span class="sd">'''</span>
<span class="sd">随机裁剪</span>
<span class="sd">area_ratio为裁剪画面占原画面的比例</span>
<span class="sd">hw_vari是扰动占原高宽比的比例范围</span>
<span class="sd">'''</span>
<span class="k">def</span> <span class="nf">random_crop</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">area_ratio</span><span class="p">,</span> <span class="n">hw_vari</span><span class="p">):</span>
    <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">hw_delta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="n">hw_vari</span><span class="p">,</span> <span class="n">hw_vari</span><span class="p">)</span>
    <span class="n">hw_mult</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">hw_delta</span>
	
	<span class="c1"># 下标进行裁剪，宽高必须是正整数</span>
    <span class="n">w_crop</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">w</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">area_ratio</span><span class="o">*</span><span class="n">hw_mult</span><span class="p">)))</span>
	
	<span class="c1"># 裁剪宽度不可超过原图可裁剪宽度</span>
    <span class="k">if</span> <span class="n">w_crop</span> <span class="o">&gt;</span> <span class="n">w</span><span class="p">:</span>
        <span class="n">w_crop</span> <span class="o">=</span> <span class="n">w</span>
		
    <span class="n">h_crop</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">h</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">area_ratio</span><span class="o">/</span><span class="n">hw_mult</span><span class="p">)))</span>
    <span class="k">if</span> <span class="n">h_crop</span> <span class="o">&gt;</span> <span class="n">h</span><span class="p">:</span>
        <span class="n">h_crop</span> <span class="o">=</span> <span class="n">h</span>
	
	<span class="c1"># 随机生成左上角的位置</span>
    <span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">w</span><span class="o">-</span><span class="n">w_crop</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">y0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">h</span><span class="o">-</span><span class="n">h_crop</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
	
    <span class="k">return</span> <span class="n">crop_image</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">w_crop</span><span class="p">,</span> <span class="n">h_crop</span><span class="p">)</span>

<span class="sd">'''</span>
<span class="sd">定义旋转函数：</span>
<span class="sd">angle是逆时针旋转的角度</span>
<span class="sd">crop是个布尔值，表明是否要裁剪去除黑边</span>
<span class="sd">'''</span>
<span class="k">def</span> <span class="nf">rotate_image</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">crop</span><span class="p">):</span>
    <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
	
	<span class="c1"># 旋转角度的周期是360°</span>
    <span class="n">angle</span> <span class="o">%=</span> <span class="mi">360</span>
	
	<span class="c1"># 用OpenCV内置函数计算仿射矩阵</span>
    <span class="n">M_rotate</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">getRotationMatrix2D</span><span class="p">((</span><span class="n">w</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">h</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">angle</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
	
	<span class="c1"># 得到旋转后的图像</span>
    <span class="n">img_rotated</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">warpAffine</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">M_rotate</span><span class="p">,</span> <span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">))</span>

	<span class="c1"># 如果需要裁剪去除黑边</span>
    <span class="k">if</span> <span class="n">crop</span><span class="p">:</span>
	    <span class="c1"># 对于裁剪角度的等效周期是180°</span>
        <span class="n">angle_crop</span> <span class="o">=</span> <span class="n">angle</span> <span class="o">%</span> <span class="mi">180</span>
		
		<span class="c1"># 并且关于90°对称</span>
        <span class="k">if</span> <span class="n">angle_crop</span> <span class="o">&gt;</span> <span class="mi">90</span><span class="p">:</span>
            <span class="n">angle_crop</span> <span class="o">=</span> <span class="mi">180</span> <span class="o">-</span> <span class="n">angle_crop</span>
			
		<span class="c1"># 转化角度为弧度</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">angle_crop</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.0</span>
		
		<span class="c1"># 计算高宽比</span>
        <span class="n">hw_ratio</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">h</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
		
		<span class="c1"># 计算裁剪边长系数的分子项</span>
        <span class="n">tan_theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="n">numerator</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">*</span> <span class="n">tan_theta</span>
		
		<span class="c1"># 计算分母项中和宽高比相关的项</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">hw_ratio</span> <span class="k">if</span> <span class="n">h</span> <span class="o">&gt;</span> <span class="n">w</span> <span class="k">else</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">hw_ratio</span>
		
		<span class="c1"># 计算分母项</span>
        <span class="n">denominator</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">tan_theta</span> <span class="o">+</span> <span class="mi">1</span>
		
		<span class="c1"># 计算最终的边长系数</span>
        <span class="n">crop_mult</span> <span class="o">=</span> <span class="n">numerator</span> <span class="o">/</span> <span class="n">denominator</span>
		
		<span class="c1"># 得到裁剪区域</span>
        <span class="n">w_crop</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">crop_mult</span><span class="o">*</span><span class="n">w</span><span class="p">))</span>
        <span class="n">h_crop</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">crop_mult</span><span class="o">*</span><span class="n">h</span><span class="p">))</span>
        <span class="n">x0</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">w</span><span class="o">-</span><span class="n">w_crop</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">y0</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">h</span><span class="o">-</span><span class="n">h_crop</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">img_rotated</span> <span class="o">=</span> <span class="n">crop_image</span><span class="p">(</span><span class="n">img_rotated</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">w_crop</span><span class="p">,</span> <span class="n">h_crop</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">img_rotated</span>

<span class="sd">'''</span>
<span class="sd">随机旋转</span>
<span class="sd">angle_vari是旋转角度的范围[-angle_vari, angle_vari)</span>
<span class="sd">p_crop是要进行去黑边裁剪的比例</span>
<span class="sd">'''</span>
<span class="k">def</span> <span class="nf">random_rotate</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">angle_vari</span><span class="p">,</span> <span class="n">p_crop</span><span class="p">):</span>
    <span class="n">angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="n">angle_vari</span><span class="p">,</span> <span class="n">angle_vari</span><span class="p">)</span>
    <span class="n">crop</span> <span class="o">=</span> <span class="bp">False</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">p_crop</span> <span class="k">else</span> <span class="bp">True</span>
    <span class="k">return</span> <span class="n">rotate_image</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">crop</span><span class="p">)</span>

<span class="sd">'''</span>
<span class="sd">定义hsv变换函数：</span>
<span class="sd">hue_delta是色调变化比例</span>
<span class="sd">sat_delta是饱和度变化比例</span>
<span class="sd">val_delta是明度变化比例</span>
<span class="sd">'''</span>
<span class="k">def</span> <span class="nf">hsv_transform</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">hue_delta</span><span class="p">,</span> <span class="n">sat_mult</span><span class="p">,</span> <span class="n">val_mult</span><span class="p">):</span>
    <span class="n">img_hsv</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2HSV</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
    <span class="n">img_hsv</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">img_hsv</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">hue_delta</span><span class="p">)</span> <span class="o">%</span> <span class="mi">180</span>
    <span class="n">img_hsv</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*=</span> <span class="n">sat_mult</span>
    <span class="n">img_hsv</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*=</span> <span class="n">val_mult</span>
    <span class="n">img_hsv</span><span class="p">[</span><span class="n">img_hsv</span> <span class="o">&gt;</span> <span class="mi">255</span><span class="p">]</span> <span class="o">=</span> <span class="mi">255</span>
    <span class="k">return</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">img_hsv</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">),</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_HSV2BGR</span><span class="p">)</span>

<span class="sd">'''</span>
<span class="sd">随机hsv变换</span>
<span class="sd">hue_vari是色调变化比例的范围</span>
<span class="sd">sat_vari是饱和度变化比例的范围</span>
<span class="sd">val_vari是明度变化比例的范围</span>
<span class="sd">'''</span>
<span class="k">def</span> <span class="nf">random_hsv_transform</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">hue_vari</span><span class="p">,</span> <span class="n">sat_vari</span><span class="p">,</span> <span class="n">val_vari</span><span class="p">):</span>
    <span class="n">hue_delta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="n">hue_vari</span><span class="p">,</span> <span class="n">hue_vari</span><span class="p">)</span>
    <span class="n">sat_mult</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="n">sat_vari</span><span class="p">,</span> <span class="n">sat_vari</span><span class="p">)</span>
    <span class="n">val_mult</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="n">val_vari</span><span class="p">,</span> <span class="n">val_vari</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">hsv_transform</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">hue_delta</span><span class="p">,</span> <span class="n">sat_mult</span><span class="p">,</span> <span class="n">val_mult</span><span class="p">)</span>

<span class="sd">'''</span>
<span class="sd">定义gamma变换函数：</span>
<span class="sd">gamma就是Gamma</span>
<span class="sd">'''</span>
<span class="k">def</span> <span class="nf">gamma_transform</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">gamma</span><span class="p">):</span>
    <span class="n">gamma_table</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="mf">255.0</span><span class="p">,</span> <span class="n">gamma</span><span class="p">)</span> <span class="o">*</span> <span class="mf">255.0</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">)]</span>
    <span class="n">gamma_table</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gamma_table</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cv2</span><span class="o">.</span><span class="n">LUT</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">gamma_table</span><span class="p">)</span>

<span class="sd">'''</span>
<span class="sd">随机gamma变换</span>
<span class="sd">gamma_vari是Gamma变化的范围[1/gamma_vari, gamma_vari)</span>
<span class="sd">'''</span>
<span class="k">def</span> <span class="nf">random_gamma_transform</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">gamma_vari</span><span class="p">):</span>
    <span class="n">log_gamma_vari</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">gamma_vari</span><span class="p">)</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="n">log_gamma_vari</span><span class="p">,</span> <span class="n">log_gamma_vari</span><span class="p">)</span>
    <span class="n">gamma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">gamma_transform</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">gamma</span><span class="p">)</span>
</code></pre></div><p>调用这些函数需要通过一个主程序。这个主程序里首先定义三个子模块，定义一个函数parse_arg()通过Python的argparse模块定义了各种输入参数和默认值。需要注意的是这里用argparse来输入所有参数是因为参数总量并不是特别多，如果增加了更多的扰动方法，更合适的参数输入方式可能是通过一个配置文件。然后定义一个生成待处理图像列表的函数generate_image_list()，根据输入中要增加图片的数量和并行进程的数目尽可能均匀地为每个进程生成了需要处理的任务列表。执行随机扰动的代码定义在augment_images()中，这个函数是每个进程内进行实际处理的函数，执行顺序是镜像<img src="./给深度学习入门者的Python快速教程 - 番外篇之Python-OpenCV_files/equation(17)" alt="\rightarrow " eeimg="1">裁剪<img src="./给深度学习入门者的Python快速教程 - 番外篇之Python-OpenCV_files/equation(17)" alt="\rightarrow " eeimg="1">旋转<img src="./给深度学习入门者的Python快速教程 - 番外篇之Python-OpenCV_files/equation(17)" alt="\rightarrow " eeimg="1">HSV<img src="./给深度学习入门者的Python快速教程 - 番外篇之Python-OpenCV_files/equation(17)" alt="\rightarrow " eeimg="1">Gamma。需要注意的是镜像<img src="./给深度学习入门者的Python快速教程 - 番外篇之Python-OpenCV_files/equation(17)" alt="\rightarrow " eeimg="1">裁剪，因为只是个演示例子，这未必是一个合适的顺序。最后定义一个main函数进行调用，代码如下：
</p><div class="highlight"><pre><code class="language-python"><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Process</span>
<span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">cpu_count</span>

<span class="kn">import</span> <span class="nn">cv2</span>

<span class="c1"># 导入image_augmentation.py为一个可调用模块</span>
<span class="kn">import</span> <span class="nn">image_augmentation</span> <span class="kn">as</span> <span class="nn">ia</span>

<span class="c1"># 利用Python的argparse模块读取输入输出和各种扰动参数</span>
<span class="k">def</span> <span class="nf">parse_args</span><span class="p">():</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="s1">'A Simple Image Data Augmentation Tool'</span><span class="p">,</span>
        <span class="n">formatter_class</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentDefaultsHelpFormatter</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'input_dir'</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Directory containing images'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'output_dir'</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Directory for augmented images'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'num'</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Number of images to be augmented'</span><span class="p">,</span>
                        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'--num_procs'</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Number of processes for paralleled augmentation'</span><span class="p">,</span>
                        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">cpu_count</span><span class="p">())</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'--p_mirror'</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Ratio to mirror an image'</span><span class="p">,</span>
                        <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'--p_crop'</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Ratio to randomly crop an image'</span><span class="p">,</span>
                        <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'--crop_size'</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'The ratio of cropped image size to original image size, in area'</span><span class="p">,</span>
                        <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'--crop_hw_vari'</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Variation of h/w ratio'</span><span class="p">,</span>
                        <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'--p_rotate'</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Ratio to randomly rotate an image'</span><span class="p">,</span>
                        <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'--p_rotate_crop'</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Ratio to crop out the empty part in a rotated image'</span><span class="p">,</span>
                        <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'--rotate_angle_vari'</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Variation range of rotate angle'</span><span class="p">,</span>
                        <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">10.0</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'--p_hsv'</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Ratio to randomly change gamma of an image'</span><span class="p">,</span>
                        <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'--hue_vari'</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Variation of hue'</span><span class="p">,</span>
                        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'--sat_vari'</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Variation of saturation'</span><span class="p">,</span>
                        <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'--val_vari'</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Variation of value'</span><span class="p">,</span>
                        <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'--p_gamma'</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Ratio to randomly change gamma of an image'</span><span class="p">,</span>
                        <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'--gamma_vari'</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Variation of gamma'</span><span class="p">,</span>
                        <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>

    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
    <span class="n">args</span><span class="o">.</span><span class="n">input_dir</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">input_dir</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">'/'</span><span class="p">)</span>
    <span class="n">args</span><span class="o">.</span><span class="n">output_dir</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">output_dir</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">'/'</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">args</span>

<span class="sd">'''</span>
<span class="sd">根据进程数和要增加的目标图片数，</span>
<span class="sd">生成每个进程要处理的文件列表和每个文件要增加的数目</span>
<span class="sd">'''</span>
<span class="k">def</span> <span class="nf">generate_image_list</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    <span class="c1"># 获取所有文件名和文件总数</span>
    <span class="n">filenames</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">input_dir</span><span class="p">)</span>
    <span class="n">num_imgs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">filenames</span><span class="p">)</span>

	<span class="c1"># 计算平均处理的数目并向下取整</span>
    <span class="n">num_ave_aug</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">num</span><span class="o">/</span><span class="n">num_imgs</span><span class="p">))</span>
	
	<span class="c1"># 剩下的部分不足平均分配到每一个文件，所以做成一个随机幸运列表</span>
	<span class="c1"># 对于幸运的文件就多增加一个，凑够指定的数目</span>
    <span class="n">rem</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">num</span> <span class="o">-</span> <span class="n">num_ave_aug</span><span class="o">*</span><span class="n">num_imgs</span>
    <span class="n">lucky_seq</span> <span class="o">=</span> <span class="p">[</span><span class="bp">True</span><span class="p">]</span><span class="o">*</span><span class="n">rem</span> <span class="o">+</span> <span class="p">[</span><span class="bp">False</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">num_imgs</span><span class="o">-</span><span class="n">rem</span><span class="p">)</span>
    <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">lucky_seq</span><span class="p">)</span>

	<span class="c1"># 根据平均分配和幸运表策略，</span>
	<span class="c1"># 生成每个文件的全路径和对应要增加的数目并放到一个list里</span>
    <span class="n">img_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">args</span><span class="o">.</span><span class="n">input_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">]),</span> <span class="n">num_ave_aug</span><span class="o">+</span><span class="mi">1</span> <span class="k">if</span> <span class="n">lucky</span> <span class="k">else</span> <span class="n">num_ave_aug</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lucky</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">filenames</span><span class="p">,</span> <span class="n">lucky_seq</span><span class="p">)</span>
    <span class="p">]</span>
	
	<span class="c1"># 文件可能大小不一，处理时间也不一样，</span>
	<span class="c1"># 所以随机打乱，尽可能保证处理时间均匀</span>
    <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">img_list</span><span class="p">)</span>

	<span class="c1"># 生成每个进程的文件列表，</span>
	<span class="c1"># 尽可能均匀地划分每个进程要处理的数目</span>
    <span class="n">length</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">num_imgs</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">num_procs</span><span class="p">)</span>
    <span class="n">indices</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="n">length</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">num_procs</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">img_list</span><span class="p">[</span><span class="n">indices</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span><span class="n">indices</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">num_procs</span><span class="p">)]</span>

<span class="c1"># 每个进程内调用图像处理函数进行扰动的函数</span>
<span class="k">def</span> <span class="nf">augment_images</span><span class="p">(</span><span class="n">filelist</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
    <span class="c1"># 遍历所有列表内的文件</span>
    <span class="k">for</span> <span class="n">filepath</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">filelist</span><span class="p">:</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">filepath</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">dot_pos</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s1">'.'</span><span class="p">)</span>
		
		<span class="c1"># 获取文件名和后缀名</span>
        <span class="n">imgname</span> <span class="o">=</span> <span class="n">filename</span><span class="p">[:</span><span class="n">dot_pos</span><span class="p">]</span>
        <span class="n">ext</span> <span class="o">=</span> <span class="n">filename</span><span class="p">[</span><span class="n">dot_pos</span><span class="p">:]</span>

        <span class="k">print</span><span class="p">(</span><span class="s1">'Augmenting {} ...'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="n">img_varied</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
			
			<span class="c1"># 扰动后文件名的前缀</span>
            <span class="n">varied_imgname</span> <span class="o">=</span> <span class="s1">'{}_{:0&gt;3d}_'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">imgname</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
			
			<span class="c1"># 按照比例随机对图像进行镜像</span>
            <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">args</span><span class="o">.</span><span class="n">p_mirror</span><span class="p">:</span>
			    <span class="c1"># 利用numpy.fliplr(img_varied)也能实现</span>
                <span class="n">img_varied</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">img_varied</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">varied_imgname</span> <span class="o">+=</span> <span class="s1">'m'</span>
			
			<span class="c1"># 按照比例随机对图像进行裁剪</span>
            <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">args</span><span class="o">.</span><span class="n">p_crop</span><span class="p">:</span>
                <span class="n">img_varied</span> <span class="o">=</span> <span class="n">ia</span><span class="o">.</span><span class="n">random_crop</span><span class="p">(</span>
                    <span class="n">img_varied</span><span class="p">,</span>
                    <span class="n">args</span><span class="o">.</span><span class="n">crop_size</span><span class="p">,</span>
                    <span class="n">args</span><span class="o">.</span><span class="n">crop_hw_vari</span><span class="p">)</span>
                <span class="n">varied_imgname</span> <span class="o">+=</span> <span class="s1">'c'</span>
			
			<span class="c1"># 按照比例随机对图像进行旋转</span>
            <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">args</span><span class="o">.</span><span class="n">p_rotate</span><span class="p">:</span>
                <span class="n">img_varied</span> <span class="o">=</span> <span class="n">ia</span><span class="o">.</span><span class="n">random_rotate</span><span class="p">(</span>
                    <span class="n">img_varied</span><span class="p">,</span>
                    <span class="n">args</span><span class="o">.</span><span class="n">rotate_angle_vari</span><span class="p">,</span>
                    <span class="n">args</span><span class="o">.</span><span class="n">p_rotate_crop</span><span class="p">)</span>
                <span class="n">varied_imgname</span> <span class="o">+=</span> <span class="s1">'r'</span>
			
			<span class="c1"># 按照比例随机对图像进行HSV扰动</span>
            <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">args</span><span class="o">.</span><span class="n">p_hsv</span><span class="p">:</span>
                <span class="n">img_varied</span> <span class="o">=</span> <span class="n">ia</span><span class="o">.</span><span class="n">random_hsv_transform</span><span class="p">(</span>
                    <span class="n">img_varied</span><span class="p">,</span>
                    <span class="n">args</span><span class="o">.</span><span class="n">hue_vari</span><span class="p">,</span>
                    <span class="n">args</span><span class="o">.</span><span class="n">sat_vari</span><span class="p">,</span>
                    <span class="n">args</span><span class="o">.</span><span class="n">val_vari</span><span class="p">)</span>
                <span class="n">varied_imgname</span> <span class="o">+=</span> <span class="s1">'h'</span>
			
			<span class="c1"># 按照比例随机对图像进行Gamma扰动</span>
            <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">args</span><span class="o">.</span><span class="n">p_gamma</span><span class="p">:</span>
                <span class="n">img_varied</span> <span class="o">=</span> <span class="n">ia</span><span class="o">.</span><span class="n">random_gamma_transform</span><span class="p">(</span>
                    <span class="n">img_varied</span><span class="p">,</span>
                    <span class="n">args</span><span class="o">.</span><span class="n">gamma_vari</span><span class="p">)</span>
                <span class="n">varied_imgname</span> <span class="o">+=</span> <span class="s1">'g'</span>
			
			<span class="c1"># 生成扰动后的文件名并保存在指定的路径</span>
            <span class="n">output_filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
                <span class="n">args</span><span class="o">.</span><span class="n">output_dir</span><span class="p">,</span>
                <span class="s1">'{}{}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">varied_imgname</span><span class="p">,</span> <span class="n">ext</span><span class="p">)])</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="n">output_filepath</span><span class="p">,</span> <span class="n">img_varied</span><span class="p">)</span>

<span class="c1"># 主函数</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="c1"># 获取输入输出和变换选项</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parse_args</span><span class="p">()</span>
    <span class="n">params_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">args</span><span class="p">)[</span><span class="mi">10</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

	<span class="c1"># 如果输出文件夹不存在，则建立文件夹</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">output_dir</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">output_dir</span><span class="p">)</span>

    <span class="k">print</span><span class="p">(</span><span class="s1">'Starting image data augmentation for {}</span><span class="se">\n</span><span class="s1">'</span>
          <span class="s1">'with</span><span class="se">\n</span><span class="s1">{}</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">input_dir</span><span class="p">,</span> <span class="n">params_str</span><span class="p">))</span>

	<span class="c1"># 生成每个进程要处理的列表</span>
    <span class="n">sublists</span> <span class="o">=</span> <span class="n">generate_image_list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
	
	<span class="c1"># 创建进程</span>
    <span class="n">processes</span> <span class="o">=</span> <span class="p">[</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">augment_images</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sublists</span><span class="p">]</span>

	<span class="c1"># 并行多进程处理</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">processes</span><span class="p">:</span>
        <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">processes</span><span class="p">:</span>
        <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>

    <span class="k">print</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">Done!'</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</code></pre></div><p>为了排版方便，并没有很遵守Python的规范（PEP8）。注意到除了前面提的三种类型的变化，还增加了镜像变化，这主要是因为这种变换太简单了，顺手就写上了。还有默认进程数用的是cpu_count()函数，这个获取的是cpu的核数。把这段代码保存为run_augmentation.py，然后在命令行输入：</p><p>&gt;&gt; python run_augmentation.py -h
</p><p><br></p><p>或者</p><p>&gt;&gt; python run_augmentation.py --help
</p><p><br></p><p>就能看到脚本的使用方法，每个参数的含义，还有默认值。接下里来执行一个图片增加任务：</p><p>&gt;&gt; python run_augmentation.py imagenet_samples more_samples 1000 --rotate_angle_vari 180 --p_rotate_crop 0.5
</p><p>其中imagenet_samples为一些从imagenet图片url中随机下载的一些图片，--rotate_angle_vari设为180方便测试全方向的旋转，--p_rotate_crop设置为0.5，让旋转裁剪对一半图片生效。扰动增加后的1000张图片在more_samples文件夹下，得到的部分结果如下：</p><figure><noscript>&lt;img src="https://pic3.zhimg.com/v2-dc6d55514e584fcc8a7b5bf8b20b136c_b.jpg" data-rawwidth="1018" data-rawheight="618" class="origin_image zh-lightbox-thumb" width="1018" data-original="https://pic3.zhimg.com/v2-dc6d55514e584fcc8a7b5bf8b20b136c_r.jpg"&gt;</noscript><span><div data-reactroot="" class="VagueImage origin_image zh-lightbox-thumb" data-src="https://pic3.zhimg.com/80/v2-dc6d55514e584fcc8a7b5bf8b20b136c_hd.jpg" style="width: 660px; height: 400.668px;"><div class="VagueImage-mask is-active"></div></div></span></figure><h2>6.4 用OpenCV实现数据标注小工具</h2><p>除了对图像的处理，OpenCV的图形用户界面（<b>G</b>raphical <b>U</b>ser <b>I</b>nterface, <b>GUI</b>）和绘图等相关功能也是很有用的功能，无论是可视化，图像调试还是我们这节要实现的标注任务，都可以有所帮助。这节先介绍OpenCV窗口的最基本使用和交互，然后基于这些基础和之前的知识实现一个用于物体检测任务标注的小工具。</p><h2>6.4.1
OpenCV窗口循环</h2><p>OpenCV显示一幅图片的函数是cv2.imshow()，第一个参数是显示图片的窗口名称，第二个参数是图片的array。不过如果直接执行这个函数的话，什么都不会发生，因为这个函数得配合cv2.waitKey()一起使用。cv2.waitKey()指定当前的窗口显示要持续的毫秒数，比如cv2.waitKey(1000)就是显示一秒，然后窗口就关闭了。比较特殊的是cv2.waitKey(0)，并不是显示0毫秒的意思，而是一直显示，直到有键盘上的按键被按下，或者鼠标点击了窗口的小叉子才关闭。cv2.waitKey()的默认参数就是0，所以对于图像展示的场景，cv2.waitKey()或者cv2.waitKey(0)是最常用的：</p><div class="highlight"><pre><code class="language-python"><span></span><span class="kn">import</span> <span class="nn">cv2</span>

<span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">'Aitutaki.png'</span><span class="p">)</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">'Honeymoon Island'</span><span class="p">,</span> <span class="n">img</span><span class="p">)</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">()</span>
</code></pre></div><p>执行这段代码得到如下窗口：</p><figure><noscript>&lt;img src="https://pic1.zhimg.com/v2-1712545c1114f3f66f37121c02354144_b.jpg" data-rawwidth="722" data-rawheight="515" class="origin_image zh-lightbox-thumb" width="722" data-original="https://pic1.zhimg.com/v2-1712545c1114f3f66f37121c02354144_r.jpg"&gt;</noscript><span><div data-reactroot="" class="VagueImage origin_image zh-lightbox-thumb" data-src="https://pic1.zhimg.com/80/v2-1712545c1114f3f66f37121c02354144_hd.jpg" style="width: 660px; height: 470.776px;"><div class="VagueImage-mask is-active"></div></div></span></figure><p>cv2.waitKey()参数不为零的时候则可以和循环结合产生动态画面，比如在6.2.4的延时小例子中，我们把延时摄影保存下来的所有图像放到一个叫做frames的文件夹下。下面代码从frames的文件夹下读取所有图片并以24的帧率在窗口中显示成动画：</p><div class="highlight"><pre><code class="language-python"><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">cycle</span>
<span class="kn">import</span> <span class="nn">cv2</span>

<span class="c1"># 列出frames文件夹下的所有图片</span>
<span class="n">filenames</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s1">'frames'</span><span class="p">)</span>

<span class="c1"># 通过itertools.cycle生成一个无限循环的迭代器，每次迭代都输出下一张图像对象</span>
<span class="n">img_iter</span> <span class="o">=</span> <span class="n">cycle</span><span class="p">([</span><span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">'frames'</span><span class="p">,</span> <span class="n">x</span><span class="p">]))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">])</span>

<span class="n">key</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">while</span> <span class="n">key</span> <span class="o">&amp;</span> <span class="mh">0xFF</span> <span class="o">!=</span> <span class="mi">27</span><span class="p">:</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">'Animation'</span><span class="p">,</span> <span class="nb">next</span><span class="p">(</span><span class="n">img_iter</span><span class="p">))</span>
    <span class="n">key</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
</code></pre></div><p>在这个例子中我们采用了Python的itertools模块中的cycle函数，这个函数可以把一个可遍历结构编程一个无限循环的迭代器。另外从这个例子中我们还发现，cv2.waitKey()返回的就是键盘上出发的按键。对于字母就是ascii码，特殊按键比如上下左右等，则对应特殊的值，其实这就是键盘事件的最基本用法。</p><h2>6.4.2
鼠标和键盘事件</h2><p>因为GUI总是交互的，所以鼠标和键盘事件基本使用必不可少，上节已经提到了cv2.waitKey()就是获取键盘消息的最基本方法。比如下面这段循环代码就能够获取键盘上按下的按键，并在终端输出：</p><div class="highlight"><pre><code class="language-python"><span></span><span class="k">while</span> <span class="n">key</span> <span class="o">!=</span> <span class="mi">27</span><span class="p">:</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">'Honeymoon Island'</span><span class="p">,</span> <span class="n">img</span><span class="p">)</span>
    <span class="n">key</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">()</span>
    <span class="c1"># 如果获取的键值小于256则作为ascii码输出对应字符，否则直接输出值</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="s1">'{} is pressed'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="k">if</span> <span class="n">key</span> <span class="o">&lt;</span> <span class="mi">256</span> <span class="k">else</span> <span class="n">key</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</code></pre></div><p>通过这个程序我们能获取一些常用特殊按键的值，比如在笔者用的机器上，四个方向的按键和删除键对应的值如下：</p><p>-         
上（↑）：65362</p><p>-         
下（↓）：65364</p><p>-         
左（←）：65361</p><p>-         
右（→）：65363</p><p>-         
删除（Delete）：65535</p><p>需要注意的是在不同的操作系统里这些值可能是不一样的。鼠标事件比起键盘事件稍微复杂一点点，需要定义一个回调函数，然后把回调函数和一个指定名称的窗口绑定，这样只要鼠标位于画面区域内的事件就都能捕捉到。把下面这段代码插入到上段代码的while之前，就能获取当前鼠标的位置和动作并输出：</p><div class="highlight"><pre><code class="language-python"><span></span><span class="c1"># 定义鼠标事件回调函数</span>
<span class="k">def</span> <span class="nf">on_mouse</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">param</span><span class="p">):</span>

    <span class="c1"># 鼠标左键按下，抬起，双击</span>
    <span class="k">if</span> <span class="n">event</span> <span class="o">==</span> <span class="n">cv2</span><span class="o">.</span><span class="n">EVENT_LBUTTONDOWN</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">'Left button down at ({}, {})'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">event</span> <span class="o">==</span> <span class="n">cv2</span><span class="o">.</span><span class="n">EVENT_LBUTTONUP</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">'Left button up at ({}, {})'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">event</span> <span class="o">==</span> <span class="n">cv2</span><span class="o">.</span><span class="n">EVENT_LBUTTONDBLCLK</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">'Left button double clicked at ({}, {})'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>

    <span class="c1"># 鼠标右键按下，抬起，双击</span>
    <span class="k">elif</span> <span class="n">event</span> <span class="o">==</span> <span class="n">cv2</span><span class="o">.</span><span class="n">EVENT_RBUTTONDOWN</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">'Right button down at ({}, {})'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">event</span> <span class="o">==</span> <span class="n">cv2</span><span class="o">.</span><span class="n">EVENT_RBUTTONUP</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">'Right button up at ({}, {})'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">event</span> <span class="o">==</span> <span class="n">cv2</span><span class="o">.</span><span class="n">EVENT_RBUTTONDBLCLK</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">'Right button double clicked at ({}, {})'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>

    <span class="c1"># 鼠标中/滚轮键（如果有的话）按下，抬起，双击</span>
    <span class="k">elif</span> <span class="n">event</span> <span class="o">==</span> <span class="n">cv2</span><span class="o">.</span><span class="n">EVENT_MBUTTONDOWN</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">'Middle button down at ({}, {})'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">event</span> <span class="o">==</span> <span class="n">cv2</span><span class="o">.</span><span class="n">EVENT_MBUTTONUP</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">'Middle button up at ({}, {})'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">event</span> <span class="o">==</span> <span class="n">cv2</span><span class="o">.</span><span class="n">EVENT_MBUTTONDBLCLK</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">'Middle button double clicked at ({}, {})'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>

    <span class="c1"># 鼠标移动</span>
    <span class="k">elif</span> <span class="n">event</span> <span class="o">==</span> <span class="n">cv2</span><span class="o">.</span><span class="n">EVENT_MOUSEMOVE</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">'Moving at ({}, {})'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>

<span class="c1"># 为指定的窗口绑定自定义的回调函数</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">namedWindow</span><span class="p">(</span><span class="s1">'Honeymoon Island'</span><span class="p">)</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">setMouseCallback</span><span class="p">(</span><span class="s1">'Honeymoon Island'</span><span class="p">,</span> <span class="n">on_mouse</span><span class="p">)</span>
</code></pre></div><h2>6.4.3
代码：物体检测标注的小工具</h2><p>基于上面两小节的基本使用，就能和OpenCV的基本绘图功能就能实现一个超级简单的物体框标注小工具了。基本思路是对要标注的图像建立一个窗口循环，然后每次循环的时候对图像进行一次拷贝。鼠标在画面上画框的操作，以及已经画好的框的相关信息在全局变量中保存，并且在每个循环中根据这些信息，在拷贝的图像上再画一遍，然后显示这份拷贝的图像。</p><p>基于这种实现思路，使用上我们采用一个尽量简化的设计：</p><p>-         
输入是一个文件夹，下面包含了所有要标注物体框的图片。如果图片中标注了物体，则生成一个相同名称加额外后缀名的文件保存标注信息。</p><p>-         
标注的方式是按下鼠标左键选择物体框的左上角，松开鼠标左键选择物体框的右下角，鼠标右键删除上一个标注好的物体框。所有待标注物体的类别，和标注框颜色由用户自定义，如果没有定义则默认只标注一种物体，定义该物体名称叫“Object”。</p><p>-         
方向键的←和→用来遍历图片，↑和↓用来选择当前要标注的物体，Delete键删除一张图片和对应的标注信息。</p><p>每张图片的标注信息，以及自定义标注物体和颜色的信息，用一个元组表示，第一个元素是物体名字，第二个元素是代表BGR颜色的tuple或者是代表标注框坐标的元组。对于这种并不复杂复杂的数据结构，我们直接利用Python的repr()函数，把数据结构保存成机器可读的字符串放到文件里，读取的时候用eval()函数就能直接获得数据。这样的方便之处在于不需要单独写个格式解析器。如果需要可以在此基础上再编写一个转换工具就能够转换成常见的Pascal VOC的标注格式或是其他的自定义格式。</p><p>
在这些思路和设计下，我们定义标注信息文件的格式的例子如下：</p><div class="highlight"><pre><code class="language-text"><span></span>('Hill', ((221, 163), (741, 291)))
('Horse', ((465, 430), (613, 570)))
</code></pre></div><p>元组中第一项是物体名称，第二项是标注框左上角和右下角的坐标。这里之所以不把标注信息的数据直接用pickle保存，是因为数据本身不会很复杂，直接保存还有更好的可读性。自定义标注物体和对应标注框颜色的格式也类似，不过更简单些，因为括号可以不写，具体如下：</p><div class="highlight"><pre><code class="language-text"><span></span>'Horse', (255, 255, 0)
'Hill', (0, 255, 255)
'DiaoSi', (0, 0, 255)
</code></pre></div><p>第一项是物体名称，第二项是物体框的颜色。使用的时候把自己定义好的内容放到一个文本里，然后保存成和待标注文件夹同名，后缀名为labels的文件。比如我们在一个叫samples的文件夹下放上一些草原的照片，然后自定义一个samples.labels的文本文件。把上段代码的内容放进去，就定义了小山头的框为黄色，骏马的框为青色，以及红色的屌丝。基于以上，标注小工具的代码如下：</p><div class="highlight"><pre><code class="language-python"><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">cv2</span>

<span class="c1"># tkinter是Python内置的简单GUI库，实现一些比如打开文件夹，确认删除等操作十分方便</span>
<span class="kn">from</span> <span class="nn">tkFileDialog</span> <span class="kn">import</span> <span class="n">askdirectory</span>
<span class="kn">from</span> <span class="nn">tkMessageBox</span> <span class="kn">import</span> <span class="n">askyesno</span>

<span class="c1"># 定义标注窗口的默认名称</span>
<span class="n">WINDOW_NAME</span> <span class="o">=</span> <span class="s1">'Simple Bounding Box Labeling Tool'</span>

<span class="c1"># 定义画面刷新的大概帧率（是否能达到取决于电脑性能）</span>
<span class="n">FPS</span> <span class="o">=</span> <span class="mi">24</span>

<span class="c1"># 定义支持的图像格式</span>
<span class="n">SUPPOTED_FORMATS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'jpg'</span><span class="p">,</span> <span class="s1">'jpeg'</span><span class="p">,</span> <span class="s1">'png'</span><span class="p">]</span>

<span class="c1"># 定义默认物体框的名字为Object，颜色蓝色，当没有用户自定义物体时用默认物体</span>
<span class="n">DEFAULT_COLOR</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'Object'</span><span class="p">:</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)}</span>

<span class="c1"># 定义灰色，用于信息显示的背景和未定义物体框的显示</span>
<span class="n">COLOR_GRAY</span> <span class="o">=</span> <span class="p">(</span><span class="mi">192</span><span class="p">,</span> <span class="mi">192</span><span class="p">,</span> <span class="mi">192</span><span class="p">)</span>

<span class="c1"># 在图像下方多出BAR_HEIGHT这么多像素的区域用于显示文件名和当前标注物体等信息</span>
<span class="n">BAR_HEIGHT</span> <span class="o">=</span> <span class="mi">16</span>

<span class="c1"># 上下左右，ESC及删除键对应的cv.waitKey()的返回值</span>
<span class="c1"># 注意这个值根据操作系统不同有不同，可以通过6.4.2中的代码获取</span>
<span class="n">KEY_UP</span> <span class="o">=</span> <span class="mi">65362</span>
<span class="n">KEY_DOWN</span> <span class="o">=</span> <span class="mi">65364</span>
<span class="n">KEY_LEFT</span> <span class="o">=</span> <span class="mi">65361</span>
<span class="n">KEY_RIGHT</span> <span class="o">=</span> <span class="mi">65363</span>
<span class="n">KEY_ESC</span> <span class="o">=</span> <span class="mi">27</span>
<span class="n">KEY_DELETE</span> <span class="o">=</span> <span class="mi">65535</span>

<span class="c1"># 空键用于默认循环</span>
<span class="n">KEY_EMPTY</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">get_bbox_name</span> <span class="o">=</span> <span class="s1">'{}.bbox'</span><span class="o">.</span><span class="n">format</span>

<span class="c1"># 定义物体框标注工具类</span>
<span class="k">class</span> <span class="nc">SimpleBBoxLabeling</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_dir</span><span class="p">,</span> <span class="n">fps</span><span class="o">=</span><span class="n">FPS</span><span class="p">,</span> <span class="n">window_name</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data_dir</span> <span class="o">=</span> <span class="n">data_dir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fps</span> <span class="o">=</span> <span class="n">fps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window_name</span> <span class="o">=</span> <span class="n">window_name</span> <span class="k">if</span> <span class="n">window_name</span> <span class="k">else</span> <span class="n">WINDOW_NAME</span>

        <span class="c1">#pt0是正在画的左上角坐标，pt1是鼠标所在坐标</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pt0</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pt1</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="c1"># 表明当前是否正在画框的状态标记</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_drawing</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="c1"># 当前标注物体的名称</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cur_label</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="c1"># 当前图像对应的所有已标注框</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bboxes</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># 如果有用户自定义的标注信息则读取，否则用默认的物体和颜色</span>
        <span class="n">label_path</span> <span class="o">=</span> <span class="s1">'{}.labels'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_dir</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_colors</span> <span class="o">=</span> <span class="n">DEFAULT_COLOR</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">label_path</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_labels</span><span class="p">(</span><span class="n">label_path</span><span class="p">)</span>

        <span class="c1"># 获取已经标注的文件列表和还未标注的文件列表</span>
        <span class="n">imagefiles</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_dir</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s1">'.'</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">SUPPOTED_FORMATS</span><span class="p">]</span>
        <span class="n">labeled</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">imagefiles</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">get_bbox_name</span><span class="p">(</span><span class="n">x</span><span class="p">))]</span>
        <span class="n">to_be_labeled</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">imagefiles</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">labeled</span><span class="p">]</span>

        <span class="c1"># 每次打开一个文件夹，都自动从还未标注的第一张开始</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filelist</span> <span class="o">=</span> <span class="n">labeled</span> <span class="o">+</span> <span class="n">to_be_labeled</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">labeled</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filelist</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filelist</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="c1"># 鼠标回调函数</span>
    <span class="k">def</span> <span class="nf">_mouse_ops</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">param</span><span class="p">):</span>

        <span class="c1"># 按下左键时，坐标为左上角，同时表明开始画框，改变drawing标记为True</span>
        <span class="k">if</span> <span class="n">event</span> <span class="o">==</span> <span class="n">cv2</span><span class="o">.</span><span class="n">EVENT_LBUTTONDOWN</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_drawing</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pt0</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="c1"># 左键抬起，表明当前框画完了，坐标记为右下角，并保存，同时改变drawing标记为False</span>
        <span class="k">elif</span> <span class="n">event</span> <span class="o">==</span> <span class="n">cv2</span><span class="o">.</span><span class="n">EVENT_LBUTTONUP</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_drawing</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pt1</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_bboxes</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_cur_label</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pt0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pt1</span><span class="p">)))</span>

        <span class="c1"># 实时更新右下角坐标方便画框</span>
        <span class="k">elif</span> <span class="n">event</span> <span class="o">==</span> <span class="n">cv2</span><span class="o">.</span><span class="n">EVENT_MOUSEMOVE</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pt1</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="c1"># 鼠标右键删除最近画好的框</span>
        <span class="k">elif</span> <span class="n">event</span> <span class="o">==</span> <span class="n">cv2</span><span class="o">.</span><span class="n">EVENT_RBUTTONUP</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bboxes</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_bboxes</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

    <span class="c1"># 清除所有标注框和当前状态</span>
    <span class="k">def</span> <span class="nf">_clean_bbox</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pt0</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pt1</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_drawing</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bboxes</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># 画标注框和当前信息的函数</span>
    <span class="k">def</span> <span class="nf">_draw_bbox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>

        <span class="c1"># 在图像下方多出BAR_HEIGHT这么多像素的区域用于显示文件名和当前标注物体等信息</span>
        <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">canvas</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">copyMakeBorder</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">BAR_HEIGHT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">BORDER_CONSTANT</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">COLOR_GRAY</span><span class="p">)</span>

        <span class="c1"># 正在标注的物体信息，如果鼠标左键已经按下，则显示两个点坐标，否则显示当前待标注物体的名称</span>
        <span class="n">label_msg</span> <span class="o">=</span> <span class="s1">'{}: {}, {}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cur_label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pt0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pt1</span><span class="p">)</span> \
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_drawing</span> \
            <span class="k">else</span> <span class="s1">'Current label: {}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cur_label</span><span class="p">)</span>

        <span class="c1"># 显示当前文件名，文件个数信息</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s1">'{}/{}: {} | {}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filelist</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filelist</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="p">],</span> <span class="n">label_msg</span><span class="p">)</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">putText</span><span class="p">(</span><span class="n">canvas</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">h</span><span class="o">+</span><span class="mi">12</span><span class="p">),</span>
                    <span class="n">cv2</span><span class="o">.</span><span class="n">FONT_HERSHEY_SIMPLEX</span><span class="p">,</span>
                    <span class="mf">0.5</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># 画出已经标好的框和对应名字</span>
        <span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="p">(</span><span class="n">bpt0</span><span class="p">,</span> <span class="n">bpt1</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bboxes</span><span class="p">:</span>
            <span class="n">label_color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_colors</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="k">if</span> <span class="n">label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_colors</span> <span class="k">else</span> <span class="n">COLOR_GRAY</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span><span class="n">canvas</span><span class="p">,</span> <span class="n">bpt0</span><span class="p">,</span> <span class="n">bpt1</span><span class="p">,</span> <span class="n">label_color</span><span class="p">,</span> <span class="n">thickness</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">putText</span><span class="p">(</span><span class="n">canvas</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="p">(</span><span class="n">bpt0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span> <span class="n">bpt0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">15</span><span class="p">),</span>
                        <span class="n">cv2</span><span class="o">.</span><span class="n">FONT_HERSHEY_SIMPLEX</span><span class="p">,</span>
                        <span class="mf">0.5</span><span class="p">,</span> <span class="n">label_color</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># 画正在标注的框和对应名字</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_drawing</span><span class="p">:</span>
            <span class="n">label_color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_colors</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_cur_label</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cur_label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_colors</span> <span class="k">else</span> <span class="n">COLOR_GRAY</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pt1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pt0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pt1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pt0</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">cv2</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span><span class="n">canvas</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pt0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pt1</span><span class="p">,</span> <span class="n">label_color</span><span class="p">,</span> <span class="n">thickness</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">putText</span><span class="p">(</span><span class="n">canvas</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cur_label</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pt0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pt0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">15</span><span class="p">),</span>
                        <span class="n">cv2</span><span class="o">.</span><span class="n">FONT_HERSHEY_SIMPLEX</span><span class="p">,</span>
                        <span class="mf">0.5</span><span class="p">,</span> <span class="n">label_color</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">canvas</span>

    <span class="c1"># 利用repr()导出标注框数据到文件</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">export_bbox</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">bboxes</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">bboxes</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">bbox</span> <span class="ow">in</span> <span class="n">bboxes</span><span class="p">:</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">bbox</span><span class="p">)</span> <span class="o">+</span> <span class="s1">'</span><span class="se">\n</span><span class="s1">'</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>

    <span class="c1"># 利用eval()读取标注框字符串到数据</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">load_bbox</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
        <span class="n">bboxes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
            <span class="k">while</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">bboxes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">line</span><span class="p">))</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">bboxes</span>

    <span class="c1"># 利用eval()读取物体及对应颜色信息到数据</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">load_labels</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
        <span class="n">label_colors</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
            <span class="k">while</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">label</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="n">label_colors</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">color</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">label_colors</span>

    <span class="c1"># 读取图像文件和对应标注框信息（如果有的话）</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">load_sample</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
        <span class="n">bbox_filepath</span> <span class="o">=</span> <span class="n">get_bbox_name</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
        <span class="n">bboxes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">bbox_filepath</span><span class="p">):</span>
            <span class="n">bboxes</span> <span class="o">=</span> <span class="n">SimpleBBoxLabeling</span><span class="o">.</span><span class="n">load_bbox</span><span class="p">(</span><span class="n">bbox_filepath</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">img</span><span class="p">,</span> <span class="n">bboxes</span>

    <span class="c1"># 导出当前标注框信息并清空</span>
    <span class="k">def</span> <span class="nf">_export_n_clean_bbox</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">bbox_filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_dir</span><span class="p">,</span> <span class="n">get_bbox_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filelist</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="p">])])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">export_bbox</span><span class="p">(</span><span class="n">bbox_filepath</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bboxes</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_clean_bbox</span><span class="p">()</span>

    <span class="c1"># 删除当前样本和对应的标注框信息</span>
    <span class="k">def</span> <span class="nf">_delete_current_sample</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filelist</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="p">]</span>
        <span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
        <span class="n">filepath</span> <span class="o">=</span> <span class="n">get_bbox_name</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filelist</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">'{} is deleted!'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
		
    <span class="c1"># 开始OpenCV窗口循环的方法，定义了程序的主逻辑</span>
    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

	    <span class="c1"># 之前标注的文件名，用于程序判断是否需要执行一次图像读取</span>
        <span class="n">last_filename</span> <span class="o">=</span> <span class="s1">''</span>
		
        <span class="c1"># 标注物体在列表中的下标</span>
        <span class="n">label_index</span> <span class="o">=</span> <span class="mi">0</span>
		
        <span class="c1"># 所有标注物体名称的列表</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_colors</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

        <span class="c1"># 待标注物体的种类数</span>
        <span class="n">n_labels</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>

        <span class="c1"># 定义窗口和鼠标回调</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">namedWindow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window_name</span><span class="p">)</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">setMouseCallback</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mouse_ops</span><span class="p">)</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">KEY_EMPTY</span>

        <span class="c1"># 定义每次循环的持续时间</span>
        <span class="n">delay</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">1000</span> <span class="o">/</span> <span class="n">FPS</span><span class="p">)</span>

        <span class="c1"># 只要没有按下Esc键，就持续循环</span>
        <span class="k">while</span> <span class="n">key</span> <span class="o">!=</span> <span class="n">KEY_ESC</span><span class="p">:</span>

            <span class="c1"># 上下键用于选择当前标注物体</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="n">KEY_UP</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">label_index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">label_index</span> <span class="o">-=</span> <span class="mi">1</span>

            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="n">KEY_DOWN</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">label_index</span> <span class="o">==</span> <span class="n">n_labels</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">label_index</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># 左右键切换当前标注的图片</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="n">KEY_LEFT</span><span class="p">:</span>
                <span class="c1"># 已经到了第一张图片的话就不需要清空上一张</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_export_n_clean_bbox</span><span class="p">()</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_index</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_index</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="n">KEY_RIGHT</span><span class="p">:</span>
                <span class="c1"># 已经到了最后一张图片的话就不需要清空上一张</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filelist</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_export_n_clean_bbox</span><span class="p">()</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_index</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filelist</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filelist</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

            <span class="c1"># 删除当前图片和对应标注信息</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="n">KEY_DELETE</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">askyesno</span><span class="p">(</span><span class="s1">'Delete Sample'</span><span class="p">,</span> <span class="s1">'Are you sure?'</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_delete_current_sample</span><span class="p">()</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="n">KEY_EMPTY</span>
                    <span class="k">continue</span>

            <span class="c1"># 如果键盘操作执行了换图片，则重新读取，更新图片</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filelist</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">filename</span> <span class="o">!=</span> <span class="n">last_filename</span><span class="p">:</span>
                <span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">])</span>
                <span class="n">img</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bboxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_sample</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>

            <span class="c1"># 更新当前标注物体名称</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cur_label</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">label_index</span><span class="p">]</span>

            <span class="c1"># 把标注和相关信息画在图片上并显示指定的时间</span>
            <span class="n">canvas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_draw_bbox</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window_name</span><span class="p">,</span> <span class="n">canvas</span><span class="p">)</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>

            <span class="c1"># 当前文件名就是下次循环的老文件名</span>
            <span class="n">last_filename</span> <span class="o">=</span> <span class="n">filename</span>

        <span class="k">print</span><span class="p">(</span><span class="s1">'Finished!'</span><span class="p">)</span>

        <span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>
        <span class="c1"># 如果退出程序，需要对当前进行保存</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">export_bbox</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_dir</span><span class="p">,</span> <span class="n">get_bbox_name</span><span class="p">(</span><span class="n">filename</span><span class="p">)]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bboxes</span><span class="p">)</span>

        <span class="k">print</span><span class="p">(</span><span class="s1">'Labels updated!'</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
    <span class="n">dir_with_images</span> <span class="o">=</span> <span class="n">askdirectory</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">'Where are the images?'</span><span class="p">)</span>
    <span class="n">labeling_task</span> <span class="o">=</span> <span class="n">SimpleBBoxLabeling</span><span class="p">(</span><span class="n">dir_with_images</span><span class="p">)</span>
    <span class="n">labeling_task</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</code></pre></div><p>需要注意的是几个比较通用且独立的方法前加上了一句@staticmethod，表明是个静态方法。执行这个程序，并选择samples文件夹，标注时的画面如下图：
</p><figure><noscript>&lt;img src="https://pic1.zhimg.com/v2-8bf145d52acf931772ce598e8bbc777a_b.jpg" data-rawwidth="1024" data-rawheight="625" class="origin_image zh-lightbox-thumb" width="1024" data-original="https://pic1.zhimg.com/v2-8bf145d52acf931772ce598e8bbc777a_r.jpg"&gt;</noscript><span><div data-reactroot="" class="VagueImage origin_image zh-lightbox-thumb" data-src="https://pic1.zhimg.com/80/v2-8bf145d52acf931772ce598e8bbc777a_hd.jpg" style="width: 660px; height: 402.832px;"><div class="VagueImage-mask is-active"></div></div></span></figure><p></p></div><div class="Tipjar"><div class="Tipjar-tagLine"><!-- react-text: 40 -->「<!-- /react-text --><!-- react-text: 41 -->真诚赞赏，手留余香<!-- /react-text --><!-- react-text: 42 -->」<!-- /react-text --></div><button class="Button Button Tipjar-button" type="button"><!-- react-text: 44 -->赞赏<!-- /react-text --></button><div class="Tipjar-stateDescription"><b>1</b><!-- react-text: 47 -->&nbsp;人赞赏<!-- /react-text --></div><div class="Tipjaror-list"><div class="HoverTitle HoverTitle--slim" data-hover-title="周旭阳"><a class="UserAvatar Tipjaror-avatar" href="https://www.zhihu.com/people/zhou-xu-yang-23-11" target="_blank"><img class="Avatar-hemingway Avatar--is" alt="周旭阳" src="./给深度学习入门者的Python快速教程 - 番外篇之Python-OpenCV_files/da8e974dc_is.jpg" srcset="https://pic4.zhimg.com/da8e974dc_im.jpg 2x"></a></div></div><!-- react-empty: 52 --><!-- react-empty: 53 --></div><div class="PostIndex-footer"><div class="PostIndex-topics TopicItem-wrapper"><a class="TopicItem u-ellipsis PostIndex-topicItem" href="https://www.zhihu.com/topic/19587715"><!-- react-text: 57 -->OpenCV<!-- /react-text --></a><a class="TopicItem u-ellipsis PostIndex-topicItem" href="https://www.zhihu.com/topic/19552832"><!-- react-text: 59 -->Python<!-- /react-text --></a><a class="TopicItem u-ellipsis PostIndex-topicItem" href="https://www.zhihu.com/topic/19813032"><!-- react-text: 61 -->深度学习（Deep Learning）<!-- /react-text --></a></div><div class="PostIndex-reviewers"></div><div class="PostIndex-vote"><button class="Button PostIndex-voteButton Button--green" aria-label="赞" type="button"><i class="icon icon-ic_column_like"></i><!-- react-text: 66 -->395<!-- /react-text --></button><div class="PostIndex-voters"><div class="HoverTitle HoverTitle--slim" data-hover-title="April"><a href="https://www.zhihu.com/people/zhong-lin-mao-63" class="PostIndex-voter" target="_blank"><img class="Avatar-hemingway Avatar--is" alt="April" src="./给深度学习入门者的Python快速教程 - 番外篇之Python-OpenCV_files/v2-6380a660a023a4b551a3126e69f72f35_is.jpg" srcset="https://pic3.zhimg.com/v2-6380a660a023a4b551a3126e69f72f35_im.jpg 2x"></a></div><div class="HoverTitle HoverTitle--slim" data-hover-title="朝闻道"><a href="https://www.zhihu.com/people/li-mr-71" class="PostIndex-voter" target="_blank"><img class="Avatar-hemingway Avatar--is" alt="朝闻道" src="./给深度学习入门者的Python快速教程 - 番外篇之Python-OpenCV_files/f96db44e0_is.jpg" srcset="https://pic2.zhimg.com/f96db44e0_im.jpg 2x"></a></div><div class="HoverTitle HoverTitle--slim" data-hover-title="Anchor"><a href="https://www.zhihu.com/people/lin-zhang-35-96" class="PostIndex-voter" target="_blank"><img class="Avatar-hemingway Avatar--is" alt="Anchor" src="./给深度学习入门者的Python快速教程 - 番外篇之Python-OpenCV_files/88d39854e7b77a8b521d5a3627b56092_is.jpg" srcset="https://pic2.zhimg.com/88d39854e7b77a8b521d5a3627b56092_im.jpg 2x"></a></div><div class="HoverTitle HoverTitle--slim" data-hover-title="郭奕云"><a href="https://www.zhihu.com/people/guo-yi-yun-2" class="PostIndex-voter" target="_blank"><img class="Avatar-hemingway Avatar--is" alt="郭奕云" src="./给深度学习入门者的Python快速教程 - 番外篇之Python-OpenCV_files/v2-93206a3c8419a04b565cef78871e6958_is.jpg" srcset="https://pic3.zhimg.com/v2-93206a3c8419a04b565cef78871e6958_im.jpg 2x"></a></div><div class="HoverTitle HoverTitle--slim" data-hover-title="发条鸟"><a href="https://www.zhihu.com/people/zhang-hao-qing-16" class="PostIndex-voter" target="_blank"><img class="Avatar-hemingway Avatar--is" alt="发条鸟" src="./给深度学习入门者的Python快速教程 - 番外篇之Python-OpenCV_files/c7fb573d2ee91aa98ffd092cf38f19f8_is.jpg" srcset="https://pic4.zhimg.com/c7fb573d2ee91aa98ffd092cf38f19f8_im.jpg 2x"></a></div><a href="https://zhuanlan.zhihu.com/p/24425116/voters" target="_blank" rel="noopener noreferrer" title="查看全部" class="PostIndex-allVoters"><i class="icon-ic_like_more"></i></a></div></div><div class="PostIndex-control"><div class="Fav"><button class="Button Button Button--plain FavButton" type="button"><i class="icon icon-ic_collect"></i><!-- react-text: 89 -->收藏<!-- /react-text --></button><!-- react-empty: 90 --></div><div class="PostShare"><div class="Menu"><button class="Button Button Button--plain MenuButton MenuButton-listen-hover Button Button--plain" type="button"><i class="icon icon-ic_column_share"></i><!-- react-text: 95 -->分享<!-- /react-text --></button><div class="Menu-dropdown" style="visibility: hidden;"></div></div></div><div class="Report"><button class="Button Button Button--plain ReportButton" type="button"><i class="icon icon-ic_column_report"></i><!-- react-text: 100 -->举报<!-- /react-text --></button><!-- react-empty: 101 --></div></div></div><div class="Contributes PostIndex-contributes av-card"><div class="BlockTitle av-marginLeft av-borderColor"><span class="BlockTitle-title">文章被以下专栏收录</span><span class="BlockTitle-line"></span></div><ul class="Contributes-list"><li class="Contributes-listItem av-borderColor av-marginLeft" style="opacity: 1; max-height: 300px;"><div class="ContributesItem av-paddingRight" role="link"><a class="ContributesItem-avatar" href="https://zhuanlan.zhihu.com/frombeijingwithlove"><img class="Avatar-hemingway" src="./给深度学习入门者的Python快速教程 - 番外篇之Python-OpenCV_files/v2-de9efff9dc136da1fb54bd00beb38477_m.jpg" srcset="https://pic3.zhimg.com/v2-de9efff9dc136da1fb54bd00beb38477_xl.jpg 2x"></a><div class="ContributesItem-info"><div class="ContributesItem-nameLine"><a class="ContributesItem-name" href="https://zhuanlan.zhihu.com/frombeijingwithlove">From Beijing with Love</a></div><p class="ContributesItem-intro u-ellipsis">视觉、计算</p></div><a class="ContributesItem-entrance" href="https://zhuanlan.zhihu.com/frombeijingwithlove">进入专栏</a></div></li></ul></div><div class="PostComment"><div class="BlockTitle av-marginLeft av-borderColor PostComment-blockTitle"><span class="BlockTitle-title"><!-- react-text: 119 -->54 条评论<!-- /react-text --></span><span class="BlockTitle-line"></span></div><div class="CommentEditor PostComment-mainEditor"><!-- react-empty: 122 --><div class="CommentEditor-input"><div class="Input-wrapper Input-wrapper--spread Input-wrapper--large Input-wrapper--noPadding"><div class="Input Editable"><div class="Dropzone RichText" style="min-height: 38px;"><div class="DraftEditor-root"><div class="public-DraftEditorPlaceholder-root"><div class="public-DraftEditorPlaceholder-inner" id="placeholder-3mvqc">写下你的评论...</div></div><div class="DraftEditor-editorContainer"><div aria-describedby="placeholder-3mvqc" class="notranslate public-DraftEditor-content" contenteditable="true" role="textbox" spellcheck="true" tabindex="0" style="outline: none; white-space: pre-wrap; word-wrap: break-word;"><div data-contents="true"><div class="Editable-unstyled" data-block="true" data-editor="3mvqc" data-offset-key="enqou-0-0"><div data-offset-key="enqou-0-0" class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr"><span data-offset-key="enqou-0-0"><br data-text="true"></span></div></div></div></div></div></div></div><input type="file" multiple="" accept="image/jpg,image/jpeg,image/png,image/gif" style="display: none;"><!-- react-empty: 167 --><!-- react-empty: 168 --><div></div><!-- react-empty: 170 --><!-- react-empty: 171 --><!-- react-empty: 172 --></div></div><div class="CommentEditor-actions"><button class="Button Button--plain" type="button"><!-- react-text: 127 -->取消<!-- /react-text --></button><button class="Button Button--blue" disabled="" type="button"><!-- react-text: 129 -->评论<!-- /react-text --></button></div></div></div><div class="PostCommentList"><div class="CommentItem"><a class="UserAvatar CommentItem-author" href="https://www.zhihu.com/people/kaede-50" target="_blank"><img class="Avatar-hemingway Avatar--xs" alt="KAEDE" src="./给深度学习入门者的Python快速教程 - 番外篇之Python-OpenCV_files/v2-c0a4dfdcf7ecd78dc05a863472c45bf7_xs.jpg" srcset="https://pic2.zhimg.com/v2-c0a4dfdcf7ecd78dc05a863472c45bf7_l.jpg 2x"></a><div class="CommentItem-headWrapper"><div class="CommentItem-head"><span class="CommentItem-context"><a href="https://www.zhihu.com/people/kaede-50" class="" target="_blank">KAEDE</a></span></div></div><div class="CommentItem-content">最近正在学习，感谢楼主！</div><div class="CommentItem-foot"><span class="CommentItem-like" title="1 人觉得这个很赞"><!-- react-text: 183 -->1<!-- /react-text --><!-- react-text: 184 --> 赞<!-- /react-text --></span><div class="HoverTitle CommentItem-createdTime" data-hover-title="2016 年 12月 18 日星期日中午 12 点 08 分"><time datetime="Sun Dec 18 2016 12:08:32 GMT+0800 (中国标准时间)">1 年前</time></div><button class="Button CommentItem-action CommentItem-actionLike Button--plain" type="button"><i class="icon icon-ic_comment_like"></i><!-- react-text: 189 -->赞<!-- /react-text --></button><div class="Report CommentItem-action CommentItem-actionReport"><button class="Button Button Button--plain ReportButton" type="button"><i class="icon icon-ic_column_report"></i><!-- react-text: 193 -->举报<!-- /react-text --></button><!-- react-empty: 194 --></div></div><!-- react-empty: 195 --></div><div class="CommentItem"><a class="UserAvatar CommentItem-author" href="https://www.zhihu.com/people/zhang-jun-long-4" target="_blank"><img class="Avatar-hemingway Avatar--xs" alt="张均隆" src="./给深度学习入门者的Python快速教程 - 番外篇之Python-OpenCV_files/3856d4751_xs.jpg" srcset="https://pic2.zhimg.com/3856d4751_l.jpg 2x"></a><div class="CommentItem-headWrapper"><div class="CommentItem-head"><span class="CommentItem-context"><a href="https://www.zhihu.com/people/zhang-jun-long-4" class="" target="_blank">张均隆</a></span></div></div><div class="CommentItem-content">感谢楼主，希望能有更多深度学习+python教程</div><div class="CommentItem-foot"><span class="CommentItem-like CommentItem-like--empty" title="0 人觉得这个很赞"><!-- react-text: 206 -->0<!-- /react-text --><!-- react-text: 207 --> 赞<!-- /react-text --></span><div class="HoverTitle CommentItem-createdTime" data-hover-title="2016 年 12月 18 日星期日下午 1 点 39 分"><time datetime="Sun Dec 18 2016 13:39:14 GMT+0800 (中国标准时间)">1 年前</time></div><button class="Button CommentItem-action CommentItem-actionLike Button--plain" type="button"><i class="icon icon-ic_comment_like"></i><!-- react-text: 212 -->赞<!-- /react-text --></button><div class="Report CommentItem-action CommentItem-actionReport"><button class="Button Button Button--plain ReportButton" type="button"><i class="icon icon-ic_column_report"></i><!-- react-text: 216 -->举报<!-- /react-text --></button><!-- react-empty: 217 --></div></div><!-- react-empty: 218 --></div><div class="CommentItem"><a class="UserAvatar CommentItem-author" href="https://www.zhihu.com/people/he-bi-wen-31" target="_blank"><img class="Avatar-hemingway Avatar--xs" alt="何必问" src="./给深度学习入门者的Python快速教程 - 番外篇之Python-OpenCV_files/a0dc82a37a5e39a03e49e87c14a87323_xs.jpg" srcset="https://pic1.zhimg.com/a0dc82a37a5e39a03e49e87c14a87323_l.jpg 2x"></a><div class="CommentItem-headWrapper"><div class="CommentItem-head"><span class="CommentItem-context"><a href="https://www.zhihu.com/people/he-bi-wen-31" class="" target="_blank">何必问</a></span></div></div><div class="CommentItem-content">毕业设计做手势识别老师说先学opencv正好用上了</div><div class="CommentItem-foot"><span class="CommentItem-like" title="3 人觉得这个很赞"><!-- react-text: 229 -->3<!-- /react-text --><!-- react-text: 230 --> 赞<!-- /react-text --></span><div class="HoverTitle CommentItem-createdTime" data-hover-title="2016 年 12月 18 日星期日晚上 6 点 57 分"><time datetime="Sun Dec 18 2016 18:57:05 GMT+0800 (中国标准时间)">1 年前</time></div><button class="Button CommentItem-action CommentItem-actionLike Button--plain" type="button"><i class="icon icon-ic_comment_like"></i><!-- react-text: 235 -->赞<!-- /react-text --></button><div class="Report CommentItem-action CommentItem-actionReport"><button class="Button Button Button--plain ReportButton" type="button"><i class="icon icon-ic_column_report"></i><!-- react-text: 239 -->举报<!-- /react-text --></button><!-- react-empty: 240 --></div></div><!-- react-empty: 241 --></div><div class="CommentItem"><a class="UserAvatar CommentItem-author" href="https://www.zhihu.com/people/bobliu20" target="_blank"><img class="Avatar-hemingway Avatar--xs" alt="BobLiu" src="./给深度学习入门者的Python快速教程 - 番外篇之Python-OpenCV_files/d19789ab6_xs.jpg" srcset="https://pic3.zhimg.com/d19789ab6_l.jpg 2x"></a><div class="CommentItem-headWrapper"><div class="CommentItem-head"><span class="CommentItem-context"><a href="https://www.zhihu.com/people/bobliu20" class="" target="_blank">BobLiu</a></span></div></div><div class="CommentItem-content">坐等数据扩充出来。。。</div><div class="CommentItem-foot"><span class="CommentItem-like CommentItem-like--empty" title="0 人觉得这个很赞"><!-- react-text: 252 -->0<!-- /react-text --><!-- react-text: 253 --> 赞<!-- /react-text --></span><div class="HoverTitle CommentItem-createdTime" data-hover-title="2016 年 12月 18 日星期日晚上 10 点 38 分"><time datetime="Sun Dec 18 2016 22:38:50 GMT+0800 (中国标准时间)">1 年前</time></div><button class="Button CommentItem-action CommentItem-actionLike Button--plain" type="button"><i class="icon icon-ic_comment_like"></i><!-- react-text: 258 -->赞<!-- /react-text --></button><div class="Report CommentItem-action CommentItem-actionReport"><button class="Button Button Button--plain ReportButton" type="button"><i class="icon icon-ic_column_report"></i><!-- react-text: 262 -->举报<!-- /react-text --></button><!-- react-empty: 263 --></div></div><!-- react-empty: 264 --></div><div class="CommentItem"><a class="UserAvatar CommentItem-author" href="https://www.zhihu.com/people/yi-yang-15" target="_blank"><img class="Avatar-hemingway Avatar--xs" alt="逸阳" src="./给深度学习入门者的Python快速教程 - 番外篇之Python-OpenCV_files/da8e974dc_xs.jpg" srcset="https://pic4.zhimg.com/da8e974dc_l.jpg 2x"></a><div class="CommentItem-headWrapper"><div class="CommentItem-head"><span class="CommentItem-context"><a href="https://www.zhihu.com/people/yi-yang-15" class="" target="_blank">逸阳</a></span></div></div><div class="CommentItem-content">一直跟踪楼主的更新，希望楼主讲解个视频中目标检测或目标跟踪，标注的栗子，谢谢</div><div class="CommentItem-foot"><span class="CommentItem-like CommentItem-like--empty" title="0 人觉得这个很赞"><!-- react-text: 275 -->0<!-- /react-text --><!-- react-text: 276 --> 赞<!-- /react-text --></span><div class="HoverTitle CommentItem-createdTime" data-hover-title="2016 年 12月 19 日星期一晚上 10 点 58 分"><time datetime="Mon Dec 19 2016 22:58:48 GMT+0800 (中国标准时间)">1 年前</time></div><button class="Button CommentItem-action CommentItem-actionLike Button--plain" type="button"><i class="icon icon-ic_comment_like"></i><!-- react-text: 281 -->赞<!-- /react-text --></button><div class="Report CommentItem-action CommentItem-actionReport"><button class="Button Button Button--plain ReportButton" type="button"><i class="icon icon-ic_column_report"></i><!-- react-text: 285 -->举报<!-- /react-text --></button><!-- react-empty: 286 --></div></div><!-- react-empty: 287 --></div><div class="CommentItem"><a class="UserAvatar CommentItem-author" href="https://www.zhihu.com/people/frombeijingwithlove" target="_blank"><img class="Avatar-hemingway Avatar--xs" alt="達聞西" src="./给深度学习入门者的Python快速教程 - 番外篇之Python-OpenCV_files/v2-e3036b85796de307726b34472d0d126c_xs.jpg" srcset="https://pic1.zhimg.com/v2-e3036b85796de307726b34472d0d126c_l.jpg 2x"></a><div class="CommentItem-headWrapper"><button class="Button CommentItem-conversationButton Button--plain" type="button"><i class="icon icon-ic_conversations"></i><!-- react-text: 294 --> 查看对话<!-- /react-text --></button><div class="CommentItem-head CommentItem-head--rightPad"><span class="CommentItem-context"><a href="https://www.zhihu.com/people/frombeijingwithlove" class="" target="_blank">達聞西</a><span class="CommentItem-authorTitle">（作者）</span><span class="CommentItem-replyTo"><span class="CommentItem-replySplit">回复</span><a href="https://www.zhihu.com/people/kaede-50" class="" target="_blank">KAEDE</a></span></span></div></div><div class="CommentItem-content">感谢支持！</div><div class="CommentItem-foot"><span class="CommentItem-like CommentItem-like--empty" title="0 人觉得这个很赞"><!-- react-text: 305 -->0<!-- /react-text --><!-- react-text: 306 --> 赞<!-- /react-text --></span><div class="HoverTitle CommentItem-createdTime" data-hover-title="2016 年 12月 20 日星期二晚上 10 点 55 分"><time datetime="Tue Dec 20 2016 22:55:36 GMT+0800 (中国标准时间)">1 年前</time></div><button class="Button CommentItem-action CommentItem-actionLike Button--plain" type="button"><i class="icon icon-ic_comment_like"></i><!-- react-text: 311 -->赞<!-- /react-text --></button><div class="Report CommentItem-action CommentItem-actionReport"><button class="Button Button Button--plain ReportButton" type="button"><i class="icon icon-ic_column_report"></i><!-- react-text: 315 -->举报<!-- /react-text --></button><!-- react-empty: 316 --></div></div><!-- react-empty: 317 --></div><div class="CommentItem"><a class="UserAvatar CommentItem-author" href="https://www.zhihu.com/people/frombeijingwithlove" target="_blank"><img class="Avatar-hemingway Avatar--xs" alt="達聞西" src="./给深度学习入门者的Python快速教程 - 番外篇之Python-OpenCV_files/v2-e3036b85796de307726b34472d0d126c_xs.jpg" srcset="https://pic1.zhimg.com/v2-e3036b85796de307726b34472d0d126c_l.jpg 2x"></a><div class="CommentItem-headWrapper"><button class="Button CommentItem-conversationButton Button--plain" type="button"><i class="icon icon-ic_conversations"></i><!-- react-text: 324 --> 查看对话<!-- /react-text --></button><div class="CommentItem-head CommentItem-head--rightPad"><span class="CommentItem-context"><a href="https://www.zhihu.com/people/frombeijingwithlove" class="" target="_blank">達聞西</a><span class="CommentItem-authorTitle">（作者）</span><span class="CommentItem-replyTo"><span class="CommentItem-replySplit">回复</span><a href="https://www.zhihu.com/people/zhang-jun-long-4" class="" target="_blank">张均隆</a></span></span></div></div><div class="CommentItem-content">谢谢支持:) 有空会持续写一些</div><div class="CommentItem-foot"><span class="CommentItem-like CommentItem-like--empty" title="0 人觉得这个很赞"><!-- react-text: 335 -->0<!-- /react-text --><!-- react-text: 336 --> 赞<!-- /react-text --></span><div class="HoverTitle CommentItem-createdTime" data-hover-title="2016 年 12月 20 日星期二晚上 10 点 56 分"><time datetime="Tue Dec 20 2016 22:56:19 GMT+0800 (中国标准时间)">1 年前</time></div><button class="Button CommentItem-action CommentItem-actionLike Button--plain" type="button"><i class="icon icon-ic_comment_like"></i><!-- react-text: 341 -->赞<!-- /react-text --></button><div class="Report CommentItem-action CommentItem-actionReport"><button class="Button Button Button--plain ReportButton" type="button"><i class="icon icon-ic_column_report"></i><!-- react-text: 345 -->举报<!-- /react-text --></button><!-- react-empty: 346 --></div></div><!-- react-empty: 347 --></div><div class="CommentItem"><a class="UserAvatar CommentItem-author" href="https://www.zhihu.com/people/frombeijingwithlove" target="_blank"><img class="Avatar-hemingway Avatar--xs" alt="達聞西" src="./给深度学习入门者的Python快速教程 - 番外篇之Python-OpenCV_files/v2-e3036b85796de307726b34472d0d126c_xs.jpg" srcset="https://pic1.zhimg.com/v2-e3036b85796de307726b34472d0d126c_l.jpg 2x"></a><div class="CommentItem-headWrapper"><button class="Button CommentItem-conversationButton Button--plain" type="button"><i class="icon icon-ic_conversations"></i><!-- react-text: 354 --> 查看对话<!-- /react-text --></button><div class="CommentItem-head CommentItem-head--rightPad"><span class="CommentItem-context"><a href="https://www.zhihu.com/people/frombeijingwithlove" class="" target="_blank">達聞西</a><span class="CommentItem-authorTitle">（作者）</span><span class="CommentItem-replyTo"><span class="CommentItem-replySplit">回复</span><a href="https://www.zhihu.com/people/he-bi-wen-31" class="" target="_blank">何必问</a></span></span></div></div><div class="CommentItem-content">:)</div><div class="CommentItem-foot"><span class="CommentItem-like CommentItem-like--empty" title="0 人觉得这个很赞"><!-- react-text: 365 -->0<!-- /react-text --><!-- react-text: 366 --> 赞<!-- /react-text --></span><div class="HoverTitle CommentItem-createdTime" data-hover-title="2016 年 12月 20 日星期二晚上 10 点 56 分"><time datetime="Tue Dec 20 2016 22:56:33 GMT+0800 (中国标准时间)">1 年前</time></div><button class="Button CommentItem-action CommentItem-actionLike Button--plain" type="button"><i class="icon icon-ic_comment_like"></i><!-- react-text: 371 -->赞<!-- /react-text --></button><div class="Report CommentItem-action CommentItem-actionReport"><button class="Button Button Button--plain ReportButton" type="button"><i class="icon icon-ic_column_report"></i><!-- react-text: 375 -->举报<!-- /react-text --></button><!-- react-empty: 376 --></div></div><!-- react-empty: 377 --></div><div class="CommentItem"><a class="UserAvatar CommentItem-author" href="https://www.zhihu.com/people/frombeijingwithlove" target="_blank"><img class="Avatar-hemingway Avatar--xs" alt="達聞西" src="./给深度学习入门者的Python快速教程 - 番外篇之Python-OpenCV_files/v2-e3036b85796de307726b34472d0d126c_xs.jpg" srcset="https://pic1.zhimg.com/v2-e3036b85796de307726b34472d0d126c_l.jpg 2x"></a><div class="CommentItem-headWrapper"><button class="Button CommentItem-conversationButton Button--plain" type="button"><i class="icon icon-ic_conversations"></i><!-- react-text: 384 --> 查看对话<!-- /react-text --></button><div class="CommentItem-head CommentItem-head--rightPad"><span class="CommentItem-context"><a href="https://www.zhihu.com/people/frombeijingwithlove" class="" target="_blank">達聞西</a><span class="CommentItem-authorTitle">（作者）</span><span class="CommentItem-replyTo"><span class="CommentItem-replySplit">回复</span><a href="https://www.zhihu.com/people/bobliu20" class="" target="_blank">BobLiu</a></span></span></div></div><div class="CommentItem-content">出来了。。。不过只是个玩具级别的小例子</div><div class="CommentItem-foot"><span class="CommentItem-like CommentItem-like--empty" title="0 人觉得这个很赞"><!-- react-text: 395 -->0<!-- /react-text --><!-- react-text: 396 --> 赞<!-- /react-text --></span><div class="HoverTitle CommentItem-createdTime" data-hover-title="2016 年 12月 20 日星期二晚上 10 点 57 分"><time datetime="Tue Dec 20 2016 22:57:15 GMT+0800 (中国标准时间)">1 年前</time></div><button class="Button CommentItem-action CommentItem-actionLike Button--plain" type="button"><i class="icon icon-ic_comment_like"></i><!-- react-text: 401 -->赞<!-- /react-text --></button><div class="Report CommentItem-action CommentItem-actionReport"><button class="Button Button Button--plain ReportButton" type="button"><i class="icon icon-ic_column_report"></i><!-- react-text: 405 -->举报<!-- /react-text --></button><!-- react-empty: 406 --></div></div><!-- react-empty: 407 --></div><div class="CommentItem"><a class="UserAvatar CommentItem-author" href="https://www.zhihu.com/people/frombeijingwithlove" target="_blank"><img class="Avatar-hemingway Avatar--xs" alt="達聞西" src="./给深度学习入门者的Python快速教程 - 番外篇之Python-OpenCV_files/v2-e3036b85796de307726b34472d0d126c_xs.jpg" srcset="https://pic1.zhimg.com/v2-e3036b85796de307726b34472d0d126c_l.jpg 2x"></a><div class="CommentItem-headWrapper"><button class="Button CommentItem-conversationButton Button--plain" type="button"><i class="icon icon-ic_conversations"></i><!-- react-text: 414 --> 查看对话<!-- /react-text --></button><div class="CommentItem-head CommentItem-head--rightPad"><span class="CommentItem-context"><a href="https://www.zhihu.com/people/frombeijingwithlove" class="" target="_blank">達聞西</a><span class="CommentItem-authorTitle">（作者）</span><span class="CommentItem-replyTo"><span class="CommentItem-replySplit">回复</span><a href="https://www.zhihu.com/people/yi-yang-15" class="" target="_blank">逸阳</a></span></span></div></div><div class="CommentItem-content">抱歉，视频真是懂得不多。。不过标注的例子稍后会完成放出</div><div class="CommentItem-foot"><span class="CommentItem-like CommentItem-like--empty" title="0 人觉得这个很赞"><!-- react-text: 425 -->0<!-- /react-text --><!-- react-text: 426 --> 赞<!-- /react-text --></span><div class="HoverTitle CommentItem-createdTime" data-hover-title="2016 年 12月 20 日星期二晚上 10 点 57 分"><time datetime="Tue Dec 20 2016 22:57:45 GMT+0800 (中国标准时间)">1 年前</time></div><button class="Button CommentItem-action CommentItem-actionLike Button--plain" type="button"><i class="icon icon-ic_comment_like"></i><!-- react-text: 431 -->赞<!-- /react-text --></button><div class="Report CommentItem-action CommentItem-actionReport"><button class="Button Button Button--plain ReportButton" type="button"><i class="icon icon-ic_column_report"></i><!-- react-text: 435 -->举报<!-- /react-text --></button><!-- react-empty: 436 --></div></div><!-- react-empty: 437 --></div><div class="Pagination PostComment-pagination"><button class="Button PaginationButton PaginationButton--current Button--plain" disabled="" type="button"><!-- react-text: 133 -->1<!-- /react-text --></button><button class="Button PaginationButton Button--plain" type="button"><!-- react-text: 135 -->2<!-- /react-text --></button><button class="Button PaginationButton Button--plain" type="button"><!-- react-text: 137 -->3<!-- /react-text --></button><button class="Button PaginationButton Button--plain" type="button"><!-- react-text: 139 -->4<!-- /react-text --></button><span class="PaginationButton PaginationButton--fake">...</span><button class="Button PaginationButton Button--plain" type="button"><!-- react-text: 142 -->6<!-- /react-text --></button><button class="Button PaginationButton PaginationButton-next Button--plain" type="button"><!-- react-text: 144 -->下一页<!-- /react-text --></button></div></div><!-- react-empty: 145 --><!-- react-empty: 146 --></div><div class="PostIndex-recommendZone av-card"><div class="BlockTitle av-marginLeft av-borderColor"><span class="BlockTitle-title">推荐阅读</span><span class="BlockTitle-line"></span></div><ul class="PostIndex-recommends"><li class="PostIndex-recommendItem av-marginLeft av-borderColor"><div class="PostListItem PostListItem--narrow av-paddingRight"><a class="PostListItem-titleImageWrapper" href="https://zhuanlan.zhihu.com/p/30670165"><img src="./给深度学习入门者的Python快速教程 - 番外篇之Python-OpenCV_files/v2-4f3902b6a365ac347e231666721c23e3_b.jpg" class="PostListItem-titleImage" alt="题图"></a><div class="PostListItem-info"><a href="https://zhuanlan.zhihu.com/p/30670165"><span class="PostListItem-title">[171102] Python3 OpenCV3 图像处理基础(Python3 + Numpy + Matplotlib + OpenCV3 + PyQt5 ...)</span><p class="PostListItem-summary"><!-- react-text: 451 -->原创内容，禁止转载！导读：这是 Python OpenCV 图像处理 专栏的第2篇文章，主要介绍了使用 …<!-- /react-text --><span class="PostListItem-readall"><!-- react-text: 453 -->查看全文<!-- /react-text --><i class="icon icon-ic_unfold"></i></span></p></a><div class="PostListItem-footer"><span><a class="PostListItem-name" target="_blank" href="https://www.zhihu.com/people/iausk">Silencer</a><span class="Bull"></span><div class="HoverTitle PostListItem-date" data-hover-title="2017 年 11月 2 日星期四下午 1 点 23 分"><time datetime="2017-11-02T13:23:36+08:00">3 个月前</time></div></span></div></div></div></li><li class="PostIndex-recommendItem av-marginLeft av-borderColor"><div class="PostListItem PostListItem--narrow av-paddingRight"><a class="PostListItem-titleImageWrapper" href="https://zhuanlan.zhihu.com/p/24162430"><img src="./给深度学习入门者的Python快速教程 - 番外篇之Python-OpenCV_files/v2-91e7e47956a3088e5aeeba03223bb33f_b.jpg" class="PostListItem-titleImage" alt="题图"></a><div class="PostListItem-info"><a href="https://zhuanlan.zhihu.com/p/24162430"><span class="PostListItem-title">给深度学习入门者的Python快速教程 - 基础篇</span><p class="PostListItem-summary"><!-- react-text: 469 -->下篇：给深度学习入门者的Python快速教程 - numpy和Matplotlib篇Life is short, you need Py…<!-- /react-text --><span class="PostListItem-readall"><!-- react-text: 471 -->查看全文<!-- /react-text --><i class="icon icon-ic_unfold"></i></span></p></a><div class="PostListItem-footer"><span><a class="PostListItem-name" target="_blank" href="https://www.zhihu.com/people/frombeijingwithlove">達聞西</a><span class="Bull"></span><div class="HoverTitle PostListItem-date" data-hover-title="2016 年 12月 4 日星期日晚上 6 点 15 分"><time datetime="2016-12-04T18:15:35+08:00">1 年前</time></div></span></div></div></div></li><li class="PostIndex-recommendItem av-marginLeft av-borderColor"><div class="PostListItem PostListItem--narrow av-paddingRight"><a class="PostListItem-titleImageWrapper" href="https://zhuanlan.zhihu.com/p/28489649"><img src="./给深度学习入门者的Python快速教程 - 番外篇之Python-OpenCV_files/v2-128b19d0253ed704a0bd9e10aac55088_b.jpg" class="PostListItem-titleImage" alt="题图"></a><div class="PostListItem-info"><a href="https://zhuanlan.zhihu.com/p/28489649"><span class="PostListItem-title">OpenCV: 图片人脸识别</span><p class="PostListItem-summary"><!-- react-text: 487 -->现在正在做论文，数据处理过程中有一个变量是对用户头像进行数据编码。图片有上万张，如果人…<!-- /react-text --><span class="PostListItem-readall"><!-- react-text: 489 -->查看全文<!-- /react-text --><i class="icon icon-ic_unfold"></i></span></p></a><div class="PostListItem-footer"><span><a class="PostListItem-name" target="_blank" href="https://www.zhihu.com/people/deng-xu-dong-hit">邓旭东HIT</a><span class="Bull"></span><div class="HoverTitle PostListItem-date" data-hover-title="2017 年 8月 13 日星期日下午 2 点 47 分"><time datetime="2017-08-13T14:47:21+08:00">5 个月前</time></div><span class="PostListItem-source"><span class="Bull"></span><span class="PostListItem-sourcePrefix">发表于 </span><a title="爱上数据科学" href="https://zhuanlan.zhihu.com/dadeng">爱上数据科学</a></span></span></div></div></div></li><li class="PostIndex-recommendItem av-marginLeft av-borderColor"><div class="PostListItem PostListItem--narrow av-paddingRight"><a class="PostListItem-titleImageWrapper" href="https://zhuanlan.zhihu.com/p/33103688"><img src="./给深度学习入门者的Python快速教程 - 番外篇之Python-OpenCV_files/v2-5e8c87a84712f7741c20085cbd960fe6_b.jpg" class="PostListItem-titleImage" alt="题图"></a><div class="PostListItem-info"><a href="https://zhuanlan.zhihu.com/p/33103688"><span class="PostListItem-title">【小林的OpenCV基础课 番外】Spyder下配置OpenCV</span><p class="PostListItem-summary"><!-- react-text: 509 -->こんにちは皆、私はソルです（≧∇≦）我家小林刚加完班，需要休息。下面由托尔酱介绍下如何…<!-- /react-text --><span class="PostListItem-readall"><!-- react-text: 511 -->查看全文<!-- /react-text --><i class="icon icon-ic_unfold"></i></span></p></a><div class="PostListItem-footer"><span><a class="PostListItem-name" target="_blank" href="https://www.zhihu.com/people/liu-guan-cheng-32">小林同学</a><span class="Bull"></span><div class="HoverTitle PostListItem-date" data-hover-title="2018 年 1月 19 日星期五下午 4 点 37 分"><time datetime="2018-01-19T16:37:32+08:00">5 天前</time></div><span class="PostListItem-source"><span class="Bull"></span><span class="PostListItem-sourcePrefix">发表于 </span><a title="小林的CV视觉工坊" href="https://zhuanlan.zhihu.com/c_154380889">小林的CV视觉工坊</a></span></span></div></div></div></li></ul></div><!-- react-empty: 147 --><!-- react-empty: 148 --></div></div><!-- react-empty: 149 --><!-- react-empty: 150 --><!-- react-empty: 151 --></div></div><textarea id="clientConfig" hidden="">{"debug":false,"apiRoot":"","paySDK":"https:\u002F\u002Fpay.zhihu.com\u002Fapi\u002Fjs","wechatConfigAPI":"\u002Fapi\u002Fwechat\u002Fjssdkconfig","name":"production","instance":"column","tokens":{"X-XSRF-TOKEN":null,"X-UDID":null,"Authorization":"oauth c3cef7c66a1843f8b3a9e6a1e3160e20"}}</textarea><textarea id="preloadedState" hidden="">{"database":{"Post":{"24425116":{"isPending":false,"contributes":[{"sourceColumn":{"lastUpdated":1487510552,"description":"","permission":"COLUMN_PUBLIC","memberId":1510194,"contributePermission":"COLUMN_PRIVATE","translatedCommentPermission":"all","canManage":true,"intro":"视觉、计算","urlToken":"frombeijingwithlove","id":28436,"imagePath":"v2-de9efff9dc136da1fb54bd00beb38477.jpg","slug":"frombeijingwithlove","applyReason":"0","name":"From Beijing with Love","title":"From Beijing with Love","url":"https:\u002F\u002Fzhuanlan.zhihu.com\u002Ffrombeijingwithlove","commentPermission":"COLUMN_ALL_CAN_COMMENT","canPost":true,"created":1487051627,"state":"COLUMN_NORMAL","followers":6045,"avatar":{"id":"v2-de9efff9dc136da1fb54bd00beb38477","template":"https:\u002F\u002Fpic3.zhimg.com\u002F{id}_{size}.jpg"},"activateAuthorRequested":false,"following":false,"imageUrl":"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-de9efff9dc136da1fb54bd00beb38477_l.jpg","articlesCount":11},"state":"accepted","targetPost":{"titleImage":"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-1712545c1114f3f66f37121c02354144_r.jpg","lastUpdated":1500047173,"imagePath":"v2-1712545c1114f3f66f37121c02354144.png","permission":"ARTICLE_PUBLIC","topics":[12482,872,89794],"summary":"本篇是前面两篇教程：\u003Ca href=\"https:\u002F\u002Fzhuanlan.zhihu.com\u002Fp\u002F24162430\"\u003E给深度学习入门者的Python快速教程 - 基础篇\u003C\u002Fa\u003E\u003Ca href=\"https:\u002F\u002Fzhuanlan.zhihu.com\u002Fp\u002F24309547\"\u003E给深度学习入门者的Python快速教程 - numpy和Matplotlib篇\u003C\u002Fa\u003E的番外篇，因为严格来说不是在讲Python而是讲在Python下使用OpenCV。本篇将介绍和深度学习数据处理阶段最相关的基础使用，并完成4个…","copyPermission":"ARTICLE_COPYABLE","translatedCommentPermission":"all","likes":0,"origAuthorId":0,"publishedTime":"2016-12-17T22:57:55+08:00","sourceUrl":"","urlToken":24425116,"id":1956660,"withContent":false,"slug":24425116,"bigTitleImage":false,"title":"给深度学习入门者的Python快速教程 - 番外篇之Python-OpenCV","url":"\u002Fp\u002F24425116","commentPermission":"ARTICLE_ALL_CAN_COMMENT","snapshotUrl":"","created":1481986675,"comments":0,"columnId":0,"content":"","parentId":0,"state":"ARTICLE_PUBLISHED","imageUrl":"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-1712545c1114f3f66f37121c02354144_r.jpg","author":{"bio":"","isFollowing":false,"hash":"661cd655d168712a683ed76b5e5d1d03","uid":33009986174976,"isOrg":false,"slug":"frombeijingwithlove","isFollowed":false,"description":"","name":"達聞西","profileUrl":"https:\u002F\u002Fwww.zhihu.com\u002Fpeople\u002Ffrombeijingwithlove","avatar":{"id":"v2-e3036b85796de307726b34472d0d126c","template":"https:\u002F\u002Fpic1.zhimg.com\u002F{id}_{size}.jpg"},"isOrgWhiteList":false,"isBanned":false},"memberId":1510194,"excerptTitle":"","voteType":"ARTICLE_VOTE_CLEAR"},"id":547916}],"title":"给深度学习入门者的Python快速教程 - 番外篇之Python-OpenCV","author":"frombeijingwithlove","content":"\u003Cp\u003E本篇是前面两篇教程：\u003Ca href=\"https:\u002F\u002Fzhuanlan.zhihu.com\u002Fp\u002F24162430\" class=\"internal\"\u003E给深度学习入门者的Python快速教程 - 基础篇\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fzhuanlan.zhihu.com\u002Fp\u002F24309547\" class=\"internal\"\u003E给深度学习入门者的Python快速教程 - numpy和Matplotlib篇\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003Cp\u003E的番外篇，因为严格来说不是在讲Python而是讲在Python下使用OpenCV。本篇将介绍和深度学习数据处理阶段最相关的基础使用，并完成4个有趣实用的小例子：\u003C\u002Fp\u003E\u003Cp\u003E- 延时摄影小程序\u003C\u002Fp\u003E\u003Cp\u003E- 视频中截屏采样的小程序\u003C\u002Fp\u003E\u003Cp\u003E- 图片数据增加（data\naugmentation）的小工具\u003C\u002Fp\u003E\u003Cp\u003E- 物体检测框标注小工具\u003C\u002Fp\u003E\u003Cp\u003E其中后两个例子的代码可以在下面地址直接下载：\u003C\u002Fp\u003E\u003Cp\u003E\u003Ca href=\"http:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fgithub.com\u002Ffrombeijingwithlove\u002Fdlcv_for_beginners\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003Efrombeijingwithlove\u002Fdlcv_for_beginners\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003Ch2\u003E6.1 OpenCV简介\u003C\u002Fh2\u003E\u003Cp\u003EOpenCV是计算机视觉领域应用最广泛的开源工具包，基于C\u002FC++，支持Linux\u002FWindows\u002FMacOS\u002FAndroid\u002FiOS，并提供了Python，Matlab和Java等语言的接口，因为其丰富的接口，优秀的性能和商业友好的使用许可，不管是学术界还是业界中都非常受欢迎。OpenCV最早源于Intel公司1998年的一个研究项目，当时在Intel从事计算机视觉的工程师盖瑞·布拉德斯基(Gary Bradski)访问一些大学和研究组时发现学生之间实现计算机视觉算法用的都是各自实验室里的内部代码或者库，这样新来实验室的学生就能基于前人写的基本函数快速上手进行研究。于是OpenCV旨在提供一个用于计算机视觉的科研和商业应用的高性能通用库。\n第一个alpha版本的OpenCV于2000年的CVPR上发布，在接下来的5年里，又陆续发布了5个beta版本，2006年发布了第一个正式版。2009年随着盖瑞加入了Willow\nGarage，OpenCV从Willow Garage得到了积极的支持，并发布了1.1版。2010年OpenCV发布了2.0版本，添加了非常完备的C++接口，从2.0开始的版本非常用户非常庞大，至今仍在维护和更新。2015年OpenCV 3正式发布，除了架构的调整，还加入了更多算法，更多性能的优化和更加简洁的API，另外也加强了对GPU的支持，现在已经在许多研究机构和商业公司中应用开来。\n\u003C\u002Fp\u003E\u003Ch2\u003E6.1.1\nOpenCV的结构\u003C\u002Fh2\u003E\u003Cp\u003E和Python一样，当前的OpenCV也有两个大版本，OpenCV2和OpenCV3。相比OpenCV2，OpenCV3提供了更强的功能和更多方便的特性。不过考虑到和深度学习框架的兼容性，以及上手安装的难度，这部分先以2为主进行介绍。\u003C\u002Fp\u003E\u003Cp\u003E根据功能和需求的不同，OpenCV中的函数接口大体可以分为如下部分：\u003C\u002Fp\u003E\u003Cp\u003E-         \ncore：核心模块，主要包含了OpenCV中最基本的结构（矩阵，点线和形状等），以及相关的基础运算\u002F操作。\u003C\u002Fp\u003E\u003Cp\u003E-         \nimgproc：图像处理模块，包含和图像相关的基础功能（滤波，梯度，改变大小等），以及一些衍生的高级功能（图像分割，直方图，形态分析和边缘\u002F直线提取等）。\u003C\u002Fp\u003E\u003Cp\u003E-         \nhighgui：提供了用户界面和文件读取的基本函数，比如图像显示窗口的生成和控制，图像\u002F视频文件的IO等。\u003C\u002Fp\u003E\u003Cp\u003E如果不考虑视频应用，以上三个就是最核心和常用的模块了。针对视频和一些特别的视觉应用，OpenCV也提供了强劲的支持：\u003C\u002Fp\u003E\u003Cp\u003E-         \nvideo：用于视频分析的常用功能，比如光流法（Optical Flow）和目标跟踪等。\u003C\u002Fp\u003E\u003Cp\u003E-         \ncalib3d：三维重建，立体视觉和相机标定等的相关功能。\u003C\u002Fp\u003E\u003Cp\u003E-         \nfeatures2d：二维特征相关的功能，主要是一些不受专利保护的，商业友好的特征点检测和匹配等功能，比如ORB特征。\u003C\u002Fp\u003E\u003Cp\u003E-         \nobject：目标检测模块，包含级联分类和Latent SVM\u003C\u002Fp\u003E\u003Cp\u003E-         \nml：机器学习算法模块，包含一些视觉中最常用的传统机器学习算法。\u003C\u002Fp\u003E\u003Cp\u003E-         \nflann：最近邻算法库，Fast Library for Approximate\nNearest Neighbors，用于在多维空间进行聚类和检索，经常和关键点匹配搭配使用。\u003C\u002Fp\u003E\u003Cp\u003E-         \ngpu：包含了一些gpu加速的接口，底层的加速是CUDA实现。\u003C\u002Fp\u003E\u003Cp\u003E-         \nphoto：计算摄像学（Computational Photography）相关的接口，当然这只是个名字，其实只有图像修复和降噪而已。\u003C\u002Fp\u003E\u003Cp\u003E-         \nstitching：图像拼接模块，有了它可以自己生成全景照片。\u003C\u002Fp\u003E\u003Cp\u003E-         \nnonfree：受到专利保护的一些算法，其实就是SIFT和SURF。\u003C\u002Fp\u003E\u003Cp\u003E-         \ncontrib：一些实验性质的算法，考虑在未来版本中加入的。\u003C\u002Fp\u003E\u003Cp\u003E-         \nlegacy：字面是遗产，意思就是废弃的一些接口，保留是考虑到向下兼容。\u003C\u002Fp\u003E\u003Cp\u003E-         \nocl：利用OpenCL并行加速的一些接口。\u003C\u002Fp\u003E\u003Cp\u003E-         \nsuperres：超分辨率模块，其实就是BTV-L1（Biliteral Total Variation – L1\nregularization）算法\u003C\u002Fp\u003E\u003Cp\u003E-         \nviz：基础的3D渲染模块，其实底层就是著名的3D工具包VTK（Visualization Toolkit）。\u003C\u002Fp\u003E\u003Cp\u003E从使用的角度来看，和OpenCV2相比，OpenCV3的主要变化是更多的功能和更细化的模块划分。\u003C\u002Fp\u003E\u003Ch2\u003E6.1.2\n安装和使用OpenCV\u003C\u002Fh2\u003E\u003Cp\u003E作为最流行的视觉包，在Linux中安装OpenCV是非常方便的，大多数Linux的发行版都支持包管理器的安装，比如在Ubuntu 16.04 LTS中，只需要在终端中输入：\u003C\u002Fp\u003E\u003Cp\u003E&amp;gt;&amp;gt; sudo apt install libopencv-dev\n  python-opencv\u003C\u002Fp\u003E\u003Cp\u003E当然也可以通过官网下载源码编译安装，第一步先安装各种依赖：\u003C\u002Fp\u003E\u003Cp\u003E&amp;gt;&amp;gt;\n  sudo apt install build-essential\u003C\u002Fp\u003E\u003Cp\u003E&amp;gt;&amp;gt;\n  sudo apt install cmake git libgtk2.0-dev pkg-config libavcodec-dev\n  libavformat-dev libswscale-dev\u003C\u002Fp\u003E\u003Cp\u003E&amp;gt;&amp;gt;\n  sudo apt-get install python-dev python-numpy libtbb2 libtbb-dev libjpeg-dev\n  libpng-dev libtiff-dev libjasper-dev libdc1394-22-dev\u003C\u002Fp\u003E\u003Cp\u003E然后找一个clone压缩包的文件夹，把源码拿下来：\u003C\u002Fp\u003E\u003Cp\u003E&amp;gt;&amp;gt; git clone\n  \u003Ca href=\"http:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fgithub.com\u002Fopencv\u002Fopencv.git\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003Eopencv\u002Fopencv\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003Cp\u003E然后进入OpenCV文件夹：\u003C\u002Fp\u003E\u003Cp\u003E&amp;gt;&amp;gt; mkdir release\u003C\u002Fp\u003E\u003Cp\u003E&amp;gt;&amp;gt; cd release\u003C\u002Fp\u003E\u003Cp\u003E&amp;gt;&amp;gt; cmake -D\n  CMAKE_BUILD_TYPE=RELEASE -D CMAKE_INSTALL_PREFIX=\u002Fusr\u002Flocal ..\u003C\u002Fp\u003E\u003Cp\u003E准备完毕，直接make并安装： \u003C\u002Fp\u003E\u003Cp\u003E&amp;gt;&amp;gt; make\u003C\u002Fp\u003E\u003Cp\u003E&amp;gt;&amp;gt; sudo make install\u003C\u002Fp\u003E\u003Cp\u003EWindows下的安装也很简单，直接去OpenCV官网下载：\u003C\u002Fp\u003E\u003Cp\u003E\u003Ca href=\"http:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fopencv.org\u002Fdownloads.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003EDOWNLOADS | OpenCV\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003Cp\u003E执行exe安装后，会在&amp;lt;安装目录&amp;gt;\u002Fbuild\u002Fpython\u002F2.7下发现一个叫cv2.pyd的文件，把这个文件拷贝到&amp;lt;Python目录&amp;gt;\\Lib\\site-packages下，就可以了。Windows下如果只想在Python中体验OpenCV还有个更简单的方法是加州大学尔湾分校（University of\nCalifornia, Irvine）的Christoph Gohlke制作的Windows下的Python科学计算包网页，下载对应版本的wheel文件，然后通过pip安装：\u003C\u002Fp\u003E\u003Cp\u003E\u003Ca href=\"http:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fwww.lfd.uci.edu\u002F%7Egohlke\u002Fpythonlibs\u002F%23opencv\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002Fwww.\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Elfd.uci.edu\u002F~gohlke\u002Fpyt\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003Ehonlibs\u002F#opencv\u003C\u002Fspan\u003E\u003Cspan class=\"ellipsis\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003Cp\u003E本书只讲Python下OpenCV基本使用，Python中导入OpenCV非常简单：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-python\"\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"kn\"\u003Eimport\u003C\u002Fspan\u003E \u003Cspan class=\"nn\"\u003Ecv2\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E就导入成功了。\n\u003C\u002Fp\u003E\u003Ch2\u003E6.2 Python-OpenCV基础\u003C\u002Fh2\u003E\u003Ch2\u003E6.2.1\n图像的表示\u003C\u002Fh2\u003E\u003Cp\u003E前面章节已经提到过了单通道的灰度图像在计算机中的表示，就是一个8位无符号整形的矩阵。在OpenCV的C++代码中，表示图像有个专门的结构叫做cv::Mat，不过在Python-OpenCV中，因为已经有了numpy这种强大的基础工具，所以这个矩阵就用numpy的array表示。如果是多通道情况，最常见的就是红绿蓝（RGB）三通道，则第一个维度是高度，第二个维度是高度，第三个维度是通道，比如图6-1a是一幅3×3图像在计算机中表示的例子：\u003C\u002Fp\u003E\u003Cfigure\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-9363ac86d8f4b9fde8fbef903851179c_b.jpg\" data-rawwidth=\"1017\" data-rawheight=\"701\" class=\"origin_image zh-lightbox-thumb\" width=\"1017\" data-original=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-9363ac86d8f4b9fde8fbef903851179c_r.jpg\"\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&amp;lt;svg%20xmlns='http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg'%20width='1017'%20height='701'&amp;gt;&amp;lt;\u002Fsvg&amp;gt;\" data-rawwidth=\"1017\" data-rawheight=\"701\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1017\" data-original=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-9363ac86d8f4b9fde8fbef903851179c_r.jpg\" data-actualsrc=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-9363ac86d8f4b9fde8fbef903851179c_b.jpg\"\u003E\u003C\u002Ffigure\u003E\u003Cp\u003E\u003Cb\u003E图6-1 RGB图像在计算机中表示的例子\u003C\u002Fb\u003E\u003C\u002Fp\u003E\u003Cp\u003E图6-1中，右上角的矩阵里每个元素都是一个3维数组，分别代表这个像素上的三个通道的值。最常见的RGB通道中，第一个元素就是红色（\u003Cb\u003ER\u003C\u002Fb\u003Eed）的值，第二个元素是绿色（\u003Cb\u003EG\u003C\u002Fb\u003Ereen）的值，第三个元素是蓝色（\u003Cb\u003EB\u003C\u002Fb\u003Elue），最终得到的图像如6-1a所示。RGB是最常见的情况，然而在OpenCV中，默认的图像的表示确实反过来的，也就是BGR，得到的图像是6-1b。可以看到，前两行的颜色顺序都交换了，最后一行是三个通道等值的灰度图，所以没有影响。至于OpenCV为什么不是人民群众喜闻乐见的RGB，这是历史遗留问题，在OpenCV刚开始研发的年代，BGR是相机设备厂商的主流表示方法，虽然后来RGB成了主流和默认，但是这个底层的顺序却保留下来了，事实上Windows下的最常见格式之一bmp，底层字节的存储顺序还是BGR。OpenCV的这个特殊之处还是需要注意的，比如在Python中，图像都是用numpy的array表示，但是同样的array在OpenCV中的显示效果和matplotlib中的显示效果就会不一样。下面的简单代码就可以生成两种表示方式下，图6-1中矩阵的对应的图像，生成图像后，放大看就能体会到区别：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-python\"\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"kn\"\u003Eimport\u003C\u002Fspan\u003E \u003Cspan class=\"nn\"\u003Enumpy\u003C\u002Fspan\u003E \u003Cspan class=\"kn\"\u003Eas\u003C\u002Fspan\u003E \u003Cspan class=\"nn\"\u003Enp\u003C\u002Fspan\u003E\n\u003Cspan class=\"kn\"\u003Eimport\u003C\u002Fspan\u003E \u003Cspan class=\"nn\"\u003Ecv2\u003C\u002Fspan\u003E\n\u003Cspan class=\"kn\"\u003Eimport\u003C\u002Fspan\u003E \u003Cspan class=\"nn\"\u003Ematplotlib.pyplot\u003C\u002Fspan\u003E \u003Cspan class=\"kn\"\u003Eas\u003C\u002Fspan\u003E \u003Cspan class=\"nn\"\u003Eplt\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# 图6-1中的矩阵\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Eimg\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Enp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Earray\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E([\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E[[\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E255\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E],\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E255\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E],\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E255\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]],\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E[[\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E255\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E255\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E],\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E255\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E255\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E],\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E255\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E255\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]],\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E[[\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E255\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E255\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E255\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E],\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E128\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E128\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E128\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E],\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]],\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E],\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Edtype\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Enp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Euint8\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# 用matplotlib存储\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Eplt\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimsave\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'img_pyplot.jpg'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eimg\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# 用OpenCV存储\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimwrite\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'img_cv2.jpg'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eimg\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E不管是RGB还是BGR，都是高度×宽度×通道数，H×W×C的表达方式，而在深度学习中，因为要对不同通道应用卷积，所以用的是另一种方式：C×H×W，就是把每个通道都单独表达成一个二维矩阵，如图6-1c所示。\u003C\u002Fp\u003E\u003Ch2\u003E6.2.2\n基本图像处理\u003C\u002Fh2\u003E\u003Cp\u003E\u003Cb\u003E存取图像\u003C\u002Fb\u003E\u003C\u002Fp\u003E\u003Cp\u003E读图像用cv2.imread()，可以按照不同模式读取，一般最常用到的是读取单通道灰度图，或者直接默认读取多通道。存图像用cv2.imwrite()，注意存的时候是没有单通道这一说的，根据保存文件名的后缀和当前的array维度，OpenCV自动判断存的通道，另外压缩格式还可以指定存储质量，来看代码例子：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-python\"\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"kn\"\u003Eimport\u003C\u002Fspan\u003E \u003Cspan class=\"nn\"\u003Ecv2\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# 读取一张400x600分辨率的图像\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Ecolor_img\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimread\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'test_400x600.jpg'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\u003Cspan class=\"k\"\u003Eprint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecolor_img\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eshape\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# 直接读取单通道\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Egray_img\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimread\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'test_400x600.jpg'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EIMREAD_GRAYSCALE\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\u003Cspan class=\"k\"\u003Eprint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Egray_img\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eshape\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# 把单通道图片保存后，再读取，仍然是3通道，相当于把单通道值复制到3个通道保存\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimwrite\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'test_grayscale.jpg'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Egray_img\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Ereload_grayscale\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimread\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'test_grayscale.jpg'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\u003Cspan class=\"k\"\u003Eprint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ereload_grayscale\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eshape\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# cv2.IMWRITE_JPEG_QUALITY指定jpg质量，范围0到100，默认95，越高画质越好，文件越大\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimwrite\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'test_imwrite.jpg'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecolor_img\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EIMWRITE_JPEG_QUALITY\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E80\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E))\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# cv2.IMWRITE_PNG_COMPRESSION指定png质量，范围0到9，默认3，越高文件越小，画质越差\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimwrite\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'test_imwrite.png'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecolor_img\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EIMWRITE_PNG_COMPRESSION\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E5\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E))\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E\u003Cb\u003E缩放，裁剪和补边\u003C\u002Fb\u003E\u003C\u002Fp\u003E\u003Cp\u003E缩放通过cv2.resize()实现，裁剪则是利用array自身的下标截取实现，此外OpenCV还可以给图像补边，这样能对一幅图像的形状和感兴趣区域实现各种操作。下面的例子中读取一幅400×600分辨率的图片，并执行一些基础的操作：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-python\"\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"kn\"\u003Eimport\u003C\u002Fspan\u003E \u003Cspan class=\"nn\"\u003Ecv2\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# 读取一张四川大录古藏寨的照片\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Eimg\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimread\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'tiger_tibet_village.jpg'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# 缩放成200x200的方形图像\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Eimg_200x200\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eresize\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimg\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E200\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E200\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E))\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# 不直接指定缩放后大小，通过fx和fy指定缩放比例，0.5则长宽都为原来一半\u003C\u002Fspan\u003E\n\u003Cspan class=\"c1\"\u003E# 等效于img_200x300 = cv2.resize(img, (300, 200))，注意指定大小的格式是(宽度,高度)\u003C\u002Fspan\u003E\n\u003Cspan class=\"c1\"\u003E# 插值方法默认是cv2.INTER_LINEAR，这里指定为最近邻插值\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Eimg_200x300\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eresize\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimg\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Efx\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"mf\"\u003E0.5\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Efy\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"mf\"\u003E0.5\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \n                              \u003Cspan class=\"n\"\u003Einterpolation\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EINTER_NEAREST\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# 在上张图片的基础上，上下各贴50像素的黑边，生成300x300的图像\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Eimg_300x300\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EcopyMakeBorder\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimg\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E50\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E50\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \n                                       \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EBORDER_CONSTANT\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \n                                       \u003Cspan class=\"n\"\u003Evalue\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E))\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# 对照片中树的部分进行剪裁\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Epatch_tree\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eimg\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E20\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E150\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E180\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E50\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimwrite\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'cropped_tree.jpg'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Epatch_tree\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimwrite\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'resized_200x200.jpg'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eimg_200x200\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimwrite\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'resized_200x300.jpg'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eimg_200x300\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimwrite\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'bordered_300x300.jpg'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eimg_300x300\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E这些处理的效果见图6-2。\u003C\u002Fp\u003E\u003Cp\u003E\u003Cb\u003E色调，明暗，直方图和Gamma曲线\u003C\u002Fb\u003E\u003C\u002Fp\u003E\u003Cp\u003E除了区域，图像本身的属性操作也非常多，比如可以通过HSV空间对色调和明暗进行调节。HSV空间是由美国的图形学专家A. R. Smith提出的一种颜色空间，HSV分别是色调（\u003Cb\u003EH\u003C\u002Fb\u003Eue），饱和度（\u003Cb\u003ES\u003C\u002Fb\u003Eaturation）和明度（\u003Cb\u003EV\u003C\u002Fb\u003Ealue）。在HSV空间中进行调节就避免了直接在RGB空间中调节是还需要考虑三个通道的相关性。OpenCV中H的取值是[0, 180)，其他两个通道的取值都是[0, 256)，下面例子接着上面例子代码，通过HSV空间对图像进行调整：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-python\"\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E# 通过cv2.cvtColor把图像从BGR转换到HSV\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Eimg_hsv\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EcvtColor\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimg\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ECOLOR_BGR2HSV\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# H空间中，绿色比黄色的值高一点，所以给每个像素+15，黄色的树叶就会变绿\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Eturn_green_hsv\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eimg_hsv\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecopy\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Eturn_green_hsv\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[:,\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E:,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eturn_green_hsv\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[:,\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E:,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E+\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E15\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E%\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E180\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Eturn_green_img\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EcvtColor\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eturn_green_hsv\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ECOLOR_HSV2BGR\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimwrite\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'turn_green.jpg'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eturn_green_img\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# 减小饱和度会让图像损失鲜艳，变得更灰\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Ecolorless_hsv\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eimg_hsv\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecopy\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Ecolorless_hsv\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[:,\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E:,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"mf\"\u003E0.5\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecolorless_hsv\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[:,\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E:,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Ecolorless_img\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EcvtColor\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecolorless_hsv\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ECOLOR_HSV2BGR\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimwrite\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'colorless.jpg'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecolorless_img\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# 减小明度为原来一半\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Edarker_hsv\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eimg_hsv\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecopy\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Edarker_hsv\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[:,\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E:,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"mf\"\u003E0.5\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Edarker_hsv\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[:,\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E:,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Edarker_img\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EcvtColor\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Edarker_hsv\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ECOLOR_HSV2BGR\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimwrite\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'darker.jpg'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Edarker_img\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E无论是HSV还是RGB，我们都较难一眼就对像素中值的分布有细致的了解，这时候就需要直方图。如果直方图中的成分过于靠近0或者255，可能就出现了暗部细节不足或者亮部细节丢失的情况。比如图6-2中，背景里的暗部细节是非常弱的。这个时候，一个常用方法是考虑用Gamma变换来提升暗部细节。Gamma变换是矫正相机直接成像和人眼感受图像差别的一种常用手段，简单来说就是通过非线性变换让图像从对曝光强度的线性响应变得更接近人眼感受到的响应。具体的定义和实现，还是接着上面代码中读取的图片，执行计算直方图和Gamma变换的代码如下：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-python\"\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"kn\"\u003Eimport\u003C\u002Fspan\u003E \u003Cspan class=\"nn\"\u003Enumpy\u003C\u002Fspan\u003E \u003Cspan class=\"kn\"\u003Eas\u003C\u002Fspan\u003E \u003Cspan class=\"nn\"\u003Enp\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# 分通道计算每个通道的直方图\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Ehist_b\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EcalcHist\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E([\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimg\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E],\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E],\u003C\u002Fspan\u003E \u003Cspan class=\"bp\"\u003ENone\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E256\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E],\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E256\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E])\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Ehist_g\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EcalcHist\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E([\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimg\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E],\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E],\u003C\u002Fspan\u003E \u003Cspan class=\"bp\"\u003ENone\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E256\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E],\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E256\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E])\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Ehist_r\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EcalcHist\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E([\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimg\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E],\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E],\u003C\u002Fspan\u003E \u003Cspan class=\"bp\"\u003ENone\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E256\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E],\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E256\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E])\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# 定义Gamma矫正的函数\u003C\u002Fspan\u003E\n\u003Cspan class=\"k\"\u003Edef\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Egamma_trans\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimg\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Egamma\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E):\u003C\u002Fspan\u003E\n    \u003Cspan class=\"c1\"\u003E# 具体做法是先归一化到1，然后gamma作为指数值求出新的像素值再还原\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Egamma_table\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Enp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Epower\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"mf\"\u003E255.0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Egamma\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"mf\"\u003E255.0\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E \u003Cspan class=\"ow\"\u003Ein\u003C\u002Fspan\u003E \u003Cspan class=\"nb\"\u003Erange\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E256\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)]\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Egamma_table\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Enp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eround\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Enp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Earray\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Egamma_table\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E))\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eastype\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Enp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Euint8\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n    \n    \u003Cspan class=\"c1\"\u003E# 实现这个映射用的是OpenCV的查表函数\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ELUT\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimg\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Egamma_table\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# 执行Gamma矫正，小于1的值让暗部细节大量提升，同时亮部细节少量提升\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Eimg_corrected\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Egamma_trans\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimg\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mf\"\u003E0.5\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimwrite\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'gamma_corrected.jpg'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eimg_corrected\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# 分通道计算Gamma矫正后的直方图\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Ehist_b_corrected\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EcalcHist\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E([\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimg_corrected\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E],\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E],\u003C\u002Fspan\u003E \u003Cspan class=\"bp\"\u003ENone\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E256\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E],\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E256\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E])\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Ehist_g_corrected\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EcalcHist\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E([\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimg_corrected\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E],\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E],\u003C\u002Fspan\u003E \u003Cspan class=\"bp\"\u003ENone\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E256\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E],\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E256\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E])\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Ehist_r_corrected\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EcalcHist\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E([\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimg_corrected\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E],\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E],\u003C\u002Fspan\u003E \u003Cspan class=\"bp\"\u003ENone\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E256\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E],\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E256\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E])\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# 将直方图进行可视化\u003C\u002Fspan\u003E\n\u003Cspan class=\"kn\"\u003Eimport\u003C\u002Fspan\u003E \u003Cspan class=\"nn\"\u003Ematplotlib.pyplot\u003C\u002Fspan\u003E \u003Cspan class=\"kn\"\u003Eas\u003C\u002Fspan\u003E \u003Cspan class=\"nn\"\u003Eplt\u003C\u002Fspan\u003E\n\u003Cspan class=\"kn\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\"nn\"\u003Empl_toolkits.mplot3d\u003C\u002Fspan\u003E \u003Cspan class=\"kn\"\u003Eimport\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EAxes3D\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"n\"\u003Efig\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eplt\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Efigure\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"n\"\u003Epix_hists\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ehist_b\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ehist_g\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ehist_r\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E],\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ehist_b_corrected\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ehist_g_corrected\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ehist_r_corrected\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"n\"\u003Epix_vals\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"nb\"\u003Erange\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E256\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\u003Cspan class=\"k\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Esub_plt\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Epix_hist\u003C\u002Fspan\u003E \u003Cspan class=\"ow\"\u003Ein\u003C\u002Fspan\u003E \u003Cspan class=\"nb\"\u003Ezip\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E([\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E121\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E122\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E],\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Epix_hists\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E):\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Eax\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Efig\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eadd_subplot\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Esub_plt\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eprojection\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'3d'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ec\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ez\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Echannel_hist\u003C\u002Fspan\u003E \u003Cspan class=\"ow\"\u003Ein\u003C\u002Fspan\u003E \u003Cspan class=\"nb\"\u003Ezip\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E([\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'b'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"s1\"\u003E'g'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"s1\"\u003E'r'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E],\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E20\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E10\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E],\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Epix_hist\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E):\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Ecs\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ec\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E256\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Eax\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ebar\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Epix_vals\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Echannel_hist\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ezs\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ez\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ezdir\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'y'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecolor\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ealpha\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"mf\"\u003E0.618\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eedgecolor\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'none'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Elw\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"n\"\u003Eax\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eset_xlabel\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'Pixel Values'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Eax\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eset_xlim\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E([\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E256\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E])\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Eax\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eset_ylabel\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'Channels'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Eax\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eset_zlabel\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'Counts'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"n\"\u003Eplt\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eshow\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E上面三段代码的结果统一放在下图中：\u003C\u002Fp\u003E\u003Cp\u003E\u003Cbr\u003E\u003C\u002Fp\u003E\u003Cfigure\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-d82f3fa13fc8c2b31fb3bc3ffc8a6617_b.jpg\" data-rawwidth=\"632\" data-rawheight=\"760\" class=\"origin_image zh-lightbox-thumb\" width=\"632\" data-original=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-d82f3fa13fc8c2b31fb3bc3ffc8a6617_r.jpg\"\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&amp;lt;svg%20xmlns='http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg'%20width='632'%20height='760'&amp;gt;&amp;lt;\u002Fsvg&amp;gt;\" data-rawwidth=\"632\" data-rawheight=\"760\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"632\" data-original=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-d82f3fa13fc8c2b31fb3bc3ffc8a6617_r.jpg\" data-actualsrc=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-d82f3fa13fc8c2b31fb3bc3ffc8a6617_b.jpg\"\u003E\u003C\u002Ffigure\u003E\u003Cp\u003E可以看到，Gamma变换后的暗部细节比起原图清楚了很多，并且从直方图来看，像素值也从集中在0附近变得散开了一些。\u003C\u002Fp\u003E\u003Ch2\u003E6.2.3\n图像的仿射变换\u003C\u002Fh2\u003E\u003Cp\u003E图像的仿射变换涉及到图像的形状位置角度的变化，是深度学习预处理中常到的功能，在此简单回顾一下。仿射变换具体到图像中的应用，主要是对图像的\u003Cb\u003E缩放\u003C\u002Fb\u003E，\u003Cb\u003E旋转\u003C\u002Fb\u003E，\u003Cb\u003E剪切\u003C\u002Fb\u003E，\u003Cb\u003E翻转\u003C\u002Fb\u003E和\u003Cb\u003E平移\u003C\u002Fb\u003E的组合。在OpenCV中，仿射变换的矩阵是一个2×3的矩阵，其中左边的2×2子矩阵是线性变换矩阵，右边的2×1的两项是平移项：\u003C\u002Fp\u003E\u003Cp\u003E\u003Cimg src=\"http:\u002F\u002Fwww.zhihu.com\u002Fequation?tex=A%3D%5Cbegin%7Bbmatrix%7D+a_%7B00%7D+%26+a_%7B01%7D%5C%5C+a_%7B10%7D+%26+a_%7B11%7D+%5Cend%7Bbmatrix%7D+%2C+B+%3D+%5Cbegin%7Bbmatrix%7D+b_%7B0%7D%5C%5C+b_%7B1%7D+%5Cend%7Bbmatrix%7D+\" alt=\"A=\\begin{bmatrix} a_{00} &amp;amp; a_{01}\\\\ a_{10} &amp;amp; a_{11} \\end{bmatrix} , B = \\begin{bmatrix} b_{0}\\\\ b_{1} \\end{bmatrix} \" eeimg=\"1\"\u003E\u003C\u002Fp\u003E\u003Cp\u003E\u003Cimg src=\"http:\u002F\u002Fwww.zhihu.com\u002Fequation?tex=M%3D%5Cbegin%7Bbmatrix%7D+A+%26+B+%5Cend%7Bbmatrix%7D+%3D+%5Cbegin%7Bbmatrix%7D+a_%7B00%7D+%26+a_%7B01%7D+%26+b_%7B0%7D%5C%5C+a_%7B10%7D+%26+a_%7B11%7D+%26+b_%7B1%7D+%5Cend%7Bbmatrix%7D+\" alt=\"M=\\begin{bmatrix} A &amp;amp; B \\end{bmatrix} = \\begin{bmatrix} a_{00} &amp;amp; a_{01} &amp;amp; b_{0}\\\\ a_{10} &amp;amp; a_{11} &amp;amp; b_{1} \\end{bmatrix} \" eeimg=\"1\"\u003E\u003C\u002Fp\u003E\u003Cp\u003E对于图像上的任一位置(x,y)，仿射变换执行的是如下的操作：\u003C\u002Fp\u003E\u003Cp\u003E\u003Cimg src=\"http:\u002F\u002Fwww.zhihu.com\u002Fequation?tex=T_%7Baffine%7D%3DA%5Cbegin%7Bbmatrix%7D+x%5C%5C+y+%5Cend%7Bbmatrix%7D%2BB%3DM%5Cbegin%7Bbmatrix%7D+x%5C%5C+y%5C%5C+1+%5Cend%7Bbmatrix%7D\" alt=\"T_{affine}=A\\begin{bmatrix} x\\\\ y \\end{bmatrix}+B=M\\begin{bmatrix} x\\\\ y\\\\ 1 \\end{bmatrix}\" eeimg=\"1\"\u003E\u003C\u002Fp\u003E\u003Cp\u003E需要注意的是，对于图像而言，宽度方向是x，高度方向是y，坐标的顺序和图像像素对应下标一致。所以原点的位置不是左下角而是右上角，y的方向也不是向上，而是向下。在OpenCV中实现仿射变换是通过仿射变换矩阵和cv2.warpAffine()这个函数，还是通过代码来理解一下，例子中图片的分辨率为600×400：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-python\"\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"kn\"\u003Eimport\u003C\u002Fspan\u003E \u003Cspan class=\"nn\"\u003Ecv2\u003C\u002Fspan\u003E\n\u003Cspan class=\"kn\"\u003Eimport\u003C\u002Fspan\u003E \u003Cspan class=\"nn\"\u003Enumpy\u003C\u002Fspan\u003E \u003Cspan class=\"kn\"\u003Eas\u003C\u002Fspan\u003E \u003Cspan class=\"nn\"\u003Enp\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# 读取一张斯里兰卡拍摄的大象照片\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Eimg\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimread\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'lanka_safari.jpg'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# 沿着横纵轴放大1.6倍，然后平移(-150,-240)，最后沿原图大小截取，等效于裁剪并放大\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003EM_crop_elephant\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Enp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Earray\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E([\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"mf\"\u003E1.6\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E150\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E],\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mf\"\u003E1.6\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E240\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E],\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Edtype\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Enp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Efloat32\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"n\"\u003Eimg_elephant\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EwarpAffine\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimg\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EM_crop_elephant\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E400\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E600\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E))\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimwrite\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'lanka_elephant.jpg'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eimg_elephant\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# x轴的剪切变换，角度15°\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Etheta\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E15\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Enp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Epi\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E\u002F\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E180\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003EM_shear\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Enp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Earray\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E([\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Enp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Etan\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Etheta\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E],\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E],\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Edtype\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Enp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Efloat32\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"n\"\u003Eimg_sheared\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EwarpAffine\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimg\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EM_shear\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E400\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E600\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E))\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimwrite\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'lanka_safari_sheared.jpg'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eimg_sheared\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# 顺时针旋转，角度15°\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003EM_rotate\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Enp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Earray\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E([\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Enp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecos\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Etheta\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Enp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Esin\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Etheta\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E],\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Enp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Esin\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Etheta\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Enp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecos\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Etheta\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E],\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Edtype\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Enp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Efloat32\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"n\"\u003Eimg_rotated\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EwarpAffine\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimg\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EM_rotate\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E400\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E600\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E))\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimwrite\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'lanka_safari_rotated.jpg'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eimg_rotated\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# 某种变换，具体旋转+缩放+旋转组合可以通过SVD分解理解\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003EM\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Enp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Earray\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E([\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mf\"\u003E1.5\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E400\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E],\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"mf\"\u003E0.5\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E100\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E],\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Edtype\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Enp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Efloat32\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"n\"\u003Eimg_transformed\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EwarpAffine\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimg\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EM\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E400\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E600\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E))\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimwrite\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'lanka_safari_transformed.jpg'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eimg_transformed\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E代码实现的操作示意在下图中：\u003C\u002Fp\u003E\u003Cfigure\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-e614bc5a0604a14e4d4c6930ff46e1b2_b.jpg\" data-rawwidth=\"1169\" data-rawheight=\"915\" class=\"origin_image zh-lightbox-thumb\" width=\"1169\" data-original=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-e614bc5a0604a14e4d4c6930ff46e1b2_r.jpg\"\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&amp;lt;svg%20xmlns='http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg'%20width='1169'%20height='915'&amp;gt;&amp;lt;\u002Fsvg&amp;gt;\" data-rawwidth=\"1169\" data-rawheight=\"915\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1169\" data-original=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-e614bc5a0604a14e4d4c6930ff46e1b2_r.jpg\" data-actualsrc=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-e614bc5a0604a14e4d4c6930ff46e1b2_b.jpg\"\u003E\u003C\u002Ffigure\u003E\u003Ch2\u003E6.2.4\n基本绘图\u003C\u002Fh2\u003E\u003Cp\u003EOpenCV提供了各种绘图的函数，可以在画面上绘制线段，圆，矩形和多边形等，还可以在图像上指定位置打印文字，比如下面例子：\n\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-python\"\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"kn\"\u003Eimport\u003C\u002Fspan\u003E \u003Cspan class=\"nn\"\u003Enumpy\u003C\u002Fspan\u003E \u003Cspan class=\"kn\"\u003Eas\u003C\u002Fspan\u003E \u003Cspan class=\"nn\"\u003Enp\u003C\u002Fspan\u003E\n\u003Cspan class=\"kn\"\u003Eimport\u003C\u002Fspan\u003E \u003Cspan class=\"nn\"\u003Ecv2\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# 定义一块宽600，高400的画布，初始化为白色\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Ecanvas\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Enp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ezeros\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E((\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E400\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E600\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E3\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Edtype\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Enp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Euint8\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E255\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# 画一条纵向的正中央的黑色分界线\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eline\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecanvas\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E300\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E300\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E399\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# 画一条右半部份画面以150为界的横向分界线\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eline\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecanvas\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E300\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E149\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E599\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E149\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# 左半部分的右下角画个红色的圆\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecircle\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecanvas\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E200\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E300\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E75\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E255\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E5\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# 左半部分的左下角画个蓝色的矩形\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Erectangle\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecanvas\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E20\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E240\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E100\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E360\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E255\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ethickness\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E3\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# 定义两个三角形，并执行内部绿色填充\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Etriangles\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Enp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Earray\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E([\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E[(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E200\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E240\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E145\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E333\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E255\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E333\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)],\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E[(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E60\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E180\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E20\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E237\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E100\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E237\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)]])\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EfillPoly\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecanvas\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Etriangles\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E255\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E))\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# 画一个黄色五角星\u003C\u002Fspan\u003E\n\u003Cspan class=\"c1\"\u003E# 第一步通过旋转角度的办法求出五个顶点\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Ephi\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E4\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Enp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Epi\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E\u002F\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E5\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Erotations\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[[[\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Enp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecos\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ephi\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Enp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Esin\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ephi\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)],\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Enp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Esin\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ephi\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Enp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecos\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ephi\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)]]\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E \u003Cspan class=\"ow\"\u003Ein\u003C\u002Fspan\u003E \u003Cspan class=\"nb\"\u003Erange\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E5\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)]\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Epentagram\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Enp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Earray\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E([[[[\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]]\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Enp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Edot\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Em\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E))\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Em\u003C\u002Fspan\u003E \u003Cspan class=\"ow\"\u003Ein\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Erotations\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]]],\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Edtype\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Enp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Efloat\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# 定义缩放倍数和平移向量把五角星画在左半部分画面的上方\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Epentagram\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Enp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eround\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Epentagram\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E80\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Enp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Earray\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E([\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E160\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E120\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]))\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eastype\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Enp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# 将5个顶点作为多边形顶点连线，得到五角星\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Epolylines\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecanvas\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Epentagram\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"bp\"\u003ETrue\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E255\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E255\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E9\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# 按像素为间隔从左至右在画面右半部份的上方画出HSV空间的色调连续变化\u003C\u002Fspan\u003E\n\u003Cspan class=\"k\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E \u003Cspan class=\"ow\"\u003Ein\u003C\u002Fspan\u003E \u003Cspan class=\"nb\"\u003Erange\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E302\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E600\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E):\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Ecolor_pixel\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Enp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Earray\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E([[[\u003C\u002Fspan\u003E\u003Cspan class=\"nb\"\u003Eround\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E180\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"nb\"\u003Efloat\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E302\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E298\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E255\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E255\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]]],\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Edtype\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Enp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Euint8\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Eline_color\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"nb\"\u003Eint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ec\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ec\u003C\u002Fspan\u003E \u003Cspan class=\"ow\"\u003Ein\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EcvtColor\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecolor_pixel\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ECOLOR_HSV2BGR\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)[\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E][\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]]\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eline\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecanvas\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E147\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eline_color\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# 如果定义圆的线宽大于半斤，则等效于画圆点，随机在画面右下角的框内生成坐标\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Enp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Erandom\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eseed\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E42\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003En_pts\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E30\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Epts_x\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Enp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Erandom\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Erandint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E310\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E590\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003En_pts\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Epts_y\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Enp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Erandom\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Erandint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E160\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E390\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003En_pts\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Epts\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"nb\"\u003Ezip\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Epts_x\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Epts_y\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# 画出每个点，颜色随机\u003C\u002Fspan\u003E\n\u003Cspan class=\"k\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ept\u003C\u002Fspan\u003E \u003Cspan class=\"ow\"\u003Ein\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Epts\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Ept_color\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"nb\"\u003Eint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ec\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ec\u003C\u002Fspan\u003E \u003Cspan class=\"ow\"\u003Ein\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Enp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Erandom\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Erandint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E255\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E3\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)]\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecircle\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecanvas\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ept\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E3\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ept_color\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E5\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# 在左半部分最上方打印文字\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EputText\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecanvas\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\n            \u003Cspan class=\"s1\"\u003E'Python-OpenCV Drawing Example'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\n            \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E5\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E15\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E\n            \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EFONT_HERSHEY_SIMPLEX\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\n            \u003Cspan class=\"mf\"\u003E0.5\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\n            \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E\n            \u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimshow\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'Example of basic drawing functions'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecanvas\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EwaitKey\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E执行这段代码得到如下的图像：\n\u003C\u002Fp\u003E\u003Cfigure\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-e89c8ea16a8e3b72fc8a0c4dcbcc0e7b_b.jpg\" data-rawwidth=\"600\" data-rawheight=\"400\" class=\"origin_image zh-lightbox-thumb\" width=\"600\" data-original=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-e89c8ea16a8e3b72fc8a0c4dcbcc0e7b_r.jpg\"\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&amp;lt;svg%20xmlns='http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg'%20width='600'%20height='400'&amp;gt;&amp;lt;\u002Fsvg&amp;gt;\" data-rawwidth=\"600\" data-rawheight=\"400\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"600\" data-original=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-e89c8ea16a8e3b72fc8a0c4dcbcc0e7b_r.jpg\" data-actualsrc=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-e89c8ea16a8e3b72fc8a0c4dcbcc0e7b_b.jpg\"\u003E\u003C\u002Ffigure\u003E\u003Ch2\u003E6.2.4\n视频功能\u003C\u002Fh2\u003E\u003Cp\u003E视频中最常用的就是从视频设备采集图片或者视频，或者读取视频文件并从中采样。所以比较重要的也是两个模块，一个是VideoCapture，用于获取相机设备并捕获图像和视频，或是从文件中捕获。还有一个VideoWriter，用于生成视频。还是来看例子理解这两个功能的用法，首先是一个制作延时摄影视频的小例子：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-python\"\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"kn\"\u003Eimport\u003C\u002Fspan\u003E \u003Cspan class=\"nn\"\u003Ecv2\u003C\u002Fspan\u003E\n\u003Cspan class=\"kn\"\u003Eimport\u003C\u002Fspan\u003E \u003Cspan class=\"nn\"\u003Etime\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"n\"\u003Einterval\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E60\u003C\u002Fspan\u003E       \t\u003Cspan class=\"c1\"\u003E# 捕获图像的间隔，单位：秒\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Enum_frames\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E500\u003C\u002Fspan\u003E    \t\u003Cspan class=\"c1\"\u003E# 捕获图像的总帧数\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Eout_fps\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E24\u003C\u002Fspan\u003E        \t\u003Cspan class=\"c1\"\u003E# 输出文件的帧率\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# VideoCapture(0)表示打开默认的相机\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Ecap\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EVideoCapture\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# 获取捕获的分辨率\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Esize\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"nb\"\u003Eint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecap\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eget\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ECAP_PROP_FRAME_WIDTH\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)),\u003C\u002Fspan\u003E\n       \u003Cspan class=\"nb\"\u003Eint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecap\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eget\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ECAP_PROP_FRAME_HEIGHT\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)))\u003C\u002Fspan\u003E\n       \n\u003Cspan class=\"c1\"\u003E# 设置要保存视频的编码，分辨率和帧率\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Evideo\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EVideoWriter\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\n    \u003Cspan class=\"s2\"\u003E\"time_lapse.avi\"\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \n    \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EVideoWriter_fourcc\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'M'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'P'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'4'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'2'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \n    \u003Cspan class=\"n\"\u003Eout_fps\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \n    \u003Cspan class=\"n\"\u003Esize\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# 对于一些低画质的摄像头，前面的帧可能不稳定，略过\u003C\u002Fspan\u003E\n\u003Cspan class=\"k\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E \u003Cspan class=\"ow\"\u003Ein\u003C\u002Fspan\u003E \u003Cspan class=\"nb\"\u003Erange\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E42\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E):\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Ecap\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eread\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# 开始捕获，通过read()函数获取捕获的帧\u003C\u002Fspan\u003E\n\u003Cspan class=\"k\"\u003Etry\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E \u003Cspan class=\"ow\"\u003Ein\u003C\u002Fspan\u003E \u003Cspan class=\"nb\"\u003Erange\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Enum_frames\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E):\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003E_\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eframe\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecap\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eread\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Evideo\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ewrite\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eframe\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n        \u003Cspan class=\"c1\"\u003E# 如果希望把每一帧也存成文件，比如制作GIF，则取消下面的注释\u003C\u002Fspan\u003E\n        \u003Cspan class=\"c1\"\u003E# filename = '{:0&amp;gt;6d}.png'.format(i)\u003C\u002Fspan\u003E\n        \u003Cspan class=\"c1\"\u003E# cv2.imwrite(filename, frame)\u003C\u002Fspan\u003E\n\n        \u003Cspan class=\"k\"\u003Eprint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'Frame {} is captured.'\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eformat\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E))\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Etime\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Esleep\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Einterval\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\u003Cspan class=\"k\"\u003Eexcept\u003C\u002Fspan\u003E \u003Cspan class=\"ne\"\u003EKeyboardInterrupt\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\n    \u003Cspan class=\"c1\"\u003E# 提前停止捕获\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Eprint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'Stopped! {}\u002F{} frames captured!'\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eformat\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Enum_frames\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E))\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# 释放资源并写入视频文件\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Evideo\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Erelease\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Ecap\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Erelease\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E这个例子实现了延时摄影的功能，把程序打开并将摄像头对准一些缓慢变化的画面，比如桌上缓慢蒸发的水，或者正在生长的小草，就能制作出有趣的延时摄影作品。比如下面这个链接中的图片就是用这段程序生成的：\u003C\u002Fp\u003E\u003Cp\u003E\u003Ca href=\"http:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fimages.cnitblog.com\u002Fblog2015\u002F609274\u002F201503\u002F251904209276278.gif\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Eimages.cnitblog.com\u002Fblo\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003Eg2015\u002F609274\u002F201503\u002F251904209276278.gif\u003C\u002Fspan\u003E\u003Cspan class=\"ellipsis\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003Cp\u003E程序的结构非常清晰简单，注释里也写清楚了每一步，所以流程就不解释了。需要提一下的有两点：一个是VideoWriter中的一个函数cv2.VideoWriter_fourcc()。这个函数指定了视频编码的格式，比如例子中用的是MP42，也就是MPEG-4，更多编码方式可以在下面的地址查询：\u003C\u002Fp\u003E\u003Cp\u003E\u003Ca href=\"http:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fwww.fourcc.org\u002Fcodecs.php\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003EVideo Codecs by FOURCC\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003Cp\u003E还有一个是KeyboardInterrupt，这是一个常用的异常，用来获取用户Ctrl+C的中止，捕获这个异常后直接结束循环并释放VideoCapture和VideoWriter的资源，使已经捕获好的部分视频可以顺利生成。\u003C\u002Fp\u003E\u003Cp\u003E\n\n\n\n\n从视频中截取帧也是处理视频时常见的任务，下面代码实现的是遍历一个指定文件夹下的所有视频并按照指定的间隔进行截屏并保存：\n\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-python\"\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"kn\"\u003Eimport\u003C\u002Fspan\u003E \u003Cspan class=\"nn\"\u003Ecv2\u003C\u002Fspan\u003E\n\u003Cspan class=\"kn\"\u003Eimport\u003C\u002Fspan\u003E \u003Cspan class=\"nn\"\u003Eos\u003C\u002Fspan\u003E\n\u003Cspan class=\"kn\"\u003Eimport\u003C\u002Fspan\u003E \u003Cspan class=\"nn\"\u003Esys\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# 第一个输入参数是包含视频片段的路径\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Einput_path\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Esys\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eargv\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# 第二个输入参数是设定每隔多少帧截取一帧\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Eframe_interval\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"nb\"\u003Eint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Esys\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eargv\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E])\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# 列出文件夹下所有的视频文件\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Efilenames\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eos\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Elistdir\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Einput_path\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# 获取文件夹名称\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Evideo_prefix\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Einput_path\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Esplit\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eos\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Esep\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)[\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# 建立一个新的文件夹，名称为原文件夹名称后加上_frames\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Eframe_path\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"s1\"\u003E'{}_frames'\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eformat\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Einput_path\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"ow\"\u003Enot\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eos\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Epath\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eexists\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eframe_path\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E):\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Eos\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Emkdir\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eframe_path\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# 初始化一个VideoCapture对象\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Ecap\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EVideoCapture\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# 遍历所有文件\u003C\u002Fspan\u003E\n\u003Cspan class=\"k\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Efilename\u003C\u002Fspan\u003E \u003Cspan class=\"ow\"\u003Ein\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Efilenames\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Efilepath\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eos\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Esep\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ejoin\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E([\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Einput_path\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Efilename\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E])\u003C\u002Fspan\u003E\n    \n    \u003Cspan class=\"c1\"\u003E# VideoCapture::open函数可以从文件获取视频\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Ecap\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eopen\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Efilepath\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n    \n    \u003Cspan class=\"c1\"\u003E# 获取视频帧数\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003En_frames\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"nb\"\u003Eint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecap\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eget\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ECAP_PROP_FRAME_COUNT\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E))\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"c1\"\u003E# 同样为了避免视频头几帧质量低下，黑屏或者无关等\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E \u003Cspan class=\"ow\"\u003Ein\u003C\u002Fspan\u003E \u003Cspan class=\"nb\"\u003Erange\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E42\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E):\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Ecap\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eread\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E\n    \n    \u003Cspan class=\"k\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E \u003Cspan class=\"ow\"\u003Ein\u003C\u002Fspan\u003E \u003Cspan class=\"nb\"\u003Erange\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003En_frames\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E):\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Eret\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eframe\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecap\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eread\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E\n        \n        \u003Cspan class=\"c1\"\u003E# 每隔frame_interval帧进行一次截屏操作\u003C\u002Fspan\u003E\n        \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E%\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eframe_interval\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E==\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\n            \u003Cspan class=\"n\"\u003Eimagename\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"s1\"\u003E'{}_{}_{:0&amp;gt;6d}.jpg'\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eformat\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Evideo_prefix\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Efilename\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Esplit\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'.'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)[\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E],\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n            \u003Cspan class=\"n\"\u003Eimagepath\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eos\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Esep\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ejoin\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E([\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eframe_path\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eimagename\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E])\u003C\u002Fspan\u003E\n            \u003Cspan class=\"k\"\u003Eprint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'exported {}!'\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eformat\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimagepath\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E))\u003C\u002Fspan\u003E\n            \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimwrite\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimagepath\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eframe\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# 执行结束释放资源\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Ecap\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Erelease\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Ch2\u003E6.3 用OpenCV实现数据增加小工具\u003C\u002Fh2\u003E\u003Cp\u003E到目前我们已经熟悉了numpy中的随机模块，多进程调用和OpenCV的基本操作，基于这些基础，本节将从思路到代码一步步实现一个最基本的数据增加小工具。\u003C\u002Fp\u003E\u003Cp\u003E第三章和第四章都提到过数据增加（data augmentation），作为一种深度学习中的常用手段，数据增加对模型的泛化性和准确性都有帮助。数据增加的具体使用方式一般有两种，一种是实时增加，比如在Caffe中加入数据扰动层，每次图像都先经过扰动操作，再去训练，这样训练经过几代（epoch）之后，就等效于数据增加。还有一种是更加直接简单一些的，就是在训练之前就通过图像处理手段对数据样本进行扰动和增加，也就是本节要实现的。\u003C\u002Fp\u003E\u003Cp\u003E这个例子中将包含三种基本类型的扰动：随机裁剪，随机旋转和随机颜色\u002F明暗。\u003C\u002Fp\u003E\u003Ch2\u003E6.3.1\n随机裁剪\u003C\u002Fh2\u003E\u003Cp\u003EAlexNet中已经讲过了随机裁剪的基本思路，我们的小例子中打算更进一步：在裁剪的时候考虑图像宽高比的扰动。在绝大多数用于分类的图片中，样本进入网络前都是要变为统一大小，所以宽高比扰动相当于对物体的横向和纵向进行了缩放，这样除了物体的位置扰动，又多出了一项扰动。只要变化范围控制合适，目标物体始终在画面内，这种扰动是有助于提升泛化性能的。实现这种裁剪的思路如下图所示：\n\u003C\u002Fp\u003E\u003Cfigure\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-8643baac95bd135cd5ffac3b6d1a0c7a_b.jpg\" data-rawwidth=\"1164\" data-rawheight=\"444\" class=\"origin_image zh-lightbox-thumb\" width=\"1164\" data-original=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-8643baac95bd135cd5ffac3b6d1a0c7a_r.jpg\"\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&amp;lt;svg%20xmlns='http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg'%20width='1164'%20height='444'&amp;gt;&amp;lt;\u002Fsvg&amp;gt;\" data-rawwidth=\"1164\" data-rawheight=\"444\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1164\" data-original=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-8643baac95bd135cd5ffac3b6d1a0c7a_r.jpg\" data-actualsrc=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-8643baac95bd135cd5ffac3b6d1a0c7a_b.jpg\"\u003E\u003C\u002Ffigure\u003E\u003Cp\u003E图中最左边是一幅需要剪裁的画面，首先根据这幅画面我们可以算出一个宽高比w\u002Fh。然后设定一个小的扰动范围δ和要裁剪的画面占原画面的比例β，从-\u003Cimg src=\"http:\u002F\u002Fwww.zhihu.com\u002Fequation?tex=%5Cdelta\" alt=\"\\delta\" eeimg=\"1\"\u003E到\u003Cimg src=\"http:\u002F\u002Fwww.zhihu.com\u002Fequation?tex=%5Cdelta\" alt=\"\\delta\" eeimg=\"1\"\u003E之间按均匀采样，获取一个随机数\u003Cimg src=\"http:\u002F\u002Fwww.zhihu.com\u002Fequation?tex=%5Chat+%5Cdelta\" alt=\"\\hat \\delta\" eeimg=\"1\"\u003E作为裁剪后画面的宽高比扰动的比例，则裁剪后画面的宽和高分别为：\u003C\u002Fp\u003E\u003Cp\u003E\u003Cimg src=\"http:\u002F\u002Fwww.zhihu.com\u002Fequation?tex=w%27%3Dw%5Csqrt+%7B%5Cbeta%281%2B+%5Chat%5Cdelta%29%7D\" alt=\"w'=w\\sqrt {\\beta(1+ \\hat\\delta)}\" eeimg=\"1\"\u003E\u003C\u002Fp\u003E\u003Cp\u003E\u003Cimg src=\"http:\u002F\u002Fwww.zhihu.com\u002Fequation?tex=h%27%3Dh%5Csqrt+%7B%5Cfrac+%5Cbeta+%7B1%2B+%5Chat%5Cdelta%7D%7D\" alt=\"h'=h\\sqrt {\\frac \\beta {1+ \\hat\\delta}}\" eeimg=\"1\"\u003E\u003C\u002Fp\u003E\u003Cp\u003E想象一下先把这个宽为w’，高为h’的区域置于原画面的右下角，则这个区域的左上角和原画面的左上角框出的小区域，如图中的虚线框所示，就是裁剪后区域左上角可以取值的范围。所以在这个区域内随机采一点作为裁剪区域的左上角，就实现了如图中位置随机，且宽高比也随机的裁剪。\u003C\u002Fp\u003E\u003Ch2\u003E6.3.2\n随机旋转\u003C\u002Fh2\u003E\u003Cp\u003E前面讲到过的旋转比起来，做数据增加时，一般希望旋转是沿着画面的中心。这样除了要知道旋转角度，还得计算平移的量才能让仿射变换的效果等效于旋转轴在画面中心，好在OpenCV中有现成的函数cv2.getRotationMatrix2D()可以使用。这个函数的第一个参数是旋转中心，第二个参数是逆时针旋转角度，第三个参数是缩放倍数，对于只是旋转的情况下这个值是1，返回值就是做仿射变换的矩阵。\u003C\u002Fp\u003E\u003Cp\u003E\n\n\n\n\n直接用这个函数并接着使用cv2.warpAffine()会有一个潜在的问题，就是旋转之后会出现黑边。如果要旋转后的画面不包含黑边，就得沿着原来画面的轮廓做个内接矩形，该矩形的宽高比和原画面相同，如下图所示：\n\u003C\u002Fp\u003E\u003Cfigure\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-8e2c7867c54bd1ef7d5afba1285acab8_b.jpg\" data-rawwidth=\"552\" data-rawheight=\"631\" class=\"origin_image zh-lightbox-thumb\" width=\"552\" data-original=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-8e2c7867c54bd1ef7d5afba1285acab8_r.jpg\"\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&amp;lt;svg%20xmlns='http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg'%20width='552'%20height='631'&amp;gt;&amp;lt;\u002Fsvg&amp;gt;\" data-rawwidth=\"552\" data-rawheight=\"631\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"552\" data-original=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-8e2c7867c54bd1ef7d5afba1285acab8_r.jpg\" data-actualsrc=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-8e2c7867c54bd1ef7d5afba1285acab8_b.jpg\"\u003E\u003C\u002Ffigure\u003E\u003Cp\u003E在图中，可以看到，限制内接矩形大小的主要是原画面更靠近中心的那条边，也就是图中比较长的一条边AB。因此我们只要沿着中心O和内接矩形的顶点方向的直线，求出和AB的交点P，就得到了内接矩形的大小。先来看长边的方程，考虑之前画面和横轴相交的点，经过角度-θ旋转后，到了图中的Q点所在：\n\u003Cimg src=\"http:\u002F\u002Fwww.zhihu.com\u002Fequation?tex=%5Cbegin%7Bbmatrix%7D+x_%7BQ%7D+%5C%5C+y_%7BQ%7D+%5Cend%7Bbmatrix%7D%3D%5Cbegin%7Bbmatrix%7D+%5Ccos%28-%5Ctheta%29+%26+-%5Ccos%28-%5Ctheta%29%5C%5C+%5Csin%28-%5Ctheta%29+%26+%5Ccos%28-%5Ctheta%29+%5Cend%7Bbmatrix%7D+%5Cbegin%7Bbmatrix%7D+-+%5Cfrac+w+2%5C%5C+0+%5Cend%7Bbmatrix%7D%3D+%5Cbegin%7Bbmatrix%7D+-+%5Cfrac+w+2+%5Ccos%28%5Ctheta%29%5C%5C+%5Cfrac+w+2+%5Csin%28%5Ctheta%29+%5Cend%7Bbmatrix%7D+\" alt=\"\\begin{bmatrix} x_{Q} \\\\ y_{Q} \\end{bmatrix}=\\begin{bmatrix} \\cos(-\\theta) &amp;amp; -\\cos(-\\theta)\\\\ \\sin(-\\theta) &amp;amp; \\cos(-\\theta) \\end{bmatrix} \\begin{bmatrix} - \\frac w 2\\\\ 0 \\end{bmatrix}= \\begin{bmatrix} - \\frac w 2 \\cos(\\theta)\\\\ \\frac w 2 \\sin(\\theta) \\end{bmatrix} \" eeimg=\"1\"\u003E\u003C\u002Fp\u003E\u003Cp\u003E因为长边所在直线过Q点，且斜率为1\u002Ftan(θ)，所以有：\n\u003C\u002Fp\u003E\u003Cp\u003E\u003Cimg src=\"http:\u002F\u002Fwww.zhihu.com\u002Fequation?tex=%5Cfrac+%7By-%5Cfrac+w+2%5Csin%28%5Ctheta%29%7D+%7Bx%2B%5Cfrac+w+2%5Ccos%28%5Ctheta%29%7D%3D%5Cfrac+1+%7B%5Ctan%28%5Ctheta%29%7D\" alt=\"\\frac {y-\\frac w 2\\sin(\\theta)} {x+\\frac w 2\\cos(\\theta)}=\\frac 1 {\\tan(\\theta)}\" eeimg=\"1\"\u003E\u003C\u002Fp\u003E\u003Cp\u003E这时候考虑OP这条直线：\u003C\u002Fp\u003E\u003Cp\u003E\u003Cimg src=\"http:\u002F\u002Fwww.zhihu.com\u002Fequation?tex=y%3D-%5Cfrac+h+wx\" alt=\"y=-\\frac h wx\" eeimg=\"1\"\u003E\u003C\u002Fp\u003E\u003Cp\u003E把这个公式带入再前边一个公式，求解可以得到：\u003C\u002Fp\u003E\u003Cp\u003E\u003Cimg src=\"http:\u002F\u002Fwww.zhihu.com\u002Fequation?tex=x%3D-%5Cfrac+w+2+%5Ccdot+%5Cfrac+%7B%5Ccos%28%5Ctheta%29%2B%5Csin%28%5Ctheta%29%5Ctan%28%5Ctheta%29%7D+%7B%5Cfrac+h+w+%5Ctan%28%5Ctheta%29%2B1%7D\" alt=\"x=-\\frac w 2 \\cdot \\frac {\\cos(\\theta)+\\sin(\\theta)\\tan(\\theta)} {\\frac h w \\tan(\\theta)+1}\" eeimg=\"1\"\u003E\u003C\u002Fp\u003E\u003Cp\u003E注意到在这个问题中，每个象限和相邻象限都是轴对称的，而且旋转角度对剪裁宽度和长度的影响是周期（T=π）变化，再加上我们关心的其实并不是四个点的位置，而是旋转后要截取的矩形的宽w’和高h’，所以复杂的分区间情况也简化了，首先对于旋转角度，因为周期为π，所以都可以化到0到π之间，然后因为对称性，进一步有：\n\u003C\u002Fp\u003E\u003Cp\u003E\u003Cimg src=\"http:\u002F\u002Fwww.zhihu.com\u002Fequation?tex=%5Ctheta%3D%5Cbegin%7Bcases%7D+%5Ctheta%2C+%26+%5Ctext%7Bif+%24%5Ctheta+%5Cleq+%5Cfrac+%5Cpi+2%24%7D+%5C%5C+%5Cpi-%5Ctheta%2C+%26+%5Ctext%7Belse%7D+%5Cend%7Bcases%7D\" alt=\"\\theta=\\begin{cases} \\theta, &amp;amp; \\text{if $\\theta \\leq \\frac \\pi 2$} \\\\ \\pi-\\theta, &amp;amp; \\text{else} \\end{cases}\" eeimg=\"1\"\u003E\u003C\u002Fp\u003E\u003Cp\u003E于是对于0到π\u002F2之间的θ，有：\n\u003C\u002Fp\u003E\u003Cp\u003E\u003Cimg src=\"http:\u002F\u002Fwww.zhihu.com\u002Fequation?tex=r%3D%5Cbegin%7Bcases%7D+h%2Fw%2C+%26+%5Ctext%7Bif+h%24%3E%24w%7D+%5C%5C+w%2Fh%2C+%26+%5Ctext%7Belse%7D+%5Cend%7Bcases%7D\" alt=\"r=\\begin{cases} h\u002Fw, &amp;amp; \\text{if h$&amp;gt;$w} \\\\ w\u002Fh, &amp;amp; \\text{else} \\end{cases}\" eeimg=\"1\"\u003E\u003C\u002Fp\u003E\u003Cp\u003E\u003Cimg src=\"http:\u002F\u002Fwww.zhihu.com\u002Fequation?tex=%5Cbeta%3D%5Cfrac+%7B%5Ccos%28%5Ctheta%29%2B%5Csin%28%5Ctheta%29%5Ctan%28%5Ctheta%29%7D+%7Br%5Ctan%28%5Ctheta%29%2B1%7D\" alt=\"\\beta=\\frac {\\cos(\\theta)+\\sin(\\theta)\\tan(\\theta)} {r\\tan(\\theta)+1}\" eeimg=\"1\"\u003E\u003C\u002Fp\u003E\u003Cp\u003E\u003Cimg src=\"http:\u002F\u002Fwww.zhihu.com\u002Fequation?tex=w%27%3D%5Cbeta+w\" alt=\"w'=\\beta w\" eeimg=\"1\"\u003E\u003C\u002Fp\u003E\u003Cp\u003E\u003Cimg src=\"http:\u002F\u002Fwww.zhihu.com\u002Fequation?tex=h%27%3D%5Cbeta+h\" alt=\"h'=\\beta h\" eeimg=\"1\"\u003E\u003C\u002Fp\u003E\u003Cp\u003E当然需要注意的是，对于宽高比非常大或者非常小的图片，旋转后如果裁剪往往得到的画面是非常小的一部分，甚至不包含目标物体。所以是否需要旋转，以及是否需要裁剪，如果裁剪角度多少合适，都要视情况而定。\u003C\u002Fp\u003E\u003Ch2\u003E6.3.3\n随机颜色和明暗\u003C\u002Fh2\u003E\u003Cp\u003E比起AlexNet论文里在PCA之后的主成分上做扰动的方法，本书用来实现随机的颜色以及明暗的方法相对简单很多，就是给HSV空间的每个通道，分别加上一个微小的扰动。其中对于色调，从-\u003Cimg src=\"http:\u002F\u002Fwww.zhihu.com\u002Fequation?tex=%5Cdelta\" alt=\"\\delta\" eeimg=\"1\"\u003E到\u003Cimg src=\"http:\u002F\u002Fwww.zhihu.com\u002Fequation?tex=%5Cdelta\" alt=\"\\delta\" eeimg=\"1\"\u003E之间按均匀采样，获取一个随机数\u003Cimg src=\"http:\u002F\u002Fwww.zhihu.com\u002Fequation?tex=%5Chat+%5Cdelta\" alt=\"\\hat \\delta\" eeimg=\"1\"\u003E作为要扰动的值，然后新的像素值x’为原始像素值x +\u003Cimg src=\"http:\u002F\u002Fwww.zhihu.com\u002Fequation?tex=%5Chat+%5Cdelta\" alt=\"\\hat \\delta\" eeimg=\"1\"\u003E；对于其他两个空间则是新像素值x’为原始像素值x的(1+\u003Cimg src=\"http:\u002F\u002Fwww.zhihu.com\u002Fequation?tex=%5Chat+%5Cdelta\" alt=\"\\hat \\delta\" eeimg=\"1\"\u003E)倍，从而实现色调，饱和度和明暗度的扰动。\u003C\u002Fp\u003E\u003Cp\u003E因为明暗度并不会对图像的直方图相对分布产生大的影响，所以在HSV扰动基础上，考虑再加入一个Gamma扰动，方法是设定一个大于1的Gamma值的上限γ，因为这个值通常会和1是一个量级，再用均匀采样的近似未必合适，所以从-logγ到logγ之间均匀采样一个值α，然后用\u003Cimg src=\"http:\u002F\u002Fwww.zhihu.com\u002Fequation?tex=e%5E%7B%5Calpha%7D+\" alt=\"e^{\\alpha} \" eeimg=\"1\"\u003E\u003C\u002Fp\u003E\u003Cp\u003E作为Gamma值进行变换。\u003C\u002Fp\u003E\u003Ch2\u003E6.3.4\n多进程调用加速处理\u003C\u002Fh2\u003E\u003Cp\u003E做数据增加时如果样本量本身就不小，则处理起来可能会很耗费时间，所以可以考虑利用多进程并行处理。比如我们的例子中，设定使用场景是输入一个文件夹路径，该文件夹下包含了所有原始的数据样本。用户指定输出的文件夹和打算增加图片的总量。执行程序的时候，通过os.listdir()获取所有文件的路径，然后按照上一章讲过的多进程平均划分样本的办法，把文件尽可能均匀地分给不同进程，进行处理。\u003C\u002Fp\u003E\u003Ch2\u003E6.3.5\n代码：图片数据增加小工具\u003C\u002Fh2\u003E\u003Cp\u003E按照前面4个部分的思路和方法，这节来实现这么一个图片数据增加小工具，首先对于一些基础的操作，我们定义在一个叫做image_augmentation.py的文件里：\n\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-python\"\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"kn\"\u003Eimport\u003C\u002Fspan\u003E \u003Cspan class=\"nn\"\u003Enumpy\u003C\u002Fspan\u003E \u003Cspan class=\"kn\"\u003Eas\u003C\u002Fspan\u003E \u003Cspan class=\"nn\"\u003Enp\u003C\u002Fspan\u003E\n\u003Cspan class=\"kn\"\u003Eimport\u003C\u002Fspan\u003E \u003Cspan class=\"nn\"\u003Ecv2\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"sd\"\u003E'''\u003C\u002Fspan\u003E\n\u003Cspan class=\"sd\"\u003E定义裁剪函数，四个参数分别是：\u003C\u002Fspan\u003E\n\u003Cspan class=\"sd\"\u003E左上角横坐标x0\u003C\u002Fspan\u003E\n\u003Cspan class=\"sd\"\u003E左上角纵坐标y0\u003C\u002Fspan\u003E\n\u003Cspan class=\"sd\"\u003E裁剪宽度w\u003C\u002Fspan\u003E\n\u003Cspan class=\"sd\"\u003E裁剪高度h\u003C\u002Fspan\u003E\n\u003Cspan class=\"sd\"\u003E'''\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Ecrop_image\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Elambda\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eimg\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ex0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ey0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ew\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eh\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eimg\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ey0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ey0\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E+\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eh\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ex0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ex0\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E+\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ew\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"sd\"\u003E'''\u003C\u002Fspan\u003E\n\u003Cspan class=\"sd\"\u003E随机裁剪\u003C\u002Fspan\u003E\n\u003Cspan class=\"sd\"\u003Earea_ratio为裁剪画面占原画面的比例\u003C\u002Fspan\u003E\n\u003Cspan class=\"sd\"\u003Ehw_vari是扰动占原高宽比的比例范围\u003C\u002Fspan\u003E\n\u003Cspan class=\"sd\"\u003E'''\u003C\u002Fspan\u003E\n\u003Cspan class=\"k\"\u003Edef\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Erandom_crop\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimg\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Earea_ratio\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ehw_vari\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E):\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Eh\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ew\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eimg\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eshape\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[:\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Ehw_delta\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Enp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Erandom\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Euniform\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ehw_vari\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ehw_vari\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Ehw_mult\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ehw_delta\u003C\u002Fspan\u003E\n\t\n\t\u003Cspan class=\"c1\"\u003E# 下标进行裁剪，宽高必须是正整数\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Ew_crop\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"nb\"\u003Eint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"nb\"\u003Eround\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ew\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Enp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Esqrt\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Earea_ratio\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ehw_mult\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)))\u003C\u002Fspan\u003E\n\t\n\t\u003Cspan class=\"c1\"\u003E# 裁剪宽度不可超过原图可裁剪宽度\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ew_crop\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&amp;gt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ew\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Ew_crop\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ew\u003C\u002Fspan\u003E\n\t\t\n    \u003Cspan class=\"n\"\u003Eh_crop\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"nb\"\u003Eint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"nb\"\u003Eround\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eh\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Enp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Esqrt\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Earea_ratio\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ehw_mult\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)))\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eh_crop\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&amp;gt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eh\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Eh_crop\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eh\u003C\u002Fspan\u003E\n\t\n\t\u003Cspan class=\"c1\"\u003E# 随机生成左上角的位置\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Ex0\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Enp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Erandom\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Erandint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ew\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ew_crop\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E+\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Ey0\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Enp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Erandom\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Erandint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eh\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eh_crop\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E+\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\t\n    \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecrop_image\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimg\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ex0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ey0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ew_crop\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eh_crop\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"sd\"\u003E'''\u003C\u002Fspan\u003E\n\u003Cspan class=\"sd\"\u003E定义旋转函数：\u003C\u002Fspan\u003E\n\u003Cspan class=\"sd\"\u003Eangle是逆时针旋转的角度\u003C\u002Fspan\u003E\n\u003Cspan class=\"sd\"\u003Ecrop是个布尔值，表明是否要裁剪去除黑边\u003C\u002Fspan\u003E\n\u003Cspan class=\"sd\"\u003E'''\u003C\u002Fspan\u003E\n\u003Cspan class=\"k\"\u003Edef\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Erotate_image\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimg\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eangle\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecrop\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E):\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Eh\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ew\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eimg\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eshape\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[:\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E\n\t\n\t\u003Cspan class=\"c1\"\u003E# 旋转角度的周期是360°\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Eangle\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E%=\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E360\u003C\u002Fspan\u003E\n\t\n\t\u003Cspan class=\"c1\"\u003E# 用OpenCV内置函数计算仿射矩阵\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003EM_rotate\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EgetRotationMatrix2D\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E((\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ew\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eh\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eangle\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\t\n\t\u003Cspan class=\"c1\"\u003E# 得到旋转后的图像\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Eimg_rotated\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EwarpAffine\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimg\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EM_rotate\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ew\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eh\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E))\u003C\u002Fspan\u003E\n\n\t\u003Cspan class=\"c1\"\u003E# 如果需要裁剪去除黑边\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecrop\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\n\t    \u003Cspan class=\"c1\"\u003E# 对于裁剪角度的等效周期是180°\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Eangle_crop\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eangle\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E%\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E180\u003C\u002Fspan\u003E\n\t\t\n\t\t\u003Cspan class=\"c1\"\u003E# 并且关于90°对称\u003C\u002Fspan\u003E\n        \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eangle_crop\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&amp;gt;\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E90\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\n            \u003Cspan class=\"n\"\u003Eangle_crop\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E180\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eangle_crop\u003C\u002Fspan\u003E\n\t\t\t\n\t\t\u003Cspan class=\"c1\"\u003E# 转化角度为弧度\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Etheta\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eangle_crop\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Enp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Epi\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E\u002F\u003C\u002Fspan\u003E \u003Cspan class=\"mf\"\u003E180.0\u003C\u002Fspan\u003E\n\t\t\n\t\t\u003Cspan class=\"c1\"\u003E# 计算高宽比\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Ehw_ratio\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"nb\"\u003Efloat\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eh\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E\u002F\u003C\u002Fspan\u003E \u003Cspan class=\"nb\"\u003Efloat\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ew\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\t\t\n\t\t\u003Cspan class=\"c1\"\u003E# 计算裁剪边长系数的分子项\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Etan_theta\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Enp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Etan\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Etheta\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Enumerator\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Enp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecos\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Etheta\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Enp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Esin\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Etheta\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Etan_theta\u003C\u002Fspan\u003E\n\t\t\n\t\t\u003Cspan class=\"c1\"\u003E# 计算分母项中和宽高比相关的项\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Er\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ehw_ratio\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eh\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&amp;gt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ew\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Eelse\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E\u002F\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ehw_ratio\u003C\u002Fspan\u003E\n\t\t\n\t\t\u003Cspan class=\"c1\"\u003E# 计算分母项\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Edenominator\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Er\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Etan_theta\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\n\t\t\n\t\t\u003Cspan class=\"c1\"\u003E# 计算最终的边长系数\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Ecrop_mult\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Enumerator\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E\u002F\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Edenominator\u003C\u002Fspan\u003E\n\t\t\n\t\t\u003Cspan class=\"c1\"\u003E# 得到裁剪区域\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Ew_crop\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"nb\"\u003Eint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"nb\"\u003Eround\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecrop_mult\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ew\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E))\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Eh_crop\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"nb\"\u003Eint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"nb\"\u003Eround\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecrop_mult\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eh\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E))\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Ex0\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"nb\"\u003Eint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E((\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ew\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ew_crop\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Ey0\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"nb\"\u003Eint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E((\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eh\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eh_crop\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n        \u003Cspan class=\"n\"\u003Eimg_rotated\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecrop_image\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimg_rotated\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ex0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ey0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ew_crop\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eh_crop\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eimg_rotated\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"sd\"\u003E'''\u003C\u002Fspan\u003E\n\u003Cspan class=\"sd\"\u003E随机旋转\u003C\u002Fspan\u003E\n\u003Cspan class=\"sd\"\u003Eangle_vari是旋转角度的范围[-angle_vari, angle_vari)\u003C\u002Fspan\u003E\n\u003Cspan class=\"sd\"\u003Ep_crop是要进行去黑边裁剪的比例\u003C\u002Fspan\u003E\n\u003Cspan class=\"sd\"\u003E'''\u003C\u002Fspan\u003E\n\u003Cspan class=\"k\"\u003Edef\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Erandom_rotate\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimg\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eangle_vari\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ep_crop\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E):\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Eangle\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Enp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Erandom\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Euniform\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eangle_vari\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eangle_vari\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Ecrop\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"bp\"\u003EFalse\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Enp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Erandom\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Erandom\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&amp;gt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ep_crop\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Eelse\u003C\u002Fspan\u003E \u003Cspan class=\"bp\"\u003ETrue\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Erotate_image\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimg\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eangle\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecrop\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"sd\"\u003E'''\u003C\u002Fspan\u003E\n\u003Cspan class=\"sd\"\u003E定义hsv变换函数：\u003C\u002Fspan\u003E\n\u003Cspan class=\"sd\"\u003Ehue_delta是色调变化比例\u003C\u002Fspan\u003E\n\u003Cspan class=\"sd\"\u003Esat_delta是饱和度变化比例\u003C\u002Fspan\u003E\n\u003Cspan class=\"sd\"\u003Eval_delta是明度变化比例\u003C\u002Fspan\u003E\n\u003Cspan class=\"sd\"\u003E'''\u003C\u002Fspan\u003E\n\u003Cspan class=\"k\"\u003Edef\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Ehsv_transform\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimg\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ehue_delta\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Esat_mult\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eval_mult\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E):\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Eimg_hsv\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EcvtColor\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimg\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ECOLOR_BGR2HSV\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eastype\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Enp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Efloat\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Eimg_hsv\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[:,\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E:,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimg_hsv\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[:,\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E:,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ehue_delta\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E%\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E180\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Eimg_hsv\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[:,\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E:,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E*=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Esat_mult\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Eimg_hsv\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[:,\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E:,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E*=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eval_mult\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Eimg_hsv\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimg_hsv\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&amp;gt;\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E255\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E255\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EcvtColor\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Enp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eround\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimg_hsv\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eastype\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Enp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Euint8\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ECOLOR_HSV2BGR\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"sd\"\u003E'''\u003C\u002Fspan\u003E\n\u003Cspan class=\"sd\"\u003E随机hsv变换\u003C\u002Fspan\u003E\n\u003Cspan class=\"sd\"\u003Ehue_vari是色调变化比例的范围\u003C\u002Fspan\u003E\n\u003Cspan class=\"sd\"\u003Esat_vari是饱和度变化比例的范围\u003C\u002Fspan\u003E\n\u003Cspan class=\"sd\"\u003Eval_vari是明度变化比例的范围\u003C\u002Fspan\u003E\n\u003Cspan class=\"sd\"\u003E'''\u003C\u002Fspan\u003E\n\u003Cspan class=\"k\"\u003Edef\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Erandom_hsv_transform\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimg\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ehue_vari\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Esat_vari\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eval_vari\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E):\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Ehue_delta\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Enp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Erandom\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Erandint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ehue_vari\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ehue_vari\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Esat_mult\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Enp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Erandom\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Euniform\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Esat_vari\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Esat_vari\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Eval_mult\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Enp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Erandom\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Euniform\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eval_vari\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eval_vari\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ehsv_transform\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimg\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ehue_delta\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Esat_mult\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eval_mult\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"sd\"\u003E'''\u003C\u002Fspan\u003E\n\u003Cspan class=\"sd\"\u003E定义gamma变换函数：\u003C\u002Fspan\u003E\n\u003Cspan class=\"sd\"\u003Egamma就是Gamma\u003C\u002Fspan\u003E\n\u003Cspan class=\"sd\"\u003E'''\u003C\u002Fspan\u003E\n\u003Cspan class=\"k\"\u003Edef\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Egamma_transform\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimg\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Egamma\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E):\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Egamma_table\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Enp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Epower\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E\u002F\u003C\u002Fspan\u003E \u003Cspan class=\"mf\"\u003E255.0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Egamma\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\"mf\"\u003E255.0\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E \u003Cspan class=\"ow\"\u003Ein\u003C\u002Fspan\u003E \u003Cspan class=\"nb\"\u003Erange\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E256\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)]\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Egamma_table\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Enp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eround\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Enp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Earray\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Egamma_table\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E))\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eastype\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Enp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Euint8\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ELUT\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimg\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Egamma_table\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"sd\"\u003E'''\u003C\u002Fspan\u003E\n\u003Cspan class=\"sd\"\u003E随机gamma变换\u003C\u002Fspan\u003E\n\u003Cspan class=\"sd\"\u003Egamma_vari是Gamma变化的范围[1\u002Fgamma_vari, gamma_vari)\u003C\u002Fspan\u003E\n\u003Cspan class=\"sd\"\u003E'''\u003C\u002Fspan\u003E\n\u003Cspan class=\"k\"\u003Edef\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Erandom_gamma_transform\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimg\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Egamma_vari\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E):\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Elog_gamma_vari\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Enp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Elog\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Egamma_vari\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Ealpha\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Enp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Erandom\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Euniform\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Elog_gamma_vari\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Elog_gamma_vari\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Egamma\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Enp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eexp\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ealpha\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Egamma_transform\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimg\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Egamma\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E调用这些函数需要通过一个主程序。这个主程序里首先定义三个子模块，定义一个函数parse_arg()通过Python的argparse模块定义了各种输入参数和默认值。需要注意的是这里用argparse来输入所有参数是因为参数总量并不是特别多，如果增加了更多的扰动方法，更合适的参数输入方式可能是通过一个配置文件。然后定义一个生成待处理图像列表的函数generate_image_list()，根据输入中要增加图片的数量和并行进程的数目尽可能均匀地为每个进程生成了需要处理的任务列表。执行随机扰动的代码定义在augment_images()中，这个函数是每个进程内进行实际处理的函数，执行顺序是镜像\u003Cimg src=\"http:\u002F\u002Fwww.zhihu.com\u002Fequation?tex=%5Crightarrow+\" alt=\"\\rightarrow \" eeimg=\"1\"\u003E裁剪\u003Cimg src=\"http:\u002F\u002Fwww.zhihu.com\u002Fequation?tex=%5Crightarrow+\" alt=\"\\rightarrow \" eeimg=\"1\"\u003E旋转\u003Cimg src=\"http:\u002F\u002Fwww.zhihu.com\u002Fequation?tex=%5Crightarrow+\" alt=\"\\rightarrow \" eeimg=\"1\"\u003EHSV\u003Cimg src=\"http:\u002F\u002Fwww.zhihu.com\u002Fequation?tex=%5Crightarrow+\" alt=\"\\rightarrow \" eeimg=\"1\"\u003EGamma。需要注意的是镜像\u003Cimg src=\"http:\u002F\u002Fwww.zhihu.com\u002Fequation?tex=%5Crightarrow+\" alt=\"\\rightarrow \" eeimg=\"1\"\u003E裁剪，因为只是个演示例子，这未必是一个合适的顺序。最后定义一个main函数进行调用，代码如下：\n\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-python\"\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"kn\"\u003Eimport\u003C\u002Fspan\u003E \u003Cspan class=\"nn\"\u003Eos\u003C\u002Fspan\u003E\n\u003Cspan class=\"kn\"\u003Eimport\u003C\u002Fspan\u003E \u003Cspan class=\"nn\"\u003Eargparse\u003C\u002Fspan\u003E\n\u003Cspan class=\"kn\"\u003Eimport\u003C\u002Fspan\u003E \u003Cspan class=\"nn\"\u003Erandom\u003C\u002Fspan\u003E\n\u003Cspan class=\"kn\"\u003Eimport\u003C\u002Fspan\u003E \u003Cspan class=\"nn\"\u003Emath\u003C\u002Fspan\u003E\n\u003Cspan class=\"kn\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\"nn\"\u003Emultiprocessing\u003C\u002Fspan\u003E \u003Cspan class=\"kn\"\u003Eimport\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EProcess\u003C\u002Fspan\u003E\n\u003Cspan class=\"kn\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\"nn\"\u003Emultiprocessing\u003C\u002Fspan\u003E \u003Cspan class=\"kn\"\u003Eimport\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecpu_count\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"kn\"\u003Eimport\u003C\u002Fspan\u003E \u003Cspan class=\"nn\"\u003Ecv2\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# 导入image_augmentation.py为一个可调用模块\u003C\u002Fspan\u003E\n\u003Cspan class=\"kn\"\u003Eimport\u003C\u002Fspan\u003E \u003Cspan class=\"nn\"\u003Eimage_augmentation\u003C\u002Fspan\u003E \u003Cspan class=\"kn\"\u003Eas\u003C\u002Fspan\u003E \u003Cspan class=\"nn\"\u003Eia\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# 利用Python的argparse模块读取输入输出和各种扰动参数\u003C\u002Fspan\u003E\n\u003Cspan class=\"k\"\u003Edef\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Eparse_args\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E():\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Eparser\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eargparse\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EArgumentParser\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Edescription\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'A Simple Image Data Augmentation Tool'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Eformatter_class\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eargparse\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EArgumentDefaultsHelpFormatter\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"n\"\u003Eparser\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eadd_argument\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'input_dir'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\n                        \u003Cspan class=\"n\"\u003Ehelp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'Directory containing images'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Eparser\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eadd_argument\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'output_dir'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\n                        \u003Cspan class=\"n\"\u003Ehelp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'Directory for augmented images'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Eparser\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eadd_argument\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'num'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\n                        \u003Cspan class=\"n\"\u003Ehelp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'Number of images to be augmented'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\n                        \u003Cspan class=\"nb\"\u003Etype\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"nb\"\u003Eint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"n\"\u003Eparser\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eadd_argument\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'--num_procs'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\n                        \u003Cspan class=\"n\"\u003Ehelp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'Number of processes for paralleled augmentation'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\n                        \u003Cspan class=\"nb\"\u003Etype\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"nb\"\u003Eint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Edefault\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecpu_count\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E())\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"n\"\u003Eparser\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eadd_argument\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'--p_mirror'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\n                        \u003Cspan class=\"n\"\u003Ehelp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'Ratio to mirror an image'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\n                        \u003Cspan class=\"nb\"\u003Etype\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"nb\"\u003Efloat\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Edefault\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"mf\"\u003E0.5\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"n\"\u003Eparser\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eadd_argument\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'--p_crop'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\n                        \u003Cspan class=\"n\"\u003Ehelp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'Ratio to randomly crop an image'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\n                        \u003Cspan class=\"nb\"\u003Etype\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"nb\"\u003Efloat\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Edefault\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"mf\"\u003E1.0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Eparser\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eadd_argument\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'--crop_size'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\n                        \u003Cspan class=\"n\"\u003Ehelp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'The ratio of cropped image size to original image size, in area'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\n                        \u003Cspan class=\"nb\"\u003Etype\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"nb\"\u003Efloat\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Edefault\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"mf\"\u003E0.8\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Eparser\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eadd_argument\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'--crop_hw_vari'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\n                        \u003Cspan class=\"n\"\u003Ehelp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'Variation of h\u002Fw ratio'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\n                        \u003Cspan class=\"nb\"\u003Etype\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"nb\"\u003Efloat\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Edefault\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"mf\"\u003E0.1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"n\"\u003Eparser\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eadd_argument\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'--p_rotate'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\n                        \u003Cspan class=\"n\"\u003Ehelp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'Ratio to randomly rotate an image'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\n                        \u003Cspan class=\"nb\"\u003Etype\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"nb\"\u003Efloat\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Edefault\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"mf\"\u003E1.0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Eparser\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eadd_argument\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'--p_rotate_crop'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\n                        \u003Cspan class=\"n\"\u003Ehelp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'Ratio to crop out the empty part in a rotated image'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\n                        \u003Cspan class=\"nb\"\u003Etype\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"nb\"\u003Efloat\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Edefault\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"mf\"\u003E1.0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Eparser\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eadd_argument\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'--rotate_angle_vari'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\n                        \u003Cspan class=\"n\"\u003Ehelp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'Variation range of rotate angle'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\n                        \u003Cspan class=\"nb\"\u003Etype\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"nb\"\u003Efloat\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Edefault\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"mf\"\u003E10.0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"n\"\u003Eparser\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eadd_argument\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'--p_hsv'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\n                        \u003Cspan class=\"n\"\u003Ehelp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'Ratio to randomly change gamma of an image'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\n                        \u003Cspan class=\"nb\"\u003Etype\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"nb\"\u003Efloat\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Edefault\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"mf\"\u003E1.0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Eparser\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eadd_argument\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'--hue_vari'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\n                        \u003Cspan class=\"n\"\u003Ehelp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'Variation of hue'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\n                        \u003Cspan class=\"nb\"\u003Etype\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"nb\"\u003Eint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Edefault\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E10\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Eparser\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eadd_argument\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'--sat_vari'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\n                        \u003Cspan class=\"n\"\u003Ehelp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'Variation of saturation'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\n                        \u003Cspan class=\"nb\"\u003Etype\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"nb\"\u003Efloat\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Edefault\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"mf\"\u003E0.1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Eparser\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eadd_argument\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'--val_vari'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\n                        \u003Cspan class=\"n\"\u003Ehelp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'Variation of value'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\n                        \u003Cspan class=\"nb\"\u003Etype\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"nb\"\u003Efloat\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Edefault\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"mf\"\u003E0.1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"n\"\u003Eparser\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eadd_argument\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'--p_gamma'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\n                        \u003Cspan class=\"n\"\u003Ehelp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'Ratio to randomly change gamma of an image'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\n                        \u003Cspan class=\"nb\"\u003Etype\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"nb\"\u003Efloat\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Edefault\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"mf\"\u003E1.0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Eparser\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eadd_argument\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'--gamma_vari'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\n                        \u003Cspan class=\"n\"\u003Ehelp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'Variation of gamma'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\n                        \u003Cspan class=\"nb\"\u003Etype\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"nb\"\u003Efloat\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Edefault\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"mf\"\u003E2.0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"n\"\u003Eargs\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eparser\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eparse_args\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Eargs\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Einput_dir\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eargs\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Einput_dir\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Erstrip\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'\u002F'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Eargs\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eoutput_dir\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eargs\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eoutput_dir\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Erstrip\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'\u002F'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eargs\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"sd\"\u003E'''\u003C\u002Fspan\u003E\n\u003Cspan class=\"sd\"\u003E根据进程数和要增加的目标图片数，\u003C\u002Fspan\u003E\n\u003Cspan class=\"sd\"\u003E生成每个进程要处理的文件列表和每个文件要增加的数目\u003C\u002Fspan\u003E\n\u003Cspan class=\"sd\"\u003E'''\u003C\u002Fspan\u003E\n\u003Cspan class=\"k\"\u003Edef\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Egenerate_image_list\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eargs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E):\u003C\u002Fspan\u003E\n    \u003Cspan class=\"c1\"\u003E# 获取所有文件名和文件总数\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Efilenames\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eos\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Elistdir\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eargs\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Einput_dir\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Enum_imgs\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"nb\"\u003Elen\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Efilenames\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n\t\u003Cspan class=\"c1\"\u003E# 计算平均处理的数目并向下取整\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Enum_ave_aug\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"nb\"\u003Eint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Emath\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Efloor\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eargs\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Enum\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Enum_imgs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E))\u003C\u002Fspan\u003E\n\t\n\t\u003Cspan class=\"c1\"\u003E# 剩下的部分不足平均分配到每一个文件，所以做成一个随机幸运列表\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"c1\"\u003E# 对于幸运的文件就多增加一个，凑够指定的数目\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Erem\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eargs\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Enum\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Enum_ave_aug\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Enum_imgs\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Elucky_seq\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"bp\"\u003ETrue\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Erem\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"bp\"\u003EFalse\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Enum_imgs\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Erem\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Erandom\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eshuffle\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Elucky_seq\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n\t\u003Cspan class=\"c1\"\u003E# 根据平均分配和幸运表策略，\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"c1\"\u003E# 生成每个文件的全路径和对应要增加的数目并放到一个list里\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Eimg_list\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\n        \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eos\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Esep\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ejoin\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E([\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eargs\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Einput_dir\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Efilename\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]),\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Enum_ave_aug\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E+\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Elucky\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Eelse\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Enum_ave_aug\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n        \u003Cspan class=\"k\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Efilename\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Elucky\u003C\u002Fspan\u003E \u003Cspan class=\"ow\"\u003Ein\u003C\u002Fspan\u003E \u003Cspan class=\"nb\"\u003Ezip\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Efilenames\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Elucky_seq\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E\n\t\n\t\u003Cspan class=\"c1\"\u003E# 文件可能大小不一，处理时间也不一样，\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"c1\"\u003E# 所以随机打乱，尽可能保证处理时间均匀\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Erandom\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eshuffle\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimg_list\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n\t\u003Cspan class=\"c1\"\u003E# 生成每个进程的文件列表，\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"c1\"\u003E# 尽可能均匀地划分每个进程要处理的数目\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Elength\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"nb\"\u003Efloat\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Enum_imgs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E\u002F\u003C\u002Fspan\u003E \u003Cspan class=\"nb\"\u003Efloat\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eargs\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Enum_procs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Eindices\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"nb\"\u003Eint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"nb\"\u003Eround\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Elength\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E))\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E \u003Cspan class=\"ow\"\u003Ein\u003C\u002Fspan\u003E \u003Cspan class=\"nb\"\u003Erange\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eargs\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Enum_procs\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)]\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimg_list\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eindices\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]:\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eindices\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]]\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E \u003Cspan class=\"ow\"\u003Ein\u003C\u002Fspan\u003E \u003Cspan class=\"nb\"\u003Erange\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eargs\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Enum_procs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)]\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# 每个进程内调用图像处理函数进行扰动的函数\u003C\u002Fspan\u003E\n\u003Cspan class=\"k\"\u003Edef\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Eaugment_images\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Efilelist\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eargs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E):\u003C\u002Fspan\u003E\n    \u003Cspan class=\"c1\"\u003E# 遍历所有列表内的文件\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Efilepath\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003En\u003C\u002Fspan\u003E \u003Cspan class=\"ow\"\u003Ein\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Efilelist\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Eimg\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimread\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Efilepath\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Efilename\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Efilepath\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Esplit\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eos\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Esep\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)[\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Edot_pos\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Efilename\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Erfind\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'.'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\t\t\n\t\t\u003Cspan class=\"c1\"\u003E# 获取文件名和后缀名\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Eimgname\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Efilename\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[:\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Edot_pos\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Eext\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Efilename\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Edot_pos\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:]\u003C\u002Fspan\u003E\n\n        \u003Cspan class=\"k\"\u003Eprint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'Augmenting {} ...'\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eformat\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Efilename\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E))\u003C\u002Fspan\u003E\n        \u003Cspan class=\"k\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E \u003Cspan class=\"ow\"\u003Ein\u003C\u002Fspan\u003E \u003Cspan class=\"nb\"\u003Erange\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003En\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E):\u003C\u002Fspan\u003E\n            \u003Cspan class=\"n\"\u003Eimg_varied\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eimg\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecopy\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E\n\t\t\t\n\t\t\t\u003Cspan class=\"c1\"\u003E# 扰动后文件名的前缀\u003C\u002Fspan\u003E\n            \u003Cspan class=\"n\"\u003Evaried_imgname\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"s1\"\u003E'{}_{:0&amp;gt;3d}_'\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eformat\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimgname\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\t\t\t\n\t\t\t\u003Cspan class=\"c1\"\u003E# 按照比例随机对图像进行镜像\u003C\u002Fspan\u003E\n            \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Erandom\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Erandom\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&amp;lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eargs\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ep_mirror\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\n\t\t\t    \u003Cspan class=\"c1\"\u003E# 利用numpy.fliplr(img_varied)也能实现\u003C\u002Fspan\u003E\n                \u003Cspan class=\"n\"\u003Eimg_varied\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eflip\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimg_varied\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n                \u003Cspan class=\"n\"\u003Evaried_imgname\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E+=\u003C\u002Fspan\u003E \u003Cspan class=\"s1\"\u003E'm'\u003C\u002Fspan\u003E\n\t\t\t\n\t\t\t\u003Cspan class=\"c1\"\u003E# 按照比例随机对图像进行裁剪\u003C\u002Fspan\u003E\n            \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Erandom\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Erandom\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&amp;lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eargs\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ep_crop\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\n                \u003Cspan class=\"n\"\u003Eimg_varied\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eia\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Erandom_crop\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\n                    \u003Cspan class=\"n\"\u003Eimg_varied\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\n                    \u003Cspan class=\"n\"\u003Eargs\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecrop_size\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\n                    \u003Cspan class=\"n\"\u003Eargs\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecrop_hw_vari\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n                \u003Cspan class=\"n\"\u003Evaried_imgname\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E+=\u003C\u002Fspan\u003E \u003Cspan class=\"s1\"\u003E'c'\u003C\u002Fspan\u003E\n\t\t\t\n\t\t\t\u003Cspan class=\"c1\"\u003E# 按照比例随机对图像进行旋转\u003C\u002Fspan\u003E\n            \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Erandom\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Erandom\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&amp;lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eargs\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ep_rotate\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\n                \u003Cspan class=\"n\"\u003Eimg_varied\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eia\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Erandom_rotate\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\n                    \u003Cspan class=\"n\"\u003Eimg_varied\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\n                    \u003Cspan class=\"n\"\u003Eargs\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Erotate_angle_vari\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\n                    \u003Cspan class=\"n\"\u003Eargs\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ep_rotate_crop\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n                \u003Cspan class=\"n\"\u003Evaried_imgname\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E+=\u003C\u002Fspan\u003E \u003Cspan class=\"s1\"\u003E'r'\u003C\u002Fspan\u003E\n\t\t\t\n\t\t\t\u003Cspan class=\"c1\"\u003E# 按照比例随机对图像进行HSV扰动\u003C\u002Fspan\u003E\n            \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Erandom\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Erandom\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&amp;lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eargs\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ep_hsv\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\n                \u003Cspan class=\"n\"\u003Eimg_varied\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eia\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Erandom_hsv_transform\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\n                    \u003Cspan class=\"n\"\u003Eimg_varied\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\n                    \u003Cspan class=\"n\"\u003Eargs\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ehue_vari\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\n                    \u003Cspan class=\"n\"\u003Eargs\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Esat_vari\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\n                    \u003Cspan class=\"n\"\u003Eargs\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eval_vari\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n                \u003Cspan class=\"n\"\u003Evaried_imgname\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E+=\u003C\u002Fspan\u003E \u003Cspan class=\"s1\"\u003E'h'\u003C\u002Fspan\u003E\n\t\t\t\n\t\t\t\u003Cspan class=\"c1\"\u003E# 按照比例随机对图像进行Gamma扰动\u003C\u002Fspan\u003E\n            \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Erandom\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Erandom\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&amp;lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eargs\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ep_gamma\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\n                \u003Cspan class=\"n\"\u003Eimg_varied\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eia\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Erandom_gamma_transform\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\n                    \u003Cspan class=\"n\"\u003Eimg_varied\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\n                    \u003Cspan class=\"n\"\u003Eargs\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Egamma_vari\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n                \u003Cspan class=\"n\"\u003Evaried_imgname\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E+=\u003C\u002Fspan\u003E \u003Cspan class=\"s1\"\u003E'g'\u003C\u002Fspan\u003E\n\t\t\t\n\t\t\t\u003Cspan class=\"c1\"\u003E# 生成扰动后的文件名并保存在指定的路径\u003C\u002Fspan\u003E\n            \u003Cspan class=\"n\"\u003Eoutput_filepath\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eos\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Esep\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ejoin\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E([\u003C\u002Fspan\u003E\n                \u003Cspan class=\"n\"\u003Eargs\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eoutput_dir\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\n                \u003Cspan class=\"s1\"\u003E'{}{}'\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eformat\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Evaried_imgname\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eext\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)])\u003C\u002Fspan\u003E\n            \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimwrite\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eoutput_filepath\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eimg_varied\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# 主函数\u003C\u002Fspan\u003E\n\u003Cspan class=\"k\"\u003Edef\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Emain\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E():\u003C\u002Fspan\u003E\n    \u003Cspan class=\"c1\"\u003E# 获取输入输出和变换选项\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Eargs\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eparse_args\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Eparams_str\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"nb\"\u003Estr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eargs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)[\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E10\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E\n\n\t\u003Cspan class=\"c1\"\u003E# 如果输出文件夹不存在，则建立文件夹\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"ow\"\u003Enot\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eos\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Epath\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eexists\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eargs\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eoutput_dir\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E):\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Eos\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Emkdir\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eargs\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eoutput_dir\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"k\"\u003Eprint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'Starting image data augmentation for {}\u003C\u002Fspan\u003E\u003Cspan class=\"se\"\u003E\\n\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'\u003C\u002Fspan\u003E\n          \u003Cspan class=\"s1\"\u003E'with\u003C\u002Fspan\u003E\u003Cspan class=\"se\"\u003E\\n\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E{}\u003C\u002Fspan\u003E\u003Cspan class=\"se\"\u003E\\n\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eformat\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eargs\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Einput_dir\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eparams_str\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E))\u003C\u002Fspan\u003E\n\n\t\u003Cspan class=\"c1\"\u003E# 生成每个进程要处理的列表\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Esublists\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Egenerate_image_list\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eargs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\t\n\t\u003Cspan class=\"c1\"\u003E# 创建进程\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Eprocesses\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EProcess\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Etarget\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eaugment_images\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eargs\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eargs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E))\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E \u003Cspan class=\"ow\"\u003Ein\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Esublists\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E\n\n\t\u003Cspan class=\"c1\"\u003E# 并行多进程处理\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ep\u003C\u002Fspan\u003E \u003Cspan class=\"ow\"\u003Ein\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eprocesses\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Ep\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estart\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"k\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ep\u003C\u002Fspan\u003E \u003Cspan class=\"ow\"\u003Ein\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eprocesses\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Ep\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ejoin\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"k\"\u003Eprint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'\u003C\u002Fspan\u003E\u003Cspan class=\"se\"\u003E\\n\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003EDone!'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003E__name__\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E==\u003C\u002Fspan\u003E \u003Cspan class=\"s1\"\u003E'__main__'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Emain\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E为了排版方便，并没有很遵守Python的规范（PEP8）。注意到除了前面提的三种类型的变化，还增加了镜像变化，这主要是因为这种变换太简单了，顺手就写上了。还有默认进程数用的是cpu_count()函数，这个获取的是cpu的核数。把这段代码保存为run_augmentation.py，然后在命令行输入：\u003C\u002Fp\u003E\u003Cp\u003E&amp;gt;&amp;gt; python run_augmentation.py -h\n\u003C\u002Fp\u003E\u003Cp\u003E\u003Cbr\u003E\u003C\u002Fp\u003E\u003Cp\u003E或者\u003C\u002Fp\u003E\u003Cp\u003E&amp;gt;&amp;gt; python run_augmentation.py --help\n\u003C\u002Fp\u003E\u003Cp\u003E\u003Cbr\u003E\u003C\u002Fp\u003E\u003Cp\u003E就能看到脚本的使用方法，每个参数的含义，还有默认值。接下里来执行一个图片增加任务：\u003C\u002Fp\u003E\u003Cp\u003E&amp;gt;&amp;gt; python run_augmentation.py imagenet_samples more_samples 1000 --rotate_angle_vari 180 --p_rotate_crop 0.5\n\u003C\u002Fp\u003E\u003Cp\u003E其中imagenet_samples为一些从imagenet图片url中随机下载的一些图片，--rotate_angle_vari设为180方便测试全方向的旋转，--p_rotate_crop设置为0.5，让旋转裁剪对一半图片生效。扰动增加后的1000张图片在more_samples文件夹下，得到的部分结果如下：\u003C\u002Fp\u003E\u003Cfigure\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-dc6d55514e584fcc8a7b5bf8b20b136c_b.jpg\" data-rawwidth=\"1018\" data-rawheight=\"618\" class=\"origin_image zh-lightbox-thumb\" width=\"1018\" data-original=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-dc6d55514e584fcc8a7b5bf8b20b136c_r.jpg\"\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&amp;lt;svg%20xmlns='http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg'%20width='1018'%20height='618'&amp;gt;&amp;lt;\u002Fsvg&amp;gt;\" data-rawwidth=\"1018\" data-rawheight=\"618\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1018\" data-original=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-dc6d55514e584fcc8a7b5bf8b20b136c_r.jpg\" data-actualsrc=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-dc6d55514e584fcc8a7b5bf8b20b136c_b.jpg\"\u003E\u003C\u002Ffigure\u003E\u003Ch2\u003E6.4 用OpenCV实现数据标注小工具\u003C\u002Fh2\u003E\u003Cp\u003E除了对图像的处理，OpenCV的图形用户界面（\u003Cb\u003EG\u003C\u002Fb\u003Eraphical \u003Cb\u003EU\u003C\u002Fb\u003Eser \u003Cb\u003EI\u003C\u002Fb\u003Enterface, \u003Cb\u003EGUI\u003C\u002Fb\u003E）和绘图等相关功能也是很有用的功能，无论是可视化，图像调试还是我们这节要实现的标注任务，都可以有所帮助。这节先介绍OpenCV窗口的最基本使用和交互，然后基于这些基础和之前的知识实现一个用于物体检测任务标注的小工具。\u003C\u002Fp\u003E\u003Ch2\u003E6.4.1\nOpenCV窗口循环\u003C\u002Fh2\u003E\u003Cp\u003EOpenCV显示一幅图片的函数是cv2.imshow()，第一个参数是显示图片的窗口名称，第二个参数是图片的array。不过如果直接执行这个函数的话，什么都不会发生，因为这个函数得配合cv2.waitKey()一起使用。cv2.waitKey()指定当前的窗口显示要持续的毫秒数，比如cv2.waitKey(1000)就是显示一秒，然后窗口就关闭了。比较特殊的是cv2.waitKey(0)，并不是显示0毫秒的意思，而是一直显示，直到有键盘上的按键被按下，或者鼠标点击了窗口的小叉子才关闭。cv2.waitKey()的默认参数就是0，所以对于图像展示的场景，cv2.waitKey()或者cv2.waitKey(0)是最常用的：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-python\"\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"kn\"\u003Eimport\u003C\u002Fspan\u003E \u003Cspan class=\"nn\"\u003Ecv2\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"n\"\u003Eimg\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimread\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'Aitutaki.png'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimshow\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'Honeymoon Island'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eimg\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EwaitKey\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E执行这段代码得到如下窗口：\u003C\u002Fp\u003E\u003Cfigure\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-1712545c1114f3f66f37121c02354144_b.jpg\" data-rawwidth=\"722\" data-rawheight=\"515\" class=\"origin_image zh-lightbox-thumb\" width=\"722\" data-original=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-1712545c1114f3f66f37121c02354144_r.jpg\"\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&amp;lt;svg%20xmlns='http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg'%20width='722'%20height='515'&amp;gt;&amp;lt;\u002Fsvg&amp;gt;\" data-rawwidth=\"722\" data-rawheight=\"515\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"722\" data-original=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-1712545c1114f3f66f37121c02354144_r.jpg\" data-actualsrc=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-1712545c1114f3f66f37121c02354144_b.jpg\"\u003E\u003C\u002Ffigure\u003E\u003Cp\u003Ecv2.waitKey()参数不为零的时候则可以和循环结合产生动态画面，比如在6.2.4的延时小例子中，我们把延时摄影保存下来的所有图像放到一个叫做frames的文件夹下。下面代码从frames的文件夹下读取所有图片并以24的帧率在窗口中显示成动画：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-python\"\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"kn\"\u003Eimport\u003C\u002Fspan\u003E \u003Cspan class=\"nn\"\u003Eos\u003C\u002Fspan\u003E\n\u003Cspan class=\"kn\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\"nn\"\u003Eitertools\u003C\u002Fspan\u003E \u003Cspan class=\"kn\"\u003Eimport\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecycle\u003C\u002Fspan\u003E\n\u003Cspan class=\"kn\"\u003Eimport\u003C\u002Fspan\u003E \u003Cspan class=\"nn\"\u003Ecv2\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# 列出frames文件夹下的所有图片\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Efilenames\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eos\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Elistdir\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'frames'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# 通过itertools.cycle生成一个无限循环的迭代器，每次迭代都输出下一张图像对象\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Eimg_iter\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecycle\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E([\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimread\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eos\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Esep\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ejoin\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E([\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'frames'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]))\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E \u003Cspan class=\"ow\"\u003Ein\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Efilenames\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E])\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"n\"\u003Ekey\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\n\u003Cspan class=\"k\"\u003Ewhile\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ekey\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&amp;amp;\u003C\u002Fspan\u003E \u003Cspan class=\"mh\"\u003E0xFF\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E!=\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E27\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimshow\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'Animation'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"nb\"\u003Enext\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimg_iter\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E))\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Ekey\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EwaitKey\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E42\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E在这个例子中我们采用了Python的itertools模块中的cycle函数，这个函数可以把一个可遍历结构编程一个无限循环的迭代器。另外从这个例子中我们还发现，cv2.waitKey()返回的就是键盘上出发的按键。对于字母就是ascii码，特殊按键比如上下左右等，则对应特殊的值，其实这就是键盘事件的最基本用法。\u003C\u002Fp\u003E\u003Ch2\u003E6.4.2\n鼠标和键盘事件\u003C\u002Fh2\u003E\u003Cp\u003E因为GUI总是交互的，所以鼠标和键盘事件基本使用必不可少，上节已经提到了cv2.waitKey()就是获取键盘消息的最基本方法。比如下面这段循环代码就能够获取键盘上按下的按键，并在终端输出：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-python\"\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Ewhile\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ekey\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E!=\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E27\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimshow\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'Honeymoon Island'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eimg\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Ekey\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EwaitKey\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E\n    \u003Cspan class=\"c1\"\u003E# 如果获取的键值小于256则作为ascii码输出对应字符，否则直接输出值\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Emsg\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"s1\"\u003E'{} is pressed'\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eformat\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"nb\"\u003Echr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ekey\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ekey\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&amp;lt;\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E256\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Eelse\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ekey\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Eprint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Emsg\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E通过这个程序我们能获取一些常用特殊按键的值，比如在笔者用的机器上，四个方向的按键和删除键对应的值如下：\u003C\u002Fp\u003E\u003Cp\u003E-         \n上（↑）：65362\u003C\u002Fp\u003E\u003Cp\u003E-         \n下（↓）：65364\u003C\u002Fp\u003E\u003Cp\u003E-         \n左（←）：65361\u003C\u002Fp\u003E\u003Cp\u003E-         \n右（→）：65363\u003C\u002Fp\u003E\u003Cp\u003E-         \n删除（Delete）：65535\u003C\u002Fp\u003E\u003Cp\u003E需要注意的是在不同的操作系统里这些值可能是不一样的。鼠标事件比起键盘事件稍微复杂一点点，需要定义一个回调函数，然后把回调函数和一个指定名称的窗口绑定，这样只要鼠标位于画面区域内的事件就都能捕捉到。把下面这段代码插入到上段代码的while之前，就能获取当前鼠标的位置和动作并输出：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-python\"\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E# 定义鼠标事件回调函数\u003C\u002Fspan\u003E\n\u003Cspan class=\"k\"\u003Edef\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Eon_mouse\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eevent\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ey\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eflags\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eparam\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E):\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"c1\"\u003E# 鼠标左键按下，抬起，双击\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eevent\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E==\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EEVENT_LBUTTONDOWN\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\n        \u003Cspan class=\"k\"\u003Eprint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'Left button down at ({}, {})'\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eformat\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ey\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E))\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Eelif\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eevent\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E==\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EEVENT_LBUTTONUP\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\n        \u003Cspan class=\"k\"\u003Eprint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'Left button up at ({}, {})'\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eformat\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ey\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E))\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Eelif\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eevent\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E==\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EEVENT_LBUTTONDBLCLK\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\n        \u003Cspan class=\"k\"\u003Eprint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'Left button double clicked at ({}, {})'\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eformat\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ey\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E))\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"c1\"\u003E# 鼠标右键按下，抬起，双击\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Eelif\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eevent\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E==\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EEVENT_RBUTTONDOWN\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\n        \u003Cspan class=\"k\"\u003Eprint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'Right button down at ({}, {})'\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eformat\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ey\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E))\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Eelif\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eevent\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E==\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EEVENT_RBUTTONUP\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\n        \u003Cspan class=\"k\"\u003Eprint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'Right button up at ({}, {})'\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eformat\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ey\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E))\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Eelif\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eevent\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E==\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EEVENT_RBUTTONDBLCLK\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\n        \u003Cspan class=\"k\"\u003Eprint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'Right button double clicked at ({}, {})'\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eformat\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ey\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E))\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"c1\"\u003E# 鼠标中\u002F滚轮键（如果有的话）按下，抬起，双击\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Eelif\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eevent\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E==\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EEVENT_MBUTTONDOWN\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\n        \u003Cspan class=\"k\"\u003Eprint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'Middle button down at ({}, {})'\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eformat\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ey\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E))\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Eelif\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eevent\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E==\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EEVENT_MBUTTONUP\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\n        \u003Cspan class=\"k\"\u003Eprint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'Middle button up at ({}, {})'\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eformat\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ey\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E))\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Eelif\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eevent\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E==\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EEVENT_MBUTTONDBLCLK\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\n        \u003Cspan class=\"k\"\u003Eprint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'Middle button double clicked at ({}, {})'\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eformat\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ey\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E))\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"c1\"\u003E# 鼠标移动\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Eelif\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eevent\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E==\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EEVENT_MOUSEMOVE\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\n        \u003Cspan class=\"k\"\u003Eprint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'Moving at ({}, {})'\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eformat\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ey\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E))\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# 为指定的窗口绑定自定义的回调函数\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EnamedWindow\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'Honeymoon Island'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EsetMouseCallback\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'Honeymoon Island'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eon_mouse\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Ch2\u003E6.4.3\n代码：物体检测标注的小工具\u003C\u002Fh2\u003E\u003Cp\u003E基于上面两小节的基本使用，就能和OpenCV的基本绘图功能就能实现一个超级简单的物体框标注小工具了。基本思路是对要标注的图像建立一个窗口循环，然后每次循环的时候对图像进行一次拷贝。鼠标在画面上画框的操作，以及已经画好的框的相关信息在全局变量中保存，并且在每个循环中根据这些信息，在拷贝的图像上再画一遍，然后显示这份拷贝的图像。\u003C\u002Fp\u003E\u003Cp\u003E基于这种实现思路，使用上我们采用一个尽量简化的设计：\u003C\u002Fp\u003E\u003Cp\u003E-         \n输入是一个文件夹，下面包含了所有要标注物体框的图片。如果图片中标注了物体，则生成一个相同名称加额外后缀名的文件保存标注信息。\u003C\u002Fp\u003E\u003Cp\u003E-         \n标注的方式是按下鼠标左键选择物体框的左上角，松开鼠标左键选择物体框的右下角，鼠标右键删除上一个标注好的物体框。所有待标注物体的类别，和标注框颜色由用户自定义，如果没有定义则默认只标注一种物体，定义该物体名称叫“Object”。\u003C\u002Fp\u003E\u003Cp\u003E-         \n方向键的←和→用来遍历图片，↑和↓用来选择当前要标注的物体，Delete键删除一张图片和对应的标注信息。\u003C\u002Fp\u003E\u003Cp\u003E每张图片的标注信息，以及自定义标注物体和颜色的信息，用一个元组表示，第一个元素是物体名字，第二个元素是代表BGR颜色的tuple或者是代表标注框坐标的元组。对于这种并不复杂复杂的数据结构，我们直接利用Python的repr()函数，把数据结构保存成机器可读的字符串放到文件里，读取的时候用eval()函数就能直接获得数据。这样的方便之处在于不需要单独写个格式解析器。如果需要可以在此基础上再编写一个转换工具就能够转换成常见的Pascal VOC的标注格式或是其他的自定义格式。\u003C\u002Fp\u003E\u003Cp\u003E\n在这些思路和设计下，我们定义标注信息文件的格式的例子如下：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E('Hill', ((221, 163), (741, 291)))\n('Horse', ((465, 430), (613, 570)))\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E元组中第一项是物体名称，第二项是标注框左上角和右下角的坐标。这里之所以不把标注信息的数据直接用pickle保存，是因为数据本身不会很复杂，直接保存还有更好的可读性。自定义标注物体和对应标注框颜色的格式也类似，不过更简单些，因为括号可以不写，具体如下：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E'Horse', (255, 255, 0)\n'Hill', (0, 255, 255)\n'DiaoSi', (0, 0, 255)\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E第一项是物体名称，第二项是物体框的颜色。使用的时候把自己定义好的内容放到一个文本里，然后保存成和待标注文件夹同名，后缀名为labels的文件。比如我们在一个叫samples的文件夹下放上一些草原的照片，然后自定义一个samples.labels的文本文件。把上段代码的内容放进去，就定义了小山头的框为黄色，骏马的框为青色，以及红色的屌丝。基于以上，标注小工具的代码如下：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-python\"\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"kn\"\u003Eimport\u003C\u002Fspan\u003E \u003Cspan class=\"nn\"\u003Eos\u003C\u002Fspan\u003E\n\u003Cspan class=\"kn\"\u003Eimport\u003C\u002Fspan\u003E \u003Cspan class=\"nn\"\u003Ecv2\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# tkinter是Python内置的简单GUI库，实现一些比如打开文件夹，确认删除等操作十分方便\u003C\u002Fspan\u003E\n\u003Cspan class=\"kn\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\"nn\"\u003EtkFileDialog\u003C\u002Fspan\u003E \u003Cspan class=\"kn\"\u003Eimport\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Easkdirectory\u003C\u002Fspan\u003E\n\u003Cspan class=\"kn\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\"nn\"\u003EtkMessageBox\u003C\u002Fspan\u003E \u003Cspan class=\"kn\"\u003Eimport\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Easkyesno\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# 定义标注窗口的默认名称\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003EWINDOW_NAME\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"s1\"\u003E'Simple Bounding Box Labeling Tool'\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# 定义画面刷新的大概帧率（是否能达到取决于电脑性能）\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003EFPS\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E24\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# 定义支持的图像格式\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003ESUPPOTED_FORMATS\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'jpg'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"s1\"\u003E'jpeg'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"s1\"\u003E'png'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# 定义默认物体框的名字为Object，颜色蓝色，当没有用户自定义物体时用默认物体\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003EDEFAULT_COLOR\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'Object'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E255\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)}\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# 定义灰色，用于信息显示的背景和未定义物体框的显示\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003ECOLOR_GRAY\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E192\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E192\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E192\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# 在图像下方多出BAR_HEIGHT这么多像素的区域用于显示文件名和当前标注物体等信息\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003EBAR_HEIGHT\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E16\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# 上下左右，ESC及删除键对应的cv.waitKey()的返回值\u003C\u002Fspan\u003E\n\u003Cspan class=\"c1\"\u003E# 注意这个值根据操作系统不同有不同，可以通过6.4.2中的代码获取\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003EKEY_UP\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E65362\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003EKEY_DOWN\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E65364\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003EKEY_LEFT\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E65361\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003EKEY_RIGHT\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E65363\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003EKEY_ESC\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E27\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003EKEY_DELETE\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E65535\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# 空键用于默认循环\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003EKEY_EMPTY\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"n\"\u003Eget_bbox_name\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"s1\"\u003E'{}.bbox'\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eformat\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E# 定义物体框标注工具类\u003C\u002Fspan\u003E\n\u003Cspan class=\"k\"\u003Eclass\u003C\u002Fspan\u003E \u003Cspan class=\"nc\"\u003ESimpleBBoxLabeling\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"k\"\u003Edef\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003E__init__\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Edata_dir\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Efps\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EFPS\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ewindow_name\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"bp\"\u003ENone\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E):\u003C\u002Fspan\u003E\n        \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_data_dir\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Edata_dir\u003C\u002Fspan\u003E\n        \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Efps\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Efps\u003C\u002Fspan\u003E\n        \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ewindow_name\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ewindow_name\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ewindow_name\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Eelse\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EWINDOW_NAME\u003C\u002Fspan\u003E\n\n        \u003Cspan class=\"c1\"\u003E#pt0是正在画的左上角坐标，pt1是鼠标所在坐标\u003C\u002Fspan\u003E\n        \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_pt0\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"bp\"\u003ENone\u003C\u002Fspan\u003E\n        \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_pt1\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"bp\"\u003ENone\u003C\u002Fspan\u003E\n\n        \u003Cspan class=\"c1\"\u003E# 表明当前是否正在画框的状态标记\u003C\u002Fspan\u003E\n        \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_drawing\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"bp\"\u003EFalse\u003C\u002Fspan\u003E\n\n        \u003Cspan class=\"c1\"\u003E# 当前标注物体的名称\u003C\u002Fspan\u003E\n        \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_cur_label\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"bp\"\u003ENone\u003C\u002Fspan\u003E\n\n        \u003Cspan class=\"c1\"\u003E# 当前图像对应的所有已标注框\u003C\u002Fspan\u003E\n        \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_bboxes\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[]\u003C\u002Fspan\u003E\n\n        \u003Cspan class=\"c1\"\u003E# 如果有用户自定义的标注信息则读取，否则用默认的物体和颜色\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Elabel_path\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"s1\"\u003E'{}.labels'\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eformat\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_data_dir\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n        \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Elabel_colors\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EDEFAULT_COLOR\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"ow\"\u003Enot\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eos\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Epath\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eexists\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Elabel_path\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Eelse\u003C\u002Fspan\u003E \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eload_labels\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Elabel_path\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n        \u003Cspan class=\"c1\"\u003E# 获取已经标注的文件列表和还未标注的文件列表\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Eimagefiles\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E \u003Cspan class=\"ow\"\u003Ein\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eos\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Elistdir\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_data_dir\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Erfind\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'.'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:]\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Elower\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E \u003Cspan class=\"ow\"\u003Ein\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ESUPPOTED_FORMATS\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Elabeled\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E \u003Cspan class=\"ow\"\u003Ein\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eimagefiles\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eos\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Epath\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eexists\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eget_bbox_name\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E))]\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Eto_be_labeled\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E \u003Cspan class=\"ow\"\u003Ein\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eimagefiles\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E \u003Cspan class=\"ow\"\u003Enot\u003C\u002Fspan\u003E \u003Cspan class=\"ow\"\u003Ein\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Elabeled\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E\n\n        \u003Cspan class=\"c1\"\u003E# 每次打开一个文件夹，都自动从还未标注的第一张开始\u003C\u002Fspan\u003E\n        \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_filelist\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Elabeled\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eto_be_labeled\u003C\u002Fspan\u003E\n        \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_index\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"nb\"\u003Elen\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Elabeled\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n        \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_index\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&amp;gt;\u003C\u002Fspan\u003E \u003Cspan class=\"nb\"\u003Elen\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_filelist\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\n            \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_index\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"nb\"\u003Elen\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_filelist\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"c1\"\u003E# 鼠标回调函数\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Edef\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003E_mouse_ops\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eevent\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ey\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eflags\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eparam\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E):\u003C\u002Fspan\u003E\n\n        \u003Cspan class=\"c1\"\u003E# 按下左键时，坐标为左上角，同时表明开始画框，改变drawing标记为True\u003C\u002Fspan\u003E\n        \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eevent\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E==\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EEVENT_LBUTTONDOWN\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\n            \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_drawing\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"bp\"\u003ETrue\u003C\u002Fspan\u003E\n            \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_pt0\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ey\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n        \u003Cspan class=\"c1\"\u003E# 左键抬起，表明当前框画完了，坐标记为右下角，并保存，同时改变drawing标记为False\u003C\u002Fspan\u003E\n        \u003Cspan class=\"k\"\u003Eelif\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eevent\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E==\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EEVENT_LBUTTONUP\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\n            \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_drawing\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"bp\"\u003EFalse\u003C\u002Fspan\u003E\n            \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_pt1\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ey\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n            \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_bboxes\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eappend\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E((\u003C\u002Fspan\u003E\u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_cur_label\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_pt0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_pt1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)))\u003C\u002Fspan\u003E\n\n        \u003Cspan class=\"c1\"\u003E# 实时更新右下角坐标方便画框\u003C\u002Fspan\u003E\n        \u003Cspan class=\"k\"\u003Eelif\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eevent\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E==\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EEVENT_MOUSEMOVE\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\n            \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_pt1\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ey\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n        \u003Cspan class=\"c1\"\u003E# 鼠标右键删除最近画好的框\u003C\u002Fspan\u003E\n        \u003Cspan class=\"k\"\u003Eelif\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eevent\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E==\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EEVENT_RBUTTONUP\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\n            \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_bboxes\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\n                \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_bboxes\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Epop\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"c1\"\u003E# 清除所有标注框和当前状态\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Edef\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003E_clean_bbox\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E):\u003C\u002Fspan\u003E\n        \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_pt0\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"bp\"\u003ENone\u003C\u002Fspan\u003E\n        \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_pt1\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"bp\"\u003ENone\u003C\u002Fspan\u003E\n        \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_drawing\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"bp\"\u003EFalse\u003C\u002Fspan\u003E\n        \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_bboxes\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[]\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"c1\"\u003E# 画标注框和当前信息的函数\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Edef\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003E_draw_bbox\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eimg\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E):\u003C\u002Fspan\u003E\n\n        \u003Cspan class=\"c1\"\u003E# 在图像下方多出BAR_HEIGHT这么多像素的区域用于显示文件名和当前标注物体等信息\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Eh\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ew\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eimg\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eshape\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[:\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Ecanvas\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EcopyMakeBorder\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimg\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EBAR_HEIGHT\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EBORDER_CONSTANT\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Evalue\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ECOLOR_GRAY\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n        \u003Cspan class=\"c1\"\u003E# 正在标注的物体信息，如果鼠标左键已经按下，则显示两个点坐标，否则显示当前待标注物体的名称\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Elabel_msg\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"s1\"\u003E'{}: {}, {}'\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eformat\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_cur_label\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_pt0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_pt1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \\\n            \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_drawing\u003C\u002Fspan\u003E \\\n            \u003Cspan class=\"k\"\u003Eelse\u003C\u002Fspan\u003E \u003Cspan class=\"s1\"\u003E'Current label: {}'\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eformat\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_cur_label\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n        \u003Cspan class=\"c1\"\u003E# 显示当前文件名，文件个数信息\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Emsg\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"s1\"\u003E'{}\u002F{}: {} | {}'\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eformat\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_index\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"nb\"\u003Elen\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_filelist\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_filelist\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_index\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E],\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Elabel_msg\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EputText\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecanvas\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emsg\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eh\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E+\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E12\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E\n                    \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EFONT_HERSHEY_SIMPLEX\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\n                    \u003Cspan class=\"mf\"\u003E0.5\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n        \u003Cspan class=\"c1\"\u003E# 画出已经标好的框和对应名字\u003C\u002Fspan\u003E\n        \u003Cspan class=\"k\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Elabel\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ebpt0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ebpt1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"ow\"\u003Ein\u003C\u002Fspan\u003E \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_bboxes\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\n            \u003Cspan class=\"n\"\u003Elabel_color\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Elabel_colors\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Elabel\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Elabel\u003C\u002Fspan\u003E \u003Cspan class=\"ow\"\u003Ein\u003C\u002Fspan\u003E \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Elabel_colors\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Eelse\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ECOLOR_GRAY\u003C\u002Fspan\u003E\n            \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Erectangle\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecanvas\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ebpt0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ebpt1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Elabel_color\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ethickness\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n            \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EputText\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecanvas\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Elabel\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ebpt0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E+\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E3\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ebpt0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E+\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E15\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E\n                        \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EFONT_HERSHEY_SIMPLEX\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\n                        \u003Cspan class=\"mf\"\u003E0.5\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Elabel_color\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n        \u003Cspan class=\"c1\"\u003E# 画正在标注的框和对应名字\u003C\u002Fspan\u003E\n        \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_drawing\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\n            \u003Cspan class=\"n\"\u003Elabel_color\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Elabel_colors\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_cur_label\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_cur_label\u003C\u002Fspan\u003E \u003Cspan class=\"ow\"\u003Ein\u003C\u002Fspan\u003E \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Elabel_colors\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Eelse\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ECOLOR_GRAY\u003C\u002Fspan\u003E\n            \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_pt1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&amp;gt;=\u003C\u002Fspan\u003E \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_pt0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\"ow\"\u003Eand\u003C\u002Fspan\u003E \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_pt1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&amp;gt;=\u003C\u002Fspan\u003E \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_pt0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]:\u003C\u002Fspan\u003E\n                \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Erectangle\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecanvas\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_pt0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_pt1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Elabel_color\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ethickness\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n            \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EputText\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecanvas\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_cur_label\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_pt0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E3\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_pt0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E15\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E\n                        \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EFONT_HERSHEY_SIMPLEX\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\n                        \u003Cspan class=\"mf\"\u003E0.5\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Elabel_color\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n        \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecanvas\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"c1\"\u003E# 利用repr()导出标注框数据到文件\u003C\u002Fspan\u003E\n    \u003Cspan class=\"nd\"\u003E@staticmethod\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Edef\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Eexport_bbox\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Efilepath\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ebboxes\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E):\u003C\u002Fspan\u003E\n        \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ebboxes\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\n            \u003Cspan class=\"k\"\u003Ewith\u003C\u002Fspan\u003E \u003Cspan class=\"nb\"\u003Eopen\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Efilepath\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"s1\"\u003E'w'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Eas\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ef\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\n                \u003Cspan class=\"k\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ebbox\u003C\u002Fspan\u003E \u003Cspan class=\"ow\"\u003Ein\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ebboxes\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\n                    \u003Cspan class=\"n\"\u003Eline\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"nb\"\u003Erepr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ebbox\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"s1\"\u003E'\u003C\u002Fspan\u003E\u003Cspan class=\"se\"\u003E\\n\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'\u003C\u002Fspan\u003E\n                    \u003Cspan class=\"n\"\u003Ef\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ewrite\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eline\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n        \u003Cspan class=\"k\"\u003Eelif\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eos\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Epath\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eexists\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Efilepath\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E):\u003C\u002Fspan\u003E\n            \u003Cspan class=\"n\"\u003Eos\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eremove\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Efilepath\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"c1\"\u003E# 利用eval()读取标注框字符串到数据\u003C\u002Fspan\u003E\n    \u003Cspan class=\"nd\"\u003E@staticmethod\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Edef\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Eload_bbox\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Efilepath\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E):\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Ebboxes\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[]\u003C\u002Fspan\u003E\n        \u003Cspan class=\"k\"\u003Ewith\u003C\u002Fspan\u003E \u003Cspan class=\"nb\"\u003Eopen\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Efilepath\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"s1\"\u003E'r'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Eas\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ef\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\n            \u003Cspan class=\"n\"\u003Eline\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ef\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ereadline\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Erstrip\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E\n            \u003Cspan class=\"k\"\u003Ewhile\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eline\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\n                \u003Cspan class=\"n\"\u003Ebboxes\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eappend\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"nb\"\u003Eeval\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eline\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E))\u003C\u002Fspan\u003E\n                \u003Cspan class=\"n\"\u003Eline\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ef\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ereadline\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Erstrip\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E\n        \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ebboxes\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"c1\"\u003E# 利用eval()读取物体及对应颜色信息到数据\u003C\u002Fspan\u003E\n    \u003Cspan class=\"nd\"\u003E@staticmethod\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Edef\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Eload_labels\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Efilepath\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E):\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Elabel_colors\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{}\u003C\u002Fspan\u003E\n        \u003Cspan class=\"k\"\u003Ewith\u003C\u002Fspan\u003E \u003Cspan class=\"nb\"\u003Eopen\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Efilepath\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"s1\"\u003E'r'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Eas\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ef\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\n            \u003Cspan class=\"n\"\u003Eline\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ef\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ereadline\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Erstrip\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E\n            \u003Cspan class=\"k\"\u003Ewhile\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eline\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\n                \u003Cspan class=\"n\"\u003Elabel\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecolor\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"nb\"\u003Eeval\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eline\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n                \u003Cspan class=\"n\"\u003Elabel_colors\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Elabel\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecolor\u003C\u002Fspan\u003E\n                \u003Cspan class=\"n\"\u003Eline\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ef\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ereadline\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Erstrip\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E\n        \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Elabel_colors\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"c1\"\u003E# 读取图像文件和对应标注框信息（如果有的话）\u003C\u002Fspan\u003E\n    \u003Cspan class=\"nd\"\u003E@staticmethod\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Edef\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Eload_sample\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Efilepath\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E):\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Eimg\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimread\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Efilepath\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Ebbox_filepath\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eget_bbox_name\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Efilepath\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Ebboxes\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[]\u003C\u002Fspan\u003E\n        \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eos\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Epath\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eexists\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ebbox_filepath\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E):\u003C\u002Fspan\u003E\n            \u003Cspan class=\"n\"\u003Ebboxes\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ESimpleBBoxLabeling\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eload_bbox\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ebbox_filepath\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n        \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eimg\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ebboxes\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"c1\"\u003E# 导出当前标注框信息并清空\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Edef\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003E_export_n_clean_bbox\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E):\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Ebbox_filepath\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eos\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Esep\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ejoin\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E([\u003C\u002Fspan\u003E\u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_data_dir\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eget_bbox_name\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_filelist\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_index\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E])])\u003C\u002Fspan\u003E\n        \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eexport_bbox\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ebbox_filepath\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_bboxes\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n        \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_clean_bbox\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"c1\"\u003E# 删除当前样本和对应的标注框信息\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Edef\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003E_delete_current_sample\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E):\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Efilename\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_filelist\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_index\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Efilepath\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eos\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Esep\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ejoin\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E([\u003C\u002Fspan\u003E\u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_data_dir\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Efilename\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E])\u003C\u002Fspan\u003E\n        \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eos\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Epath\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eexists\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Efilepath\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E):\u003C\u002Fspan\u003E\n            \u003Cspan class=\"n\"\u003Eos\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eremove\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Efilepath\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Efilepath\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eget_bbox_name\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Efilepath\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n        \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eos\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Epath\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eexists\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Efilepath\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E):\u003C\u002Fspan\u003E\n            \u003Cspan class=\"n\"\u003Eos\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eremove\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Efilepath\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n        \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_filelist\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Epop\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_index\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n        \u003Cspan class=\"k\"\u003Eprint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'{} is deleted!'\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eformat\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Efilename\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E))\u003C\u002Fspan\u003E\n\t\t\n    \u003Cspan class=\"c1\"\u003E# 开始OpenCV窗口循环的方法，定义了程序的主逻辑\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Edef\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Estart\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E):\u003C\u002Fspan\u003E\n\n\t    \u003Cspan class=\"c1\"\u003E# 之前标注的文件名，用于程序判断是否需要执行一次图像读取\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Elast_filename\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"s1\"\u003E''\u003C\u002Fspan\u003E\n\t\t\n        \u003Cspan class=\"c1\"\u003E# 标注物体在列表中的下标\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Elabel_index\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\n\t\t\n        \u003Cspan class=\"c1\"\u003E# 所有标注物体名称的列表\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Elabels\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Elabel_colors\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ekeys\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E\n\n        \u003Cspan class=\"c1\"\u003E# 待标注物体的种类数\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003En_labels\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"nb\"\u003Elen\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Elabels\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n        \u003Cspan class=\"c1\"\u003E# 定义窗口和鼠标回调\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EnamedWindow\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ewindow_name\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EsetMouseCallback\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ewindow_name\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_mouse_ops\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Ekey\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EKEY_EMPTY\u003C\u002Fspan\u003E\n\n        \u003Cspan class=\"c1\"\u003E# 定义每次循环的持续时间\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Edelay\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"nb\"\u003Eint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1000\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E\u002F\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EFPS\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n        \u003Cspan class=\"c1\"\u003E# 只要没有按下Esc键，就持续循环\u003C\u002Fspan\u003E\n        \u003Cspan class=\"k\"\u003Ewhile\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ekey\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E!=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EKEY_ESC\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\n\n            \u003Cspan class=\"c1\"\u003E# 上下键用于选择当前标注物体\u003C\u002Fspan\u003E\n            \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ekey\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E==\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EKEY_UP\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\n                \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Elabel_index\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E==\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\n                    \u003Cspan class=\"k\"\u003Epass\u003C\u002Fspan\u003E\n                \u003Cspan class=\"k\"\u003Eelse\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\n                    \u003Cspan class=\"n\"\u003Elabel_index\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E-=\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\n\n            \u003Cspan class=\"k\"\u003Eelif\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ekey\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E==\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EKEY_DOWN\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\n                \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Elabel_index\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E==\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003En_labels\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\n                    \u003Cspan class=\"k\"\u003Epass\u003C\u002Fspan\u003E\n                \u003Cspan class=\"k\"\u003Eelse\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\n                    \u003Cspan class=\"n\"\u003Elabel_index\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E+=\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\n\n            \u003Cspan class=\"c1\"\u003E# 左右键切换当前标注的图片\u003C\u002Fspan\u003E\n            \u003Cspan class=\"k\"\u003Eelif\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ekey\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E==\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EKEY_LEFT\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\n                \u003Cspan class=\"c1\"\u003E# 已经到了第一张图片的话就不需要清空上一张\u003C\u002Fspan\u003E\n                \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_index\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&amp;gt;\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\n                    \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_export_n_clean_bbox\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E\n\n                \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_index\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E-=\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\n                \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_index\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&amp;lt;\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\n                    \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_index\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\n\n            \u003Cspan class=\"k\"\u003Eelif\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ekey\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E==\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EKEY_RIGHT\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\n                \u003Cspan class=\"c1\"\u003E# 已经到了最后一张图片的话就不需要清空上一张\u003C\u002Fspan\u003E\n                \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_index\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&amp;lt;\u003C\u002Fspan\u003E \u003Cspan class=\"nb\"\u003Elen\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_filelist\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\n                    \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_export_n_clean_bbox\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E\n\n                \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_index\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E+=\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\n                \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_index\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&amp;gt;\u003C\u002Fspan\u003E \u003Cspan class=\"nb\"\u003Elen\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_filelist\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\n                    \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_index\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"nb\"\u003Elen\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_filelist\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\n\n            \u003Cspan class=\"c1\"\u003E# 删除当前图片和对应标注信息\u003C\u002Fspan\u003E\n            \u003Cspan class=\"k\"\u003Eelif\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ekey\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E==\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EKEY_DELETE\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\n                \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Easkyesno\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'Delete Sample'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"s1\"\u003E'Are you sure?'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E):\u003C\u002Fspan\u003E\n                    \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_delete_current_sample\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E\n                    \u003Cspan class=\"n\"\u003Ekey\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EKEY_EMPTY\u003C\u002Fspan\u003E\n                    \u003Cspan class=\"k\"\u003Econtinue\u003C\u002Fspan\u003E\n\n            \u003Cspan class=\"c1\"\u003E# 如果键盘操作执行了换图片，则重新读取，更新图片\u003C\u002Fspan\u003E\n            \u003Cspan class=\"n\"\u003Efilename\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_filelist\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_index\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E\n            \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Efilename\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E!=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Elast_filename\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\n                \u003Cspan class=\"n\"\u003Efilepath\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eos\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Esep\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ejoin\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E([\u003C\u002Fspan\u003E\u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_data_dir\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Efilename\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E])\u003C\u002Fspan\u003E\n                \u003Cspan class=\"n\"\u003Eimg\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_bboxes\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eload_sample\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Efilepath\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n            \u003Cspan class=\"c1\"\u003E# 更新当前标注物体名称\u003C\u002Fspan\u003E\n            \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_cur_label\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Elabels\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Elabel_index\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E\n\n            \u003Cspan class=\"c1\"\u003E# 把标注和相关信息画在图片上并显示指定的时间\u003C\u002Fspan\u003E\n            \u003Cspan class=\"n\"\u003Ecanvas\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_draw_bbox\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimg\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n            \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eimshow\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ewindow_name\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecanvas\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n            \u003Cspan class=\"n\"\u003Ekey\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EwaitKey\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Edelay\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n            \u003Cspan class=\"c1\"\u003E# 当前文件名就是下次循环的老文件名\u003C\u002Fspan\u003E\n            \u003Cspan class=\"n\"\u003Elast_filename\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Efilename\u003C\u002Fspan\u003E\n\n        \u003Cspan class=\"k\"\u003Eprint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'Finished!'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n        \u003Cspan class=\"n\"\u003Ecv2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EdestroyAllWindows\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E\n        \u003Cspan class=\"c1\"\u003E# 如果退出程序，需要对当前进行保存\u003C\u002Fspan\u003E\n        \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eexport_bbox\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eos\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Esep\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ejoin\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E([\u003C\u002Fspan\u003E\u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_data_dir\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eget_bbox_name\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Efilename\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)]),\u003C\u002Fspan\u003E \u003Cspan class=\"bp\"\u003Eself\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_bboxes\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n        \u003Cspan class=\"k\"\u003Eprint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'Labels updated!'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003E__name__\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E==\u003C\u002Fspan\u003E \u003Cspan class=\"s1\"\u003E'__main__'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Edir_with_images\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Easkdirectory\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Etitle\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"s1\"\u003E'Where are the images?'\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Elabeling_task\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ESimpleBBoxLabeling\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Edir_with_images\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Elabeling_task\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estart\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E需要注意的是几个比较通用且独立的方法前加上了一句@staticmethod，表明是个静态方法。执行这个程序，并选择samples文件夹，标注时的画面如下图：\n\u003C\u002Fp\u003E\u003Cfigure\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-8bf145d52acf931772ce598e8bbc777a_b.jpg\" data-rawwidth=\"1024\" data-rawheight=\"625\" class=\"origin_image zh-lightbox-thumb\" width=\"1024\" data-original=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-8bf145d52acf931772ce598e8bbc777a_r.jpg\"\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&amp;lt;svg%20xmlns='http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg'%20width='1024'%20height='625'&amp;gt;&amp;lt;\u002Fsvg&amp;gt;\" data-rawwidth=\"1024\" data-rawheight=\"625\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1024\" data-original=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-8bf145d52acf931772ce598e8bbc777a_r.jpg\" data-actualsrc=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-8bf145d52acf931772ce598e8bbc777a_b.jpg\"\u003E\u003C\u002Ffigure\u003E\u003Cp\u003E\u003C\u002Fp\u003E","updated":new Date("2016-12-17T14:57:55.000Z"),"canComment":false,"commentPermission":"anyone","commentCount":54,"collapsedCount":0,"likeCount":395,"state":"published","isLiked":false,"slug":"24425116","lastestTipjarors":[{"isFollowed":false,"name":"周旭阳","headline":"","avatarUrl":"https:\u002F\u002Fpic4.zhimg.com\u002Fda8e974dc_s.jpg","isFollowing":false,"type":"people","slug":"zhou-xu-yang-23-11","bio":"挨踢攻城狮","hash":"aa21d7aab971c5f7f4e78fd78146cbd9","uid":747743048791773200,"isOrg":false,"description":"","profileUrl":"https:\u002F\u002Fwww.zhihu.com\u002Fpeople\u002Fzhou-xu-yang-23-11","avatar":{"id":"da8e974dc","template":"https:\u002F\u002Fpic4.zhimg.com\u002F{id}_{size}.jpg"},"isOrgWhiteList":false,"isBanned":false}],"isTitleImageFullScreen":false,"rating":"none","titleImage":"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-1712545c1114f3f66f37121c02354144_r.jpg","links":{"comments":"\u002Fapi\u002Fposts\u002F24425116\u002Fcomments"},"reviewers":[],"topics":[{"url":"https:\u002F\u002Fwww.zhihu.com\u002Ftopic\u002F19587715","id":"19587715","name":"OpenCV"},{"url":"https:\u002F\u002Fwww.zhihu.com\u002Ftopic\u002F19552832","id":"19552832","name":"Python"},{"url":"https:\u002F\u002Fwww.zhihu.com\u002Ftopic\u002F19813032","id":"19813032","name":"深度学习（Deep Learning）"}],"adminClosedComment":false,"titleImageSize":{"width":722,"height":515},"href":"\u002Fapi\u002Fposts\u002F24425116","excerptTitle":"","tipjarState":"activated","tipjarTagLine":"真诚赞赏，手留余香","sourceUrl":"","pageCommentsCount":54,"tipjarorCount":1,"annotationAction":[],"hasPublishingDraft":false,"snapshotUrl":"","publishedTime":"2016-12-17T22:57:55+08:00","url":"\u002Fp\u002F24425116","lastestLikers":[{"bio":"仁义礼智信","isFollowing":false,"hash":"1ce25728318609910f3fe1774fe9758d","uid":79137909768192,"isOrg":false,"slug":"zhong-lin-mao-63","isFollowed":false,"description":"","name":"April","profileUrl":"https:\u002F\u002Fwww.zhihu.com\u002Fpeople\u002Fzhong-lin-mao-63","avatar":{"id":"v2-6380a660a023a4b551a3126e69f72f35","template":"https:\u002F\u002Fpic3.zhimg.com\u002F{id}_{size}.jpg"},"isOrgWhiteList":false,"isBanned":false},{"bio":"蹉跎","isFollowing":false,"hash":"b81f556ca10d6bd562016ca7398ba828","uid":28046539096064,"isOrg":false,"slug":"li-mr-71","isFollowed":false,"description":"计算机视觉\u002FC++","name":"朝闻道","profileUrl":"https:\u002F\u002Fwww.zhihu.com\u002Fpeople\u002Fli-mr-71","avatar":{"id":"f96db44e0","template":"https:\u002F\u002Fpic2.zhimg.com\u002F{id}_{size}.jpg"},"isOrgWhiteList":false,"isBanned":false},{"bio":null,"isFollowing":false,"hash":"385f2668fde695ec36b72fd8ab7f883d","uid":568429237003010050,"isOrg":false,"slug":"lin-zhang-35-96","isFollowed":false,"description":"","name":"Anchor","profileUrl":"https:\u002F\u002Fwww.zhihu.com\u002Fpeople\u002Flin-zhang-35-96","avatar":{"id":"88d39854e7b77a8b521d5a3627b56092","template":"https:\u002F\u002Fpic2.zhimg.com\u002F{id}_{size}.jpg"},"isOrgWhiteList":false,"isBanned":false},{"bio":"键盘学习家~","isFollowing":false,"hash":"4b17f3914c4e4a46571edd163dbeb59e","uid":552171853825876000,"isOrg":false,"slug":"guo-yi-yun-2","isFollowed":false,"description":"大龄学生一枚","name":"郭奕云","profileUrl":"https:\u002F\u002Fwww.zhihu.com\u002Fpeople\u002Fguo-yi-yun-2","avatar":{"id":"v2-93206a3c8419a04b565cef78871e6958","template":"https:\u002F\u002Fpic3.zhimg.com\u002F{id}_{size}.jpg"},"isOrgWhiteList":false,"isBanned":false},{"bio":"没有存在感乏善可陈内部空空如也的工科生","isFollowing":false,"hash":"fee2a9380cd9127f09fe862bb81bd611","uid":625636410703614000,"isOrg":false,"slug":"zhang-hao-qing-16","isFollowed":false,"description":"找寻存在","name":"发条鸟","profileUrl":"https:\u002F\u002Fwww.zhihu.com\u002Fpeople\u002Fzhang-hao-qing-16","avatar":{"id":"c7fb573d2ee91aa98ffd092cf38f19f8","template":"https:\u002F\u002Fpic4.zhimg.com\u002F{id}_{size}.jpg"},"isOrgWhiteList":false,"isBanned":false}],"summary":"\u003Cimg src=\"http:\u002F\u002Fpic1.zhimg.com\u002Fv2-9363ac86d8f4b9fde8fbef903851179c_200x112.png\" data-rawwidth=\"1017\" data-rawheight=\"701\" class=\"origin_image inline-img zh-lightbox-thumb\" data-original=\"http:\u002F\u002Fpic1.zhimg.com\u002Fv2-9363ac86d8f4b9fde8fbef903851179c_r.png\"\u003E本篇是前面两篇教程：\u003Ca href=\"https:\u002F\u002Fzhuanlan.zhihu.com\u002Fp\u002F24162430\"\u003E给深度学习入门者的Python快速教程 - 基础篇\u003C\u002Fa\u003E\u003Ca href=\"https:\u002F\u002Fzhuanlan.zhihu.com\u002Fp\u002F24309547\"\u003E给深度学习入门者的Python快速教程 - numpy和Matplotlib篇\u003C\u002Fa\u003E的番外篇，因为严格来说不是在讲Python而是讲在Python下使用OpenCV。本篇将介绍和深度学习数据处理阶段最相关的基础使用，并完成4个…","reviewingCommentsCount":0,"meta":{"previous":null,"next":null},"annotationDetail":null,"commentsCount":54,"likesCount":395,"FULLINFO":true}},"User":{"frombeijingwithlove":{"isFollowed":false,"name":"達聞西","headline":"","avatarUrl":"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-e3036b85796de307726b34472d0d126c_s.jpg","isFollowing":false,"type":"people","slug":"frombeijingwithlove","bio":"","hash":"661cd655d168712a683ed76b5e5d1d03","uid":33009986174976,"isOrg":false,"description":"","badge":{"identity":null,"bestAnswerer":null},"profileUrl":"https:\u002F\u002Fwww.zhihu.com\u002Fpeople\u002Ffrombeijingwithlove","avatar":{"id":"v2-e3036b85796de307726b34472d0d126c","template":"https:\u002F\u002Fpic1.zhimg.com\u002F{id}_{size}.jpg"},"isOrgWhiteList":false,"isBanned":false}},"Comment":{},"favlists":{}},"me":{},"global":{"experimentFeatures":{"ge3":"ge3_9","ge2":"ge2_1","growthSearch":"s1","nwebQAGrowth":"experiment","qawebRelatedReadingsContentControl":"close","liveStore":"ls_a2_b2_c1_f2","qawebThumbnailAbtest":"new","nwebSearch":"nweb_search_heifetz","enableVoteDownReasonMenu":"enable","showVideoUploadAttention":"true","isOffice":"false","enableTtsPlay":"post","newQuestionDiversion":"true","wechatShareModal":"wechat_share_modal_show","newLiveFeedMediacard":"old","androidPassThroughPush":"all","hybridZhmoreVideo":"no","nwebGrowthPeople":"default","nwebSearchSuggest":"default","qrcodeLogin":"qrcode","seE":"0","androidDbFollowRecommendHide":"open","isShowUnicomFreeEntry":"unicom_free_entry_off","newMobileColumnAppheader":"new_header","androidDbCommentWithRepinRecord":"open","feedHybridTopicRecomButtonIcon":"yes","androidDbRecommendAction":"open","zcmLighting":"zcm","androidDbFeedHashTagStyle":"button","appStoreRateDialog":"close","topWeightSearch":"new_top_search","default":"None","isNewNotiPanel":"no","androidDbRepinSelection":"open","growthBanner":"default","androidProfilePanel":"panel_b"}},"columns":{"next":{}},"columnPosts":{},"columnSettings":{"colomnAuthor":[],"uploadAvatarDetails":"","contributeRequests":[],"contributeRequestsTotalCount":0,"inviteAuthor":""},"postComments":{},"postReviewComments":{"comments":[],"newComments":[],"hasMore":true},"favlistsByUser":{},"favlistRelations":{},"promotions":{},"switches":{"couldSetPoster":false},"draft":{"titleImage":"","titleImageSize":{},"isTitleImageFullScreen":false,"canTitleImageFullScreen":false,"title":"","titleImageUploading":false,"error":"","content":"","draftLoading":false,"globalLoading":false,"pendingVideo":{"resource":null,"error":null}},"drafts":{"draftsList":[],"next":{}},"config":{"userNotBindPhoneTipString":{}},"recommendPosts":{"articleRecommendations":[],"columnRecommendations":[]},"env":{"edition":{"baidu":false,"yidianzixun":false,"qqnews":false},"isAppView":false,"appViewConfig":{"content_padding_top":128,"content_padding_bottom":56,"content_padding_left":16,"content_padding_right":16,"title_font_size":22,"body_font_size":16,"is_dark_theme":false,"can_auto_load_image":true,"app_info":"OS=iOS"},"isApp":false,"userAgent":{"ua":"Mozilla\u002F5.0 (Windows NT 6.1; WOW64) AppleWebKit\u002F537.36 (KHTML, like Gecko) Chrome\u002F55.0.2883.87 Safari\u002F537.36","browser":{"name":"Chrome","version":"55.0.2883.87","major":"55"},"engine":{"version":"537.36","name":"WebKit"},"os":{"name":"Windows","version":"7"},"device":{},"cpu":{"architecture":"amd64"}}},"message":{"newCount":0},"pushNotification":{"newCount":0}}</textarea><script src="./给深度学习入门者的Python快速教程 - 番外篇之Python-OpenCV_files/common.ed52d50f10cd91e814bd.js"></script><script src="./给深度学习入门者的Python快速教程 - 番外篇之Python-OpenCV_files/app.780d9617301b4f5c673f.js"></script><script src="./给深度学习入门者的Python快速教程 - 番外篇之Python-OpenCV_files/raven.f235d1f0d60beb5e5586.js" async="" defer=""></script><div><div data-reactroot=""><div class="Editable-languageSuggestions" style="left: -1179px; top: -999px;"><div><div class="Popover"><div class="Editable-languageSuggestionsInput Input-wrapper"><input value="" autocomplete="off" role="combobox" aria-expanded="false" aria-autocomplete="list" aria-activedescendant="AutoComplet-65385-69496-0" id="Popover-65385-69482-toggle" aria-haspopup="true" aria-owns="Popover-65385-69482-content" class="Input" placeholder="选择语言"><div class="Input-after"><svg class="Zi Zi--Select" fill="#afbdcf" viewBox="0 0 24 24" width="24" height="24"><path d="M12 16.183l2.716-2.966a.757.757 0 0 1 1.064.001.738.738 0 0 1 0 1.052l-3.247 3.512a.758.758 0 0 1-1.064 0L8.22 14.27a.738.738 0 0 1 0-1.052.758.758 0 0 1 1.063 0L12 16.183zm0-9.365L9.284 9.782a.758.758 0 0 1-1.064 0 .738.738 0 0 1 0-1.052l3.248-3.512a.758.758 0 0 1 1.065 0L15.78 8.73a.738.738 0 0 1 0 1.052.757.757 0 0 1-1.063.001L12 6.818z" fill-rule="evenodd"></path></svg></div></div><!-- react-empty: 10 --></div></div></div></div></div></body></html>